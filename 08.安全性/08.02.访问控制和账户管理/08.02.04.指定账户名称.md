### 8.2.4 指定账户名称

MySQL 账户名称由用户名和主机名组成，这允许为从不同主机连接的具有相同用户名的用户创建不同的账户。本节描述了账户名称的语法，包括特殊值和通配符规则。

在大多数方面，账户名称与 MySQL 角色名称类似，一些不同之处在第 [8.2.5 节 指定角色名称](08.02.05.指定角色名称.md)中有描述。

账户名称出现在如 CREATE USER、GRANT 和 SET PASSWORD 等 SQL 语句中，遵循以下规则：

- 账户名称的语法为 'user_name'@'host_name'。


- @'host_name' 部分是可选的。仅由用户名组成的账户名称等同于 'user_name'@'%'。例如，'me' 等同于 'me'@'%'。


- 如果用户名和主机名作为未加引号的标识符是合法的，则无需加引号。如果 user_name 字符串包含特殊字符（如空格或 - ），或者 host_name 字符串包含特殊字符或通配符（如 . 或 % ），则必须使用引号。例如，在账户名 'test-user'@'%.com' 中，用户名和主机名部分都需要引号。


- 使用反引号 (\`)、单引号 (') 或双引号 (") 将用户名和主机名引用为标识符或字符串。关于字符串引用和标识符引用的指南，请参见第 9.1.1 节“字符串字面量”和第 9.2 节“模式对象名称”。在 SHOW 语句结果中，用户名和主机名使用反引号 () 引用。

- 
  如果引用，用户名和主机名部分必须分别引用。也就是说，写作 'me'@'localhost'，而不是 'me@localhost'。（后者实际上等同于 'me@localhost'@'%'，尽管这种行为现在已被弃用。）


- 对 CURRENT_USER 或 CURRENT_USER() 函数的引用等同于字面上指定当前客户端的用户名和主机名。


MySQL 在 mysql 系统数据库的授权表中存储账户名称，使用单独的列存储用户名和主机名部分：

- user 表为每个账户包含一行。User 和 Host 列存储用户名和主机名。该表还指示账户拥有哪些全局权限。


- 其他授权表指示账户在数据库及数据库内对象上拥有的权限。这些表有 User 和 Host 列来存储账户名称。这些表中的每一行都与 user 表中具有相同 User 和 Host 值的账户相关联。


- 出于访问检查目的，User 值的比较是区分大小写的。Host 值的比较不区分大小写。


有关存储在授权表中的用户名和主机名的属性的更多细节，如最大长度，请参见“授权表范围列属性”。

用户名和主机名有一些特殊值或通配符约定，如下所述。

账户名称的用户名部分要么是一个非空白值，与传入连接尝试的用户名直接匹配，要么是一个空白值（空字符串），与任何用户名匹配。具有空白用户名的账户是匿名用户。在 SQL 语句中指定匿名用户时，请使用引号引起的空白用户名部分，例如 ''@'localhost'。

账户名称的主机名部分可以采取多种形式，允许使用通配符：

- 主机值可以是主机名或 IP 地址（IPv4 或 IPv6）。名称 'localhost' 表示本地主机。IP 地址 '127.0.0.1' 表示 IPv4 回环接口。IP 地址 '::1' 表示 IPv6 回环接口。


- 允许在主机名或 IP 地址值中使用 % 和 _ 通配符，但自 MySQL 8.0.35 起不推荐使用，因此可能在 MySQL 的未来版本中被移除。这些字符与使用 LIKE 运算符进行的模式匹配操作中的含义相同。例如，主机值 '%' 匹配任何主机名，而 '%.mysql.com' 匹配 mysql.com 域中的任何主机。'198.51.100.%' 匹配 198.51.100 类 C 网络中的任何主机。

  因为在主机值中允许使用 IP 通配符值（例如，'198.51.100.%' 匹配子网上的每个主机），所以有人可能会尝试通过将主机命名为 198.51.100.somewhere.com 来利用这一功能。为了阻止这类尝试，MySQL 不对以数字和点开头的主机名进行匹配。例如，如果一个主机被命名为 1.2.example.com，其名称永远不会匹配账户名称的主机部分。IP 通配符值只能匹配 IP 地址，而不是主机名。

  如果 partial_revokes 为 ON，MySQL 将 % 和 _ 视为字面字符，而不是通配符。从 MySQL 8.0.35 开始，不推荐使用这些通配符（不论此变量的值如何），并且应该预期在 MySQL 的未来版本中删除此功能。

- 对于指定为 IPv4 地址的主机值，可以给出一个子网掩码，以指示用于网络号的地址位数。子网掩码表示法不能用于 IPv6 地址。

  语法为 host_ip/netmask。例如：

  ```
  CREATE USER 'david'@'198.51.100.0/255.255.255.0';
  ```

  

  这使 david 能够从具有 IP 地址 client_ip 的任何客户端主机连接，其中满足以下条件：

  ```
  client_ip & netmask = host_ip
  ```

  即，对于刚刚显示的 CREATE USER 语句：

  ```
  client_ip & 255.255.255.0 = 198.51.100.0
  ```

  满足此条件的 IP 地址范围从 198.51.100.0 到 198.51.100.255。

  子网掩码通常以设置为 1 的位开始，然后是设置为 0 的位。例子：

  - 198.0.0.0/255.0.0.0：198 类 A 网络上的任何主机
  - 198.51.0.0/255.255.0.0：198.51 类 B 网络上的任何主机
  - 198.51.100.0/255.255.255.0：198.51.100 类 C 网络上的任何主机
  - 198.51.100.1：仅具有此特定 IP 地址的主机
  - 从 MySQL 8.0.23 开始，指定为 IPv4 地址的主机值可以使用 CIDR 表示法编写，例如 198.51.100.44/24。

服务器在账户名称中对主机值与客户端主机进行匹配时，使用系统 DNS 解析器返回的客户端主机名或 IP 地址的值。除非账户主机值使用子网掩码表示法指定，否则服务器即使对于给定为 IP 地址的账户主机值，也将此比较作为字符串匹配执行。这意味着您应该以 DNS 使用的相同格式指定账户主机值。以下是需要注意的问题示例：

假设本地网络上的一个主机的全称为 host1.example.com。如果 DNS 对此主机的名称查询返回 host1.example.com，请在账户主机值中使用该名称。如果 DNS 仅返回 host1，请使用 host1。

如果 DNS 返回给定主机的 IP 地址为 198.51.100.2，那么它匹配账户主机值 198.51.100.2，但不匹配 198.051.100.2。同样，它匹配账户主机模式如 198.51.100.% 但不匹配 198.051.100.%。

为了避免这类问题，建议检查您的 DNS 以何种格式返回主机名和地址。在 MySQL 账户名称中使用相同格式的值。