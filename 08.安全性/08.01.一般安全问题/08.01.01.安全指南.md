### 8.1.1 安全指南

任何在连接到互联网的计算机上使用MySQL的人都应该阅读这一节，以避免最常见的安全错误。

在讨论安全时，必须全面考虑保护整个服务器主机（不仅仅是MySQL服务器）免受所有类型的攻击：窃听、篡改、重放和拒绝服务。我们在这里不涵盖所有关于可用性和容错性的方面。

MySQL使用基于访问控制列表（ACL）的安全机制，用于所有连接、查询和用户尝试进行的其他操作。它还支持MySQL客户端和服务器之间的SSL加密连接。这里讨论的许多概念并非特定于MySQL；同样的一般想法适用于几乎所有应用程序。

运行MySQL时，请遵循以下指南：

- **不要将用户表在mysql系统数据库中的访问权限授予任何人（MySQL `root`账户除外）！**这一点至关重要。

- 学习MySQL访问权限系统的工作原理（见[第6.2节，访问控制和账户管理](../08.02.访问控制和账户管理/08.02.00.访问控制和账户管理.md)）。使用GRANT和REVOKE语句来控制对MySQL的访问。不要授予比必要更多的权限。永远不要向所有主机授予权限。

  检查清单：

  - 尝试mysql -u root。如果您能够成功连接到服务器而不需要密码，那么任何人都可以作为MySQL root用户连接到您的MySQL服务器，并拥有全部权限！请复查MySQL安装说明，特别注意设置root密码的信息。见[第2.9.4节 安全初始化MySQL账户](../../02.安装和升级MySQL/02.09.安装后设置和测试/02.09.04.安全初始化MySQL账户.md)。
  - 使用SHOW GRANTS语句检查哪些账户有何种访问权限。然后使用REVOKE语句移除那些不必要的权限。

- 不要在数据库中存储明文密码。如果您的计算机受到攻击，入侵者可以获取整个密码列表并使用它们。相反，使用`SHA2()`或其他单向哈希函数，并存储哈希值。

  为了防止使用彩虹表恢复密码，不要在明文密码上使用这些函数；相反，选择一些字符串作为盐，并使用`hash(hash(password)+salt)`值。

- 假设所有密码都将受到使用已知密码列表的自动破解尝试，以及使用关于您的公开信息（如社交媒体帖子）进行的有针对性的猜测。不要选择由容易破解或猜测的项目组成的密码，如字典单词、专有名词、运动队名称、首字母缩写词或常见短语，特别是如果它们与您有关。如果以可预测的方式使用大写字母、数字替代和添加以及特殊字符，则不起作用。也不要选择您在任何地方看到的作为示例的密码，或其变体，即使它被呈现为强密码的示例。

  相反，选择尽可能长且不可预测的密码。这并不意味着组合需要是难以记忆和复制的随机字符串，尽管如果您有例如密码管理软件可以生成、填充这些密码并安全存储它们，这是一种好方法。包含多个单词的密码短语易于创建、记忆和复制，且比典型的用户选择的由单个修改过的单词或可预测字符序列组成的密码更安全。创建安全的密码短语时，请确保其中的单词和其他项目不是已知的短语或引用，不是以可预测的顺序出现，最好根本没有彼此之间的先前关系。

- 投入防火墙。这至少可以保护您免受任何软件中所有类型的攻击的50%。将MySQL置于防火墙后面或非军事区（DMZ）。

  检查清单：

  - 尝试使用nmap等工具从互联网扫描您的端口。MySQL默认使用3306端口。这个端口不应该对不受信任的主机开放。作为检查MySQL端口是否开放的简单方法，尝试从一些远程机器执行以下命令，其中server_host是您的MySQL服务器运行的主机的主机名或IP地址：

    ```bash
    $> telnet server_host 3306
    ```

    如果telnet挂起或连接被拒绝，端口被阻塞，这是您希望的状态。如果您获得连接和一些乱码字符，端口是开放的，应该在您的防火墙或路由器上关闭，除非您真的有充分的理由将其保持开放。

- 访问MySQL的应用程序不应该信任用户输入的任何数据，并且应该使用适当的防御性编程技术编写。参见[第6.1.7节 客户端编程安全指南](../08.01.一般安全问题/08.01.07.客户端编程安全指南.md)。

- 不要在互联网上传输明文（未加密）数据。这些信息对所有有时间和能力拦截并为自己目的使用它的人都是可访问的。相反，使用加密协议，如SSL或SSH。MySQL支持内部SSL连接。另一种技术是使用SSH端口转发来创建加密（和压缩）的通信隧道。

- 学习使用tcpdump和strings实用程序。在大多数情况下，您可以通过发出如下命令来检查MySQL数据流是否未加密：

  ```bash
  $> tcpdump -l -i eth0 -w - src or dst port 3306 | strings
  ```

  这在Linux下有效，并且在其他系统下应该只需小幅修改即可。

> **警告**
>
> 如果您没有看到明文数据，这并不总是意味着信息实际上是加密的。如果您需要高安全性，请咨询安全专家。