#### 25.4.3.5 定义 NDB Cluster 管理服务器

`[ndb_mgmd]` 部分用于配置管理服务器的行为。如果使用多个管理服务器，可以在 `[ndb_mgmd default]` 部分中指定它们的共同参数。`[mgm]` 和 `[mgm default]` 是这些的旧别名，为了向后兼容而支持。

以下列表中的所有参数都是可选的，如果省略，则假定为默认值。

> **注意**
>
> 如果既没有 `ExecuteOnComputer` 参数也没有 `HostName` 参数，则默认值为 `localhost`。

- #### Id

  | 属性               | 值           |
  | ------------------ | ------------ |
  | 版本（或更高版本） | NDB 8.0.13   |
  | 类型或单位         | 无符号整数   |
  | 默认值             | [...]        |
  | 范围               | 1 - 255      |
  | 重启类型           | 初始系统重启 |

  每个集群节点都有唯一标识。对于管理节点，这是一个在 1 到 255 范围内的整数值。该 ID 由所有内部集群消息用于寻址节点，因此必须对每个 NDB Cluster 节点唯一，不论节点类型如何。

  > **注意**
  >
  > 数据节点 ID 必须小于 145。如果计划部署大量数据节点，建议将管理节点（和 API 节点）的节点 ID 限制为大于 144 的值。

  使用 `Id` 参数标识管理节点已被弃用，建议使用 `NodeId`。尽管 `Id` 仍然为了向后兼容而支持，但现在会生成警告，并可能在未来版本的 NDB Cluster 中删除。

- #### NodeId

  | 属性               | 值           |
  | ------------------ | ------------ |
  | 版本（或更高版本） | NDB 8.0.13   |
  | 类型或单位         | 无符号整数   |
  | 默认值             | [...]        |
  | 范围               | 1 - 255      |
  | 重启类型           | 初始系统重启 |

  每个集群节点都有唯一标识。对于管理节点，这是一个在 1 到 255 范围内的整数值。该 ID 由所有内部集群消息用于寻址节点，因此必须对每个 NDB Cluster 节点唯一，不论节点类型如何。

  > **注意**
  >
  > 数据节点 ID 必须小于 145。如果计划部署大量数据节点，建议将管理节点（和 API 节点）的节点 ID 限制为大于 144 的值。

  `NodeId` 是标识管理节点的首选参数名。尽管较旧的 `Id` 参数仍然为了向后兼容而支持，但它现在已被弃用，并在使用时生成警告；也可能在未来的 NDB Cluster 版本中删除。

- #### ExecuteOnComputer

  | 属性               | 值         |
  | ------------------ | ---------- |
  | 版本（或更高版本） | NDB 8.0.13 |
  | 类型或单位         | 名称       |
  | 默认值             | [...]      |
  | 范围               | ...        |
  | 重启类型           | 系统重启   |

  参考 `config.ini` 文件 `[computer]` 部分中定义的计算机的 `Id`。

  > **重要**
  >
  > 此参数已被弃用，未来版本中可能会删除。请改用 `HostName` 参数。

- #### PortNumber

  | 属性               | 值         |
  | ------------------ | ---------- |
  | 版本（或更高版本） | NDB 8.0.13 |
  | 类型或单位         | 无符号整数 |
  | 默认值             | 1186       |
  | 范围               | 0 - 64K    |
  | 重启类型           | 系统重启   |

  管理服务器监听配置请求和管理命令的端口号。

  该节点的节点 ID 只能分配给明确请求它的连接。请求“任何”节点 ID 的管理服务器不能使用此 ID。此参数可用于在同一主机上运行多个管理服务器，并且 `HostName` 不足以区分进程时使用。用于测试。

- #### HostName

  | 属性               | 值             |
  | ------------------ | -------------- |
  | 版本（或更高版本） | NDB 8.0.13     |
  | 类型或单位         | 名称或 IP 地址 |
  | 默认值             | [...]          |
  | 范围               | ...            |
  | 重启类型           | 节点重启       |

  指定该参数可以定义管理节点所在计算机的主机名。使用 `HostName` 来指定 `localhost` 以外的主机名。

- #### LocationDomainId

  | 属性               | 值         |
  | ------------------ | ---------- |
  | 版本（或更高版本） | NDB 8.0.13 |
  | 类型或单位         | 整数       |
  | 默认值             | 0          |
  | 范围               | 0 - 16     |
  | 重启类型           | 系统重启   |

  将管理节点分配到云中的特定可用性域（也称为可用性区）。通过告知 NDB 哪些节点在哪些可用性域，可以在云环境中提高性能：

  - 如果请求的数据未在同一节点上找到，可以将读取操作定向到同一可用性域中的其他节点。
  - 不同可用性域之间的节点通信确保使用 NDB 传输器的 WAN 支持，无需进一步手动干预。
  - 传输器的组号可以基于使用的可用性域，这样也可以使 SQL 和其他 API 节点尽可能与同一可用性域中的本地数据节点通信。
  - 仲裁器可以从没有数据节点的可用性域中选择，如果找不到这样的可用性域，则从第三个可用性域中选择。

  `LocationDomainId` 取值范围为 0 到 16，默认为 0；使用 0 与不设置该参数相同。

- #### LogDestination

  | 属性               | 值                                                           |
  | ------------------ | ------------------------------------------------------------ |
  | 版本（或更高版本） | NDB 8.0.13                                                   |
  | 类型或单位         | `{CONSOLE|SYSLOG|FILE}`                                      |
  | 默认值             | `FILE: filename=ndb_nodeid_cluster.log, maxsize=1000000, maxfiles=6` |
  | 范围               | ...                                                          |
  | 重启类型           | 节点重启                                                     |

  此参数指定将集群日志信息发送到哪里。有三种选项：`CONSOLE`、`SYSLOG` 和 `FILE`，默认值为 `FILE`：

  - `CONSOLE` 将日志输出到 `stdout`：<br>

    ```
    CONSOLE
    ```

  - `SYSLOG` 将日志发送到 `syslog` 设施，可能的值为 `auth`、`authpriv`、`cron`、`daemon`、`ftp`、`kern`、`lpr`、`mail`、`news`、`syslog`、`user`、`uucp`、`local0`、`local1`、`local2`、`local3`、`local4`、`local5`、`local6` 或 `local7`。

    > **注意**
    >
    > 并非每个操作系统都支持每个设施。

    ```ini
    SYSLOG:facility=syslog
    ```

  - `FILE` 将集群日志输出到同一台机器上的常规文件。可以指定以下值：

    -  `filename`：日志文件名。

      默认日志文件名为 `ndb_nodeid_cluster.log`。

    - `maxsize`：文件可以增长到的最大大小（以字节为单位），然后日志记录滚动到新文件。当这种情况发生时，旧日志文件通过在文件名后附加 `.N` 进行重命名，其中 `N` 是尚未使用的下一个编号。

    - `maxfiles`：日志文件的最大数量。

      ```ini
      FILE:filename=cluster.log,maxsize=1000000,maxfiles=6
      ```

     `FILE` 参数的默认值`FILE:filename=ndb_node_id_cluster.log,maxsize=1000000,maxfiles=6`，其中 `node_id` 是节点的 ID。

  可以用分号分隔符指定多个日志目的地，如下所示：

  ```
  CONSOLE;SYSLOG:facility=local0;FILE:filename=/var/log/mgmd
  ```

- #### ArbitrationRank

  | 属性               | 值         |
  | ------------------ | ---------- |
  | 版本（或更高版本） | NDB 8.0.13 |
  | 类型或单位         | 0-2        |
  | 默认值             | 1          |
  | 范围               | 0 - 2      |
  | 重启类型          | 节点重启              |

  此参数用于定义哪些节点可以充当仲裁器。只有管理节点和 SQL 节点可以作为仲裁器。`ArbitrationRank` 可以取以下值之一：

  - 0：该节点从不作为仲裁器使用。
  - 1：该节点优先级高；即，相对于低优先级节点，更优先作为仲裁器。
  - 2：表示低优先级节点，仅在没有更高优先级节点可用时用作仲裁器。

  通常，应将管理服务器配置为仲裁器，将其 `ArbitrationRank` 设置为 1（管理节点的默认值），并将所有 SQL 节点的值设置为 0（SQL 节点的默认值）。

  可以通过将所有管理节点和 SQL 节点的 `ArbitrationRank` 设置为 0，或通过在 `config.ini` 全局配置文件的 `[ndbd default]` 部分中设置 `Arbitration` 参数来完全禁用仲裁。设置 `Arbitration` 会导致忽略 `ArbitrationRank` 的任何设置。

- #### ArbitrationDelay

  | 属性               | 值                          |
  | ------------------ | --------------------------- |
  | 版本（或更高版本） | NDB 8.0.13                  |
  | 类型或单位         | 毫秒                        |
  | 默认值             | 0                           |
  | 范围               | 0 - 4294967039 (0xFFFFFEFF) |
  | 重启类型           | 节点重启                    |

  一个整数值，使管理服务器对仲裁请求的响应延迟该毫秒数。默认值为 0；通常不需要更改此值。

- #### DataDir

  | 属性               | 值         |
  | ------------------ | ---------- |
  | 版本（或更高版本） | NDB 8.0.13 |
  | 类型或单位         | 路径       |
  | 默认值             | .          |
  | 范围               | ...        |
  | 重启类型           | 节点重启   |

  指定管理服务器输出文件的目录。这些文件包括集群日志文件、进程输出文件和守护进程的进程 ID（PID）文件。（对于日志文件，可以通过设置 `LogDestination` 的 `FILE` 参数覆盖此位置，如本节前面所述。）

  此参数的默认值为 `ndb_mgmd` 所在目录。

- #### PortNumberStats

  | 属性               | 值         |
  | ------------------ | ---------- |
  | 版本（或更高版本） | NDB 8.0.13 |
  | 类型或单位         | 无符号整数 |
  | 默认值             | [...]      |
  | 范围               | 0 - 64K    |
  | 重启类型           | 节点重启   |

  此参数指定用于从 NDB Cluster 管理服务器获取统计信息的端口号。它没有默认值。

- #### Wan

  | 属性               | 值          |
  | ------------------ | ----------- |
  | 版本（或更高版本） | NDB 8.0.13  |
  | 类型或单位         | 布尔值      |
  | 默认值             | false       |
  | 范围               | true, false |
  | 重启类型           | 节点重启    |

  使用 WAN TCP 设置为默认。

- #### HeartbeatThreadPriority

  | 属性               | 值         |
  | ------------------ | ---------- |
  | 版本（或更高版本） | NDB 8.0.13 |
  | 类型或单位         | 字符串     |
  | 默认值             | [...]      |
  | 范围               | ...        |
  | 重启类型           | 节点重启   |

  设置管理节点和 API 节点的心跳线程的调度策略和优先级。

  设置此参数的语法如下所示：

  ```structured text
  HeartbeatThreadPriority = policy[, priority]
  
  policy:
    {FIFO | RR}
  ```

  设置此参数时，必须指定一个策略。策略是 `FIFO`（先进先出）或 `RR`（循环）。策略值之后可选地指定优先级（一个整数）。

- #### ExtraSendBufferMemory

  | 属性               | 值         |
  | ------------------ | ---------- |
  | 版本（或更高版本） | NDB 8.0.13 |
  | 类型或单位         | 字节       |
  | 默认值             | 0          |
  | 范围               | 0 - 32G    |
  | 重启类型           | 节点重启   |

  此参数指定除了使用 `TotalSendBufferMemory`、`SendBufferMemory` 或两者分配的传输器发送缓冲区内存之外，还要分配的传输器发送缓冲区内存量。

- #### TotalSendBufferMemory

  | 属性               | 值                             |
  | ------------------ | ------------------------------ |
  | 版本（或更高版本） | NDB 8.0.13                     |
  | 类型或单位         | 字节                           |
  | 默认值             | 0                              |
  | 范围               | 256K - 4294967039 (0xFFFFFEFF) |
  | 重启类型           | 节点重启                       |

  此参数用于确定在此节点上为所有配置的传输器分配的共享发送缓冲区内存的总量。

  如果设置此参数，最小允许值为 256KB；0 表示未设置该参数。有关详细信息，请参见[第 25.4.3.14 节，“配置 NDB Cluster 发送缓冲区参数”](#25.4.3.14-配置-ndb-cluster-发送缓冲区参数)。

- #### HeartbeatIntervalMgmdMgmd

  | 属性               | 值                            |
  | ------------------ | ----------------------------- |
  | 版本（或更高版本） | NDB 8.0.13                    |
  | 类型或单位         | 毫秒                          |
  | 默认值             | 1500                          |
  | 范围               | 100 - 4294967039 (0xFFFFFEFF) |
  | 重启类型           | 节点重启                      |

  指定心跳消息之间的间隔，用于确定另一个管理节点是否与此节点接触。管理节点在这三个间隔之后等待声明连接断开；因此，默认设置为 1500 毫秒，使管理节点在超时前等待大约 1600 毫秒。

  > **注意**
  >
  > 在管理节点的配置中进行更改后，需要执行集群的滚动重启以使新配置生效。
  >
  > 要将新管理服务器添加到正在运行的 NDB Cluster 中，还需要在修改任何现有 `config.ini` 文件后执行集群所有节点的滚动重启。有关使用多个管理节点时出现的问题的更多信息，请参见[第 25.2.7.10 节，“与多个 NDB Cluster 节点相关的限制”](#25.2.7.10-与多个-ndb-cluster-节点相关的限制)。

**重启类型**。本节参数描述中使用的重启类型信息如下表所示：

| 符号  | 描述                                                         |
| ----- | ------------------------------------------------------------ |
| **N** | 节点：可以使用滚动重启更新参数（参见 [第 25.6.5 节，“执行 NDB Cluster 的滚动重启”](#25.6.5-执行-ndb-cluster-的滚动重启)） |
| **S** | 系统：必须完全关闭集群中的所有节点，然后重新启动，才能使此参数的更改生效 |
| **I** | 初始：数据节点必须使用 `--initial` 选项重新启动              |

这些重启类型有助于理解在更新某些参数时需要采取的操作步骤。