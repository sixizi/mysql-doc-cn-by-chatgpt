### 25.3.2.1 从二进制发行版在 Windows 上安装 NDB Cluster

本节描述了使用 Oracle 提供的二进制 “no-install” NDB Cluster 发行版在 Windows 上进行基本安装的方法，使用的是本节开头所述的 4 节点设置（参见[第 25.3 节，NDB Cluster 安装](../ndb-cluster-installation.html)），如下表所示：

| 节点                | IP 地址       |
| ------------------- | ------------- |
| 管理节点 (mgmd)     | 198.51.100.10 |
| SQL 节点 (mysqld)   | 198.51.100.20 |
| 数据节点 "A" (ndbd) | 198.51.100.30 |
| 数据节点 "B" (ndbd) | 198.51.100.40 |

与其他平台一样，运行 SQL 节点的 NDB Cluster 主机必须安装 MySQL 服务器二进制文件（`mysqld.exe`）。您还应该在该主机上安装 MySQL 客户端（`mysql.exe`）。对于管理节点和数据节点，不需要安装 MySQL 服务器二进制文件；但是，每个管理节点需要管理服务器守护进程（`ndb_mgmd.exe`）；每个数据节点需要数据节点守护进程（`ndbd.exe` 或 `ndbmtd.exe`）。对于本示例，我们参考 `ndbd.exe` 作为数据节点可执行文件，但您可以安装 `ndbmtd.exe`（此程序的多线程版本），方法完全相同。您还应在管理服务器主机上安装管理客户端（`ndb_mgm.exe`）。本节介绍为每种类型的 NDB Cluster 节点安装正确的 Windows 二进制文件的必要步骤。

> **注意**  
> 与其他 Windows 程序一样，NDB Cluster 可执行文件以 .exe 文件扩展名命名。但是，从命令行调用这些程序时，不需要包含 .exe 扩展名。因此，我们在本文档中通常简单地称这些程序为 `mysqld`、`mysql`、`ndb_mgmd` 等。无论我们是指 `mysqld` 还是 `mysqld.exe`，它们都是指同一个程序（MySQL 服务器程序）。

#### 安装步骤

##### 下载和解压缩
首先，从 [https://dev.mysql.com/downloads/cluster/](https://dev.mysql.com/downloads/cluster/) 下载最新的 NDB Cluster Windows ZIP 二进制文件归档。此归档文件名为 `mysql-cluster-gpl-ver-winarch.zip`，其中 `ver` 是 NDB 存储引擎版本（例如 8.0.37），`arch` 是架构（32 表示 32 位二进制文件，64 表示 64 位二进制文件）。例如，适用于 64 位 Windows 系统的 NDB Cluster 8.0.37 归档文件名为 `mysql-cluster-gpl-8.0.37-win64.zip`。

您可以在 32 位和 64 位版本的 Windows 上运行 32 位 NDB Cluster 二进制文件；但是，64 位 NDB Cluster 二进制文件只能在 64 位版本的 Windows 上使用。如果在具有 64 位 CPU 的计算机上使用 32 位版本的 Windows，则必须使用 32 位 NDB Cluster 二进制文件。

为了最小化需要从 Internet 下载或在机器之间复制的文件数量，我们从您打算运行 SQL 节点的计算机开始。

##### SQL 节点

假设您已将归档文件的副本放在 IP 地址为 198.51.100.20 的计算机的 `C:\Documents and Settings\username\My Documents\Downloads` 目录中，其中 `username` 是当前用户的名称。（您可以在命令行中使用 `ECHO %USERNAME%` 获取此名称。）要作为 Windows 服务安装和运行 NDB Cluster 可执行文件，此用户应为 Administrators 组的成员。

1. 解压所有文件。Windows 资源管理器集成的解压向导可以胜任此任务。（如果您使用其他归档程序，请确保它解压缩归档中的所有文件和目录，并保留归档的目录结构。）当要求输入目标目录时，输入 `C:\`，这将使解压向导将归档解压到目录 `C:\mysql-cluster-gpl-ver-winarch`。将此目录重命名为 `C:\mysql`。

可以将 NDB Cluster 二进制文件安装到 `C:\mysql\bin` 以外的目录中；但是，如果这样做，则必须相应地修改本程序中的路径。特别是，如果 MySQL 服务器（SQL 节点）二进制文件安装在 `C:\mysql` 或 `C:\Program Files\MySQL\MySQL Server 8.0` 之外的位置，或者如果 SQL 节点的数据目录位于 `C:\mysql\data` 或 `C:\Program Files\MySQL\MySQL Server 8.0\data` 之外的位置，则必须在启动 SQL 节点时在命令行上使用其他配置选项或将其添加到 `my.ini` 或 `my.cnf` 文件中。有关在非标准位置运行 MySQL 服务器的配置信息，请参见[第 2.3.4 节，使用 noinstall ZIP 归档在 Microsoft Windows 上安装 MySQL](../installation/noinstall-zip.html)。

要使支持 NDB Cluster 的 MySQL 服务器作为 NDB Cluster 的一部分运行，必须使用 `--ndbcluster` 和 `--ndb-connectstring` 选项启动它。虽然您可以在命令行上指定这些选项，但通常将它们放在选项文件中更方便。为此，请在记事本或其他文本编辑器中创建一个新文本文件。将以下配置信息输入此文件：

```ini
[mysqld]
# Options for mysqld process:
ndbcluster                       # run NDB storage engine
ndb-connectstring=198.51.100.10  # location of management server
```

如果需要，您可以添加此 MySQL 服务器使用的其他选项（请参见[第 2.3.4.2 节，创建选项文件](../installation/noinstall-zip.html#option-file)），但该文件必须至少包含所示的选项。将此文件保存为 `C:\mysql\my.ini`。至此，SQL 节点的安装和设置完成。

##### 数据节点

Windows 主机上的 NDB Cluster 数据节点只需要一个可执行文件，即 `ndbd.exe` 或 `ndbmtd.exe` 中的一个。对于本示例，假设您使用 `ndbd.exe`，但使用 `ndbmtd.exe` 时相同的说明适用。在每台您希望运行数据节点的计算机（IP 地址为 198.51.100.30 和 198.51.100.40）上，创建目录 `C:\mysql`、`C:\mysql\bin` 和 `C:\mysql\cluster-data`；然后，在下载并解压 no-install 归档的计算机上，找到 `C:\mysql\bin` 目录中的 `ndbd.exe`。将此文件复制到每个数据节点主机的 `C:\mysql\bin` 目录中。

要作为 NDB Cluster 的一部分运行，每个数据节点必须提供管理服务器的地址或主机名。可以在启动每个数据节点进程时使用命令行上的 `--ndb-connectstring` 或 `-c` 选项提供此信息。不过，通常最好将此信息放在选项文件中。为此，请在记事本或其他文本编辑器中创建一个新文本文件并输入以下文本：

```ini
[mysql_cluster]
# Options for data node process:
ndb-connectstring=198.51.100.10  # location of management server
```

将此文件保存为数据节点主机上的 `C:\mysql\my.ini`。在另一个数据节点主机上创建包含相同信息的另一个文本文件，并将其保存为 `C:\mysql\my.ini`，或者将第一个数据节点主机上的 `my.ini` 文件复制到第二个数据节点主机上，并确保将副本放在第二个数据节点的 `C:\mysql` 目录中。现在，两个数据节点主机都准备好在 NDB Cluster 中使用，只剩下管理节点需要安装和配置。

##### 管理节点

托管 NDB Cluster 管理节点的计算机上所需的唯一可执行程序是管理服务器程序 `ndb_mgmd.exe`。但是，为了在启动 NDB Cluster 后进行管理，还应在管理服务器所在的同一台机器上安装 NDB Cluster 管理客户端程序 `ndb_mgm.exe`。在下载并解压 no-install 归档的机器上找到这两个程序；这应该是 SQL 节点主机上的 `C:\mysql\bin` 目录。在 IP 地址为 198.51.100.10 的计算机上创建目录 `C:\mysql\bin`，然后将这两个程序复制到该目录中。

现在，您应该为 `ndb_m