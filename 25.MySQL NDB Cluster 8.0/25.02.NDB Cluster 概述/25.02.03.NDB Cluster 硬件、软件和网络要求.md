### 25.2.3 NDB Cluster 硬件、软件和网络要求

NDB Cluster 的一个优势是可以在普通硬件上运行，除了需要大量 RAM 外，没有其他特殊要求，因为所有实时数据存储都是在内存中完成的。（可以使用磁盘数据表来减少这个要求——有关这些的更多信息，请参见第 25.6.11 节，“[NDB Cluster 磁盘数据表](#ndb-cluster-disk-data-tables)”。）当然，多核和更快的 CPU 可以提高性能。其他 NDB Cluster 进程的内存需求相对较小。

NDB Cluster 的软件要求也很简单。主机操作系统不需要任何特殊的模块、服务、应用程序或配置来支持 NDB Cluster。对于支持的操作系统，标准安装应该足够。MySQL 的软件要求很简单：只需要一个生产版本的 NDB Cluster。为了使用 NDB Cluster，不需要自己编译 MySQL。我们假设你正在使用适合你平台的二进制文件，这些文件可以从 [NDB Cluster 软件下载页面](https://dev.mysql.com/downloads/cluster/) 获取。

对于节点之间的通信，NDB Cluster 支持任何标准拓扑中的 TCP/IP 网络，每个主机的最低要求是标准的 100 Mbps 以太网卡，以及一个交换机、集线器或路由器，以提供集群整体的网络连接。我们强烈建议 NDB Cluster 运行在自己的子网上，不与不属于集群的机器共享子网，原因如下：

- **安全性**。NDB Cluster 节点之间的通信未加密或以任何方式屏蔽。保护 NDB Cluster 内部传输的唯一方法是运行在受保护的网络上。如果你打算将 NDB Cluster 用于 Web 应用程序，集群应位于防火墙之后，而不是在网络的非军事区（DMZ）或其他地方。

  有关更多信息，请参见第 25.6.20.1 节，“[NDB Cluster 的安全性和网络问题](#ndb-cluster-security-and-networking-issues)”。

- **效率**。在私有或受保护的网络上设置 NDB Cluster 使集群能够独占集群主机之间的带宽。为 NDB Cluster 使用单独的交换机不仅有助于防止未授权访问 NDB Cluster 数据，还确保 NDB Cluster 节点免受网络上其他计算机之间传输引起的干扰。为了增强可靠性，你可以使用双交换机和双网卡，以消除网络作为单点故障的可能性；许多设备驱动程序支持这种通信链接的故障转移。


**网络通信和延迟**。NDB Cluster 需要数据节点和 API 节点（包括 SQL 节点）之间，以及数据节点和其他数据节点之间进行通信以执行查询和更新。这些进程之间的通信延迟会直接影响用户查询的性能和延迟。此外，为了在节点无声故障的情况下保持一致性和服务，NDB Cluster 使用心跳和超时机制，将节点的长时间通信中断视为节点故障。这可能会导致冗余减少。请记住，为了保持数据一致性，当节点组中的最后一个节点发生故障时，NDB Cluster 将关闭。因此，为避免增加强制关闭的风险，应尽量避免节点之间的通信中断。

数据节点或 API 节点的故障会导致涉及故障节点的所有未提交事务中止。数据节点恢复需要从存活数据节点同步失败节点的数据，并重新建立基于磁盘的重做和检查点日志，然后数据节点才能重新投入服务。此恢复可能需要一些时间，在此期间，集群以减少的冗余运行。

心跳依赖于所有节点及时生成心跳信号。如果节点过载、由于与其他程序共享而 CPU 不足或因交换而出现延迟，则可能无法生成心跳信号。如果心跳生成延迟过长，其他节点会将响应缓慢的节点视为故障节点。

在某些情况下，这种将缓慢节点视为故障节点的处理方式可能是也可能不是理想的，具体取决于节点运行缓慢对集群其他部分的影响。在为 NDB Cluster 设置 `HeartbeatIntervalDbDb` 和 `HeartbeatIntervalDbApi` 等超时值时，必须谨慎，以实现快速检测、故障转移和恢复，同时避免潜在的昂贵误报。

如果预计数据节点之间的通信延迟比 LAN 环境中预期的高（约 100 微秒），则必须增加超时参数，以确保允许的延迟周期在配置的超时内。以这种方式增加超时会对检测故障的最坏时间和恢复服务的时间产生相应影响。

LAN 环境通常可以配置为具有稳定的低延迟，并且可以提供具有快速故障转移的冗余。个别链路故障可以通过最小和受控的 TCP 级别可见延迟来恢复（NDB Cluster 通常在此级别操作）。WAN 环境可能提供一系列的延迟，以及具有较慢故障转移时间的冗余。个别链路故障可能需要路由更改传播，然后端到端连接才能恢复。在 TCP 级别，这可能表现为单个通道上的大延迟。在这些情况下，最坏情况下观察到的 TCP 延迟与 IP 层绕过故障重新路由的最坏时间相关。