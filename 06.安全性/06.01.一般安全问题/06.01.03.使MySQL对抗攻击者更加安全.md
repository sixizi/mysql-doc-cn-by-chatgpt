#### 6.1.3 使 MySQL 对抗攻击者更安全

当您连接到 MySQL 服务器时，应该使用密码。密码在连接过程中不会以明文传输。

所有其他信息都以文本形式传输，任何能监视连接的人都可以阅读。如果客户端和服务器之间的连接通过不受信任的网络，而您对此感到担忧，您可以使用压缩协议使流量更难以解读。您还可以使用 MySQL 的内部 SSL 支持来使连接更加安全。参见第 6.3 节，“使用加密连接”。或者，使用 SSH 获取 MySQL 服务器和 MySQL 客户端之间的加密 TCP/IP 连接。您可以在 http://www.openssh.org/ 找到开源 SSH 客户端，以及在 http://en.wikipedia.org/wiki/Comparison_of_SSH_clients 查看开源和商业 SSH 客户端的比较。

为了使 MySQL 系统安全，您应该认真考虑以下建议：

- 要求所有 MySQL 账户都有密码。客户端程序未必知道运行它的人的身份。用户可以向客户端程序指定任何用户名是客户端/服务器应用程序的常见情况。例如，如果 other_user 没有密码，任何人都可以通过以 mysql -u other_user db_name 的形式调用 mysql 程序来以其他人的身份连接。如果所有账户都有密码，使用另一个用户的账户进行连接变得更加困难。

  有关设置密码的方法的讨论，请参见第 6.2.14 节，“分配账户密码”。

- 确保只有用于运行 mysqld 的 Unix 用户账户在数据库目录中拥有读写权限。

- 永远不要以 Unix root 用户运行 MySQL 服务器。这非常危险，因为任何具有 FILE 权限的用户都能使服务器以 root 创建文件（例如，~root/.bashrc）。为了防止这种情况，除非使用 --user=root 选项明确指定，否则 mysqld 会拒绝以 root 身份运行。

  mysqld 可以（并且应该）作为一个普通的、无特权的用户运行。您可以创建一个名为 mysql 的单独 Unix 账户来使一切更加安全。只使用此账户来管理 MySQL。要以不同的 Unix 用户启动 mysqld，请在 my.cnf 选项文件的 [mysqld] 组中添加一个指定用户名的 user 选项。例如：

  ```bash
  [mysqld]
  user=mysql
  ```

  无论您是手动启动还是使用 **mysqld_safe** 或 **mysql.server**，这都会使服务器以指定的用户身份启动。更多详情，请参见第 6.1.5 节，“如何以普通用户身份运行 MySQL”。

  以非 root 用户身份运行 **mysqld** 并不意味着您需要更改 user 表中的 root 用户名。MySQL 账户的用户名与 Unix 账户的用户名没有任何关系。

- 不要向非管理用户授予 FILE 权限。任何拥有此权限的用户都可以以 **mysqld** 守护进程的权限在文件系统的任何地方写文件。这包括实现权限表的文件所在的服务器数据目录。为了使 FILE 权限操作更安全一些，`SELECT ... INTO OUTFILE` 生成的文件不会覆盖现有文件，并且所有人都可以写入。

  FILE 权限也可用于读取任何人可读取或对服务器运行的 Unix 用户可访问的文件。有了这个权限，您可以将任何文件读入数据库表。例如，这可能被滥用，通过使用 LOAD DATA 将 /etc/passwd 加载到表中，然后可以通过 SELECT 显示。

  要限制文件可读写的位置，请将 `secure_file_priv `系统变量设置为特定目录。参见第 5.1.8 节，“服务器系统变量”。

- 加密二进制日志文件和中继日志文件。加密有助于保护这些文件及其中包含的潜在敏感数据免受外部攻击者的滥用，并且还可以防止存储它们的操作系统中的未授权用户查看。通过将 binlog_encryption 系统变量设置为 ON，可以在 MySQL 服务器上启用加密。有关更多信息，请参见第 17.3.2 节，“加密二进制日志文件和中继日志文件”。

- 不要向非管理用户授予 PROCESS 或 SUPER 权限。`mysqladmin processlist` 和 `SHOW PROCESSLIS`T 的输出显示当前正在执行的任何语句的文本，因此任何被允许查看服务器进程列表的用户都可能能够看到其他用户发出的语句。

  mysqld 为拥有 `CONNECTION_ADMIN` 或 `SUPER `权限的用户保留了一个额外的连接，这样 MySQL root 用户即使所有正常连接都在使用中也可以登录并检查服务器活动。

  SUPER 权限可用于终止客户端连接、通过更改系统变量的值改变服务器操作，并控制复制服务器。

- 不要允许使用指向表的符号链接。（可以使用` --skip-symbolic-links` 选项禁用此功能。）如果您以 root 身份运行 mysqld，这一点尤其重要，因为任何有权访问服务器数据目录的人都可以删除系统中的任何文件！参见第 8.12.2.2 节，“在 Unix 上使用符号链接用于 MyISAM 表”。


- 存储程序和视图应按照第 25.6 节，“存储对象访问控制”中讨论的安全指南编写。


- 如果您不信任您的 DNS，您应该在授权表中使用 IP 地址而不是主机名。无论如何，您应该非常小心地使用包含通配符的主机名值创建授权表条目。


- 如果您想限制单个账户允许的连接数量，可以通过设置 mysqld 中的 max_user_connections 变量来实现。CREATE USER 和 ALTER USER 语句也支持资源控制选项，以限制账户允许的服务器使用范围。参见第 13.7.1.3 节，“CREATE USER 语句”，和第 13.7.1.1 节，“ALTER USER 语句”。


- 如果服务器可写的插件目录，用户可能可以使用` SELECT ... INTO DUMPFILE` 将可执行代码写入该目录中的文件。通过将 plugin_dir 设置为对服务器只读或将 `secure_file_priv `设置为可以安全地进行 SELECT 写入的目录，可以防止这种情况。