#### 19.1.2.4 获取复制源二进制日志坐标

为了配置副本在正确的点开始复制过程，您需要记录源的当前二进制日志内的坐标。

> 警告
>
> 此程序使用 `FLUSH TABLES WITH READ LOCK`，它会阻塞 InnoDB 表的 `COMMIT` 操作。

如果您计划关闭源以创建数据快照，您可以选择跳过此程序，并存储二进制日志索引文件的副本以及数据快照。在那种情况下，源在重新启动时会创建一个新的二进制日志文件。因此，副本必须开始复制过程的源二进制日志坐标是那个新文件的开始，即在复制的二进制日志索引文件中列出的文件之后的下一个二进制日志文件。

要获得源二进制日志坐标，请按照以下步骤操作：

1. 通过命令行客户端连接到源，启动一个会话，并通过执行 `FLUSH TABLES WITH READ LOCK` 语句来刷新所有表并阻塞写语句：

   ```mysql
   mysql> FLUSH TABLES WITH READ LOCK;
   ```
   
   > **警告**
   >
   > 让您发出 `FLUSH TABLES` 语句的客户端保持运行状态，以便读锁保持有效。如果您退出客户端，锁将被释放。
2. 在源的另一个会话中，使用 `SHOW MASTER STATUS` 语句来确定当前二进制日志文件名和位置：

    ```sql
    mysql> SHOW MASTER STATUS\G
    *************************** 1. row ***************************
                 File: mysql-bin.000003
             Position: 73
         Binlog_Do_DB: test
     Binlog_Ignore_DB: manual, mysql
    Executed_Gtid_Set: 3E11FA47-71CA-11E1-9E33-C80AA9429562:1-5
    1 row in set (0.00 sec)
    ```

    `File` 列显示日志文件的名称，`Position` 列显示文件内的位置。在此示例中，二进制日志文件是 `mysql-bin.000003`，位置是 73。记录这些值。在您设置副本时，稍后需要它们。它们代表副本应该开始处理来自源的新更新的复制坐标。

    如果源之前以禁用二进制日志的方式运行，`SHOW MASTER STATUS` 或 `mysqldump --master-data` 显示的日志文件名和位置值为空。在那种情况下，稍后指定源的二进制日志文件和位置时需要使用的值是空字符串 ('') 和 4。

您现在拥有启用副本从源的二进制日志中正确位置开始读取以启动复制所需的信息。

下一步取决于源上是否有现有数据。选择以下选项之一：

- 如果您有需要与副本同步的现有数据，在您开始复制之前，请让客户端运行以保持锁定状态。这可以防止进行任何进一步的更改，以便复制到副本的数据与源保持同步。继续进行第19.1.2.5节，“选择数据快照方法”。


- 如果您正在设置一个新的源和副本组合，您可以退出第一个会话以释放读锁。参见第19.1.2.6.1节，“使用新源和副本设置复制”以了解如何继续。