### 19.5.1.29 复制过程中的副本错误

如果一个语句在源和副本上产生相同的错误（相同的错误代码），则该错误会被记录，但复制会继续。

如果一个语句在源和副本上产生不同的错误，复制 SQL 线程将终止，并且副本会将一条消息写入其错误日志，并等待数据库管理员决定如何处理该错误。这包括在源或副本上产生错误，但不是两者都产生的情况。要解决此问题，请手动连接到副本并确定问题的原因。`SHOW REPLICA STATUS`（或在 MySQL 8.0.22 之前，`SHOW SLAVE STATUS`）在此非常有用。然后解决问题并运行 `START REPLICA`（或在 MySQL 8.0.22 之前，`START SLAVE`）。例如，您可能需要创建一个不存在的表，然后才能再次启动副本。

注意：
如果副本的错误日志中记录了一个临时错误，您不必一定采取错误消息中建议的任何措施。客户端应该通过重试事务来处理临时错误。例如，如果复制 SQL 线程记录了一个与死锁有关的临时错误，除非复制 SQL 线程随后以非临时错误消息终止，否则您无需在副本上手动重启事务。

如果不希望有此错误代码验证行为，可以通过 `--slave-skip-errors` 选项屏蔽（忽略）部分或全部错误。

对于非事务性存储引擎（如 MyISAM），可能出现只部分更新表并返回错误代码的语句。例如，在多行插入中有一行违反键约束，或者在更新部分行后被终止的长更新语句。如果这种情况发生在源上，副本期望语句的执行导致相同的错误代码。如果不是这样，如前所述，复制 SQL 线程将停止。

如果您在源和副本上使用不同存储引擎的表之间进行复制，请记住，相同的语句可能在对一个版本的表运行时产生不同的错误，但在另一个版本的表上可能不会，或者可能对一个版本的表造成错误，但对另一个版本的表则不会。例如，由于 MyISAM 忽略外键约束，访问源上 InnoDB 表的 `INSERT` 或 `UPDATE` 语句可能导致外键违规，但在副本上对同一表的 MyISAM 版本执行相同的语句不会产生此类错误，导致复制停止。

从 MySQL 8.0.31 开始，复制过滤规则首先被应用，在进行任何权限或行格式检查之前，使得可以过滤掉未通过验证的任何事务；对已被过滤掉的事务不进行检查，因此不会引发错误。这意味着副本只能接受已授予给定用户访问权限的数据库部分（只要对该数据库部分的更新使用基于行的复制格式）。在进行升级或迁移到使用入站复制用户无权访问的管理表的系统或应用程序时，这可能会有所帮助。另请参见第 19.2.5 节，“服务器如何评估复制过滤规则”。