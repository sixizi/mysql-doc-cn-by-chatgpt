### 19.5.5 如何报告复制错误或问题

当您确定没有用户错误涉及，并且复制仍然不工作或不稳定时，是时候向我们提交错误报告了。我们需要从您那里获取尽可能多的信息，以便能够追踪到错误。请花费一些时间和精力准备一个好的错误报告。

如果您有一个可重复的测试用例可以展示这个错误，请按照第 1.5 节“如何报告错误或问题”的指示将其输入到我们的错误数据库中。如果您遇到一个“幽灵”问题（一个您无法随意复制的问题），请使用以下程序：

1. 验证没有用户错误涉及。例如，如果您在复制线程之外更新副本，数据将不同步，您可能在更新时遇到唯一键违规。在这种情况下，复制线程停止并等待您手动清理表以使它们同步。这不是一个复制问题。这是外部干扰导致复制失败的问题。

2. 确保副本启用了二进制日志记录（`log_bin` 系统变量），并启用了 `--log-slave-updates` 选项，这会导致副本将其从源接收的更新记录到自己的二进制日志中。这些设置是默认设置。

3. 在重置复制状态之前保存所有证据。如果我们没有信息或只有模糊的信息，对我们来说追踪问题变得困难或不可能。您应该收集的证据包括：

   - 来自源的所有二进制日志文件

   - 来自副本的所有二进制日志文件

   - 在您发现问题时，源的 `SHOW MASTER STATUS` 的输出

   - 在您发现问题时，副本的 `SHOW REPLICA STATUS` 的输出

   - 来自源和副本的错误日志


4. 使用 `mysqlbinlog` 检查二进制日志。以下应有助于找到问题语句。`log_file` 和 `log_pos` 是从 `SHOW REPLICA STATUS` 中获取的 `Master_Log_File` 和 `Read_Master_Log_Pos` 值。

    ```bash
    $> mysqlbinlog --start-position=log_pos log_file | head
    ```

在您收集了问题的证据后，首先尝试将其隔离为一个单独的测试用例。然后按照第 1.5 节“如何报告错误或问题”的指示，尽可能多地提供信息将问题输入到我们的错误数据库中。