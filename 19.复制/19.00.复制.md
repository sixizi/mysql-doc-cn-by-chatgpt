# 第 19 章 复制

**目录**

- [19.1 配置复制](./19.01.配置复制/19.01.00.配置复制.md)

- [19.2 复制实现](./19.02.复制实现/19.02.00.复制实现.md)
- [19.3 复制安全](./19.03.复制安全/19.03.00.复制安全.md)
- [19.4 复制方案](./19.04.复制方案/19.04.00.复制方案.md)
- [19.5 复制注意事项和提示](./19.05.复制注意事项和提示/19.05.00.复制注意事项和提示.md)

复制允许从一个 MySQL 数据库服务器（称为源服务器）的数据被复制到一个或多个 MySQL 数据库服务器（称为副本）。默认情况下，复制是异步的；副本不需要永久连接到源服务器即可接收更新。根据配置，您可以复制所有数据库、选定的数据库，甚至数据库中的选定表。

MySQL 中复制的优点包括：

- 扩展解决方案 - 将负载分散到多个副本中以提高性能。在这种环境中，所有写入和更新必须在源服务器上进行。然而，读取操作可以在一个或多个副本上进行。这种模型可以提高写入性能（因为源服务器专用于更新），同时在不断增加的副本数量中显著提高读取速度。

- 数据安全 - 因为副本可以暂停复制过程，所以可以在副本上运行备份服务而不会损坏相应的源数据。

- 分析 - 在源服务器上可以创建实时数据，而信息的分析可以在副本上进行，而不影响源服务器的性能。

- 长距离数据分发 - 您可以使用复制为远程站点创建数据的本地副本，无需永久访问源。


有关在这些场景中使用复制的信息，请参见第 19.4 节，“复制方案”。

MySQL 8.0 支持不同的复制方法。传统方法基于从源的二进制日志复制事件，并且需要在源和副本之间同步日志文件和其中的位置。基于全局事务标识符（GTIDs）的较新方法是事务性的，因此不需要处理日志文件或这些文件中的位置，这大大简化了许多常见的复制任务。使用 GTIDs 的复制保证了源和副本之间的一致性，只要源上提交的所有事务也已在副本上应用。有关 GTIDs 和基于 GTID 的复制在 MySQL 中的更多信息，请参见第 19.1.3 节，“使用全局事务标识符的复制”。有关使用二进制日志文件位置基础复制的信息，请参见第 19.1 节，“配置复制”。

MySQL 中的复制支持不同类型的同步。原始类型的同步是一种单向的异步复制，在这种模式下，一个服务器充当源，而一个或多个其他服务器充当副本。这与 NDB 集群（见第 25 章，MySQL NDB 集群 8.0）的特性——同步复制形成对比。在 MySQL 8.0 中，除了内置的异步复制之外，还支持半同步复制。在半同步复制中，源上的提交在至少一个副本确认它已接收并记录了该事务的事件之前，会阻塞返回给执行事务的会话；参见第 19.4.10 节，“半同步复制”。MySQL 8.0 还支持延迟复制，即副本故意落后于源至少指定的时间量；参见第 19.4.11 节，“延迟复制”。对于需要同步复制的场景，请使用 NDB 集群（见第 25 章，MySQL NDB 集群 8.0）。

有许多解决方案可用于在服务器之间设置复制，使用哪种方法最好取决于数据的存在以及您使用的引擎类型。有关可用选项的更多信息，请参见第 19.1.2 节，“设置基于二进制日志文件位置的复制”。

复制有两种核心类型的格式，基于语句的复制（SBR），复制整个 SQL 语句，以及基于行的复制（RBR），仅复制更改的行。您还可以使用第三种类型，混合基础复制（MBR）。有关不同复制格式的更多信息，请参见第 19.2.1 节，“复制格式”。

复制通过许多不同的选项和变量进行控制。有关更多信息，请参见第 19.1.6 节，“复制和二进制日志选项及变量”。可以对复制拓扑应用额外的安全措施，如第 19.3 节，“复制安全”所述。

您可以使用复制来解决许多不同的问题，包括性能、支持不同数据库的备份，以及作为缓解系统故障的更大解决方案的一部分。有关如何解决这些问题的信息，请参见第 19.4 节，“复制方案”。

有关复制期间如何处理不同数据类型和语句的注意事项和提示，包括复制功能的详细信息、版本兼容性、升级，以及潜在问题及其解决方案，请参见第 19.5 节，“复制注意事项和提示”。对于那些刚接触 MySQL 复制的人经常问的一些问题的答案，请参见 A.14 节，“MySQL 8.0 常见问题解答：复制”。

有关复制实现的详细信息，包括复制工作方式、二进制日志的过程和内容、后台线程以及用于决定如何记录和复制语句的规则，请参见第 19.2 节，“复制实现”。
