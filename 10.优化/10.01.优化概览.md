## 10.1 优化概览

数据库性能取决于多个因素，例如表、查询和配置设置。这些软件构造在硬件层面上会产生 CPU 和 I/O 操作，您必须尽量减少并尽可能高效地执行这些操作。在进行数据库性能优化时，您需要从学习软件方面的高级规则和指导原则开始，并通过墙钟时间来衡量性能。随着您逐渐成为专家，您会更多地了解内部发生的事情，并开始衡量诸如 CPU 周期和 I/O 操作等因素。

典型用户希望从现有的软件和硬件配置中获得最佳的数据库性能。高级用户则寻找改进 MySQL 软件本身的机会，或开发自己的存储引擎和硬件设备来扩展 MySQL 生态系统。

- [在数据库级别优化](#在数据库级别优化)
- [在硬件级别优化](#在硬件级别优化)
- [平衡可移植性和性能](#平衡可移植性和性能)

### 在数据库级别优化

使数据库应用程序快速运行的最重要因素是其基本设计：

- 表的结构是否合理？特别是，列是否具有正确的数据类型，每个表是否有适合该类型工作的适当列？例如，经常进行更新的应用程序通常有许多列较少的表，而分析大量数据的应用程序通常有少数几个列较多的表。


- 是否有正确的索引来使查询高效？


- 您是否为每个表使用了适当的存储引擎，并利用了您使用的每个存储引擎的优势和特性？特别是，选择事务型存储引擎如 InnoDB 或非事务型存储引擎如 MyISAM 对于性能和可扩展性非常重要。

  > 注意
  > InnoDB 是新表的默认存储引擎。实际上，InnoDB 的高级性能特性意味着 InnoDB 表通常比较简单的 MyISAM 表表现更好，特别是对于繁忙的数据库。

- 每个表是否使用了适当的行格式？这个选择也取决于用于该表的存储引擎。特别是，压缩表使用较少的磁盘空间，因此需要较少的磁盘 I/O 来读写数据。InnoDB 表适用于所有类型的工作负载的压缩，而 MyISAM 表则仅适用于只读。


- 应用程序是否使用了适当的锁定策略？例如，允许共享访问以便数据库操作可以并发运行，并在适当时请求独占访问以便关键操作获得最高优先级。同样，存储引擎的选择也很重要。InnoDB 存储引擎可以在不涉及您的情况下处理大多数锁定问题，从而在数据库中提供更好的并发性并减少您的代码调优和实验。


- 是否正确地配置了用于缓存的所有内存区域？即，足够大以容纳频繁访问的数据，但又不至于过大导致超载物理内存和分页。主要配置的内存区域包括 InnoDB 缓冲池和 MyISAM 关键缓存。


### 在硬件级别优化

任何数据库应用程序最终都会因数据库变得越来越繁忙而遇到硬件限制。数据库管理员必须评估是否可以通过调整应用程序或重新配置服务器来避免这些瓶颈，或者是否需要更多的硬件资源。系统瓶颈通常源于以下来源：

- 磁盘寻道。磁盘查找数据片段需要时间。对于现代磁盘，这个时间通常低于 10 毫秒，因此我们理论上每秒可以进行约 100 次寻道。随着新磁盘的出现，这个时间缓慢改善，但很难针对单个表进行优化。优化寻道时间的方法是将数据分布到多个磁盘上。


- 磁盘读写。当磁盘位于正确位置时，我们需要读取或写入数据。对于现代磁盘，一个磁盘的吞吐量至少为 10-20MB/s。这比寻道更容易优化，因为您可以从多个磁盘并行读取。


- CPU 周期。当数据在主内存中时，我们必须处理它以得到我们的结果。与内存量相比，大表是最常见的限制因素。但对于小表来说，速度通常不是问题。


- 内存带宽。当 CPU 需要的数据超过 CPU 缓存容量时，主内存带宽成为瓶颈。这对于大多数系统来说是一个不常见的瓶颈，但需要注意。


### 平衡可移植性和性能

要在可移植的 MySQL 程序中使用面向性能的 SQL 扩展，您可以将 MySQL 特定关键字放在 /*! */ 注释分隔符中的语句中。其他 SQL 服务器会忽略被注释的关键字。有关编写注释的信息，请参阅第 11.7 节，“注释”。