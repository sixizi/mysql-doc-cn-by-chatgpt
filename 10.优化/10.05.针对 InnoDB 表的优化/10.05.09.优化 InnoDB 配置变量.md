### 10.5.9 优化 InnoDB 配置变量

不同的设置适用于负载轻且可预测的服务器，与始终运行在接近满负荷或经历高活动高峰的服务器不同。

由于 InnoDB 存储引擎自动执行许多优化，因此许多性能调整任务涉及监控以确保数据库运行良好，并在性能下降时更改配置选项。有关详细的 InnoDB 性能监控信息，请参见第 17.16 节，“`InnoDB 与 MySQL 性能模式的集成`”。

主要配置步骤包括：

- **控制 InnoDB 缓冲已更改数据的数据更改操作类型**：以避免频繁的小磁盘写入。请参见配置更改缓冲。由于默认情况下缓冲所有类型的数据更改操作，仅在需要减少缓冲量时更改此设置。

- **启用或禁用自适应哈希索引功能**：使用 `innodb_adaptive_hash_index` 选项。详见第 17.5.3 节，“`自适应哈希索引`”。您可能会在异常活动期间更改此设置，然后恢复到原始设置。

- **设置 InnoDB 处理的并发线程数的限制**：如果上下文切换是瓶颈。请参见第 17.8.4 节，“`配置 InnoDB 的线程并发性`”。

- **控制 InnoDB 在读取操作中执行的预取量**：当系统有未使用的 I/O 容量时，更多的预取可以提高查询性能。过多的预取可能会在负载繁重的系统上导致周期性的性能下降。请参见第 17.8.3.4 节，“`配置 InnoDB 缓冲池预取（读前）`”。

- **增加读或写操作的后台线程数**：如果您有一个高端 I/O 子系统，而默认值没有充分利用它。请参见第 17.8.5 节，“`配置后台 InnoDB I/O 线程数`”。

- **控制 InnoDB 在后台执行的 I/O 量**：请参见第 17.8.7 节，“`配置 InnoDB I/O 容量`”。如果观察到周期性的性能下降，可以减少此设置。

- **控制 InnoDB 执行某些类型的后台写入的算法**：请参见第 17.8.3.5 节，“`配置缓冲池刷新`”。该算法适用于某些类型的工作负载，但不适用于其他类型，因此如果观察到周期性的性能下降，可以禁用此功能。

- **利用多核处理器及其缓存内存配置**：以最小化上下文切换的延迟。请参见第 17.8.8 节，“`配置自旋锁轮询`”。

- **防止一次性操作（如表扫描）干扰 InnoDB 缓冲缓存中频繁访问的数据**：请参见第 17.8.3.3 节，“`使缓冲池扫描具有抵抗力`”。

- **将日志文件调整到适合可靠性和崩溃恢复的大小**：InnoDB 日志文件通常保持较小，以避免崩溃后的长启动时间。MySQL 5.5 引入的优化加快了崩溃恢复过程的某些步骤。特别是，由于改进的内存管理算法，扫描重做日志和应用重做日志的速度更快。如果您一直将日志文件保持得非常小以避免长启动时间，现在可以考虑增加日志文件大小，以减少重做日志记录回收时发生的 I/O。

- **配置 InnoDB 缓冲池的大小和实例数**：对于具有多千兆字节缓冲池的系统尤为重要。请参见第 17.8.3.2 节，“`配置多个缓冲池实例`”。

- **增加最大并发事务数**：这显著提高了最繁忙数据库的可扩展性。请参见第 17.6.6 节，“`撤销日志`”。

- **将清除操作（一种垃圾回收类型）移至后台线程**：请参见第 17.8.9 节，“`清除配置`”。要有效地测量此设置的结果，请首先调整其他 I/O 相关和线程相关的配置设置。

- **减少 InnoDB 在并发线程之间的切换次数**：这样繁忙服务器上的 SQL 操作不会排队并形成“交通堵塞”。为 `innodb_thread_concurrency` 选项设置一个值，对于高性能现代系统，这个值通常在 32 左右。将 `innodb_concurrency_tickets` 选项的值通常设置为 5000 左右。这个选项组合为 InnoDB 在任意时间处理的线程数设定一个上限，并允许每个线程在被换出之前完成大量工作，从而使等待线程数保持较低，操作可以在不进行过多上下文切换的情况下完成。