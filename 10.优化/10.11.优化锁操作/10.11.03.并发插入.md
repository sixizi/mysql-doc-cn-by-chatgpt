### 10.11.3 并发插入

`MyISAM` 存储引擎支持并发插入，以减少读写之间对给定表的争用：如果一个 `MyISAM` 表的数据文件中没有空洞（中间没有被删除的行），则在执行 `INSERT` 语句将行添加到表的末尾时，`SELECT` 语句可以同时从表中读取行。如果有多个 `INSERT` 语句，它们会排队并按顺序执行，与 `SELECT` 语句同时进行。并发插入的结果可能不会立即可见。

`concurrent_insert` 系统变量可以设置以修改并发插入的处理方式。默认情况下，该变量设置为 `AUTO`（或 `1`），并发插入如上所述处理。如果将 `concurrent_insert` 设置为 `NEVER`（或 `0`），则禁用并发插入。如果将该变量设置为 `ALWAYS`（或 `2`），则即使对于有已删除行的表，也允许在表末尾进行并发插入。另请参见 `concurrent_insert` 系统变量的描述。

如果您使用二进制日志，`CREATE ... SELECT` 或 `INSERT ... SELECT` 语句的并发插入将转换为普通插入。这是为了确保在备份操作期间应用日志时可以重新创建表的精确副本。请参见 [7.4.4节，二进制日志](#7.4.4)。此外，对于这些语句，在选定的表上放置了读锁，以阻止对该表的插入。因此，该表的并发插入也必须等待。

使用 `LOAD DATA` 时，如果为满足并发插入条件的 `MyISAM` 表指定 `CONCURRENT`，则在 `LOAD DATA` 执行时其他会话可以从表中检索数据。即使没有其他会话同时使用该表，使用 `CONCURRENT` 选项也会稍微影响 `LOAD DATA` 的性能。

如果指定 `HIGH_PRIORITY`，它将覆盖服务器启动时使用的 `--low-priority-updates` 选项的效果。它还会导致不使用并发插入。

对于 `LOCK TABLE`，`READ LOCAL` 和 `READ` 之间的区别在于 `READ LOCAL` 允许在持有锁期间执行不冲突的 `INSERT` 语句（并发插入）。但是，如果在持有锁期间将使用外部进程操作数据库，则不能使用此选项。