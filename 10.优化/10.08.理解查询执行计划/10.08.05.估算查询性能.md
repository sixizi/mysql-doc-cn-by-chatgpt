### 10.8.5 估算查询性能

在大多数情况下，您可以通过计算磁盘查找次数来估算查询性能。对于小表，通常只需一次磁盘查找即可找到一行（因为索引可能已经被缓存）。对于较大的表，使用 B-tree 索引时，可以估算找到一行需要的查找次数如下：

$$ \text{seeks} = \frac{\log(\text{row\_count})}{\log\left(\frac{\text{index\_block\_length}}{3} \times 2 / (\text{index\_length} + \text{data\_pointer\_length})\right)} + 1 $$

在 MySQL 中，索引块通常为 1,024 字节，数据指针通常为 4 字节。对于一个有 500,000 行且键值长度为 3 字节（MEDIUMINT 大小）的表，该公式表明：

$$ \text{log}(500,000)/\log\left(\frac{1024}{3} \times \frac{2}{(3+4)}\right) + 1 = 4 \text{ 次查找} $$

该索引需要的存储空间约为：

$$ 500,000 \times 7 \times \frac{3}{2} = 5.2 \text{MB} $$

（假设典型的索引缓冲区填充率为 2/3），因此您可能在内存中拥有大部分索引，只需要一到两次调用即可读取数据以找到行。

然而，对于写操作，您需要四次查找请求以确定放置新索引值的位置，并且通常需要两次查找以更新索引并写入行。

上述讨论并不意味着您的应用程序性能会随着 N 的对数缓慢退化。只要操作系统或 MySQL 服务器缓存了所有内容，随着表的增大，性能仅会略微变慢。当数据太大而无法缓存时，性能将显著下降，直到您的应用程序仅受磁盘查找限制（其增加为 log N）。为了避免这种情况，应随着数据的增长增加键缓存大小。对于 MyISAM 表，键缓存大小由 `key_buffer_size` 系统变量控制。详见 [第 7.1.1 节, “配置服务器”](#)。