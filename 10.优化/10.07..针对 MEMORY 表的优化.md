## 10.7 优化 MEMORY 表

考虑将 `MEMORY` 表用于经常访问、只读或很少更新的非关键数据。在实际负载下对比使用等效的 `InnoDB` 或 `MyISAM` 表来基准测试您的应用程序，以确认任何额外的性能提升是否值得数据丢失的风险，或者从基于磁盘的表在应用程序启动时复制数据的开销。

要获得 `MEMORY` 表的最佳性能，请检查对每个表的查询类型，并为每个相关索引指定使用的类型，即 B 树索引或哈希索引。在 `CREATE INDEX` 语句上，使用子句 `USING BTREE` 或 `USING HASH`。对于使用 > 或 BETWEEN 等运算符进行大于或小于比较的查询，B 树索引速度很快。哈希索引仅对通过 = 运算符查找单个值或通过 `IN` 运算符查找受限值集的查询快速。关于为什么 `USING BTREE` 通常比默认的 `USING HASH` 更好的选择，请参见第 10.2.1.23 节，“`避免全表扫描`”。有关不同类型 MEMORY 索引的实现细节，请参见第 10.3.9 节，“`B 树和哈希索引的比较`”。

### 性能优化建议

- **选择合适的索引类型**：
  - **B 树索引**：适用于需要进行大于、小于比较或范围查询的情况，如 `>`、`<`、`>=`、`<=`、`BETWEEN`。
  - **哈希索引**：适用于查找单个值（`=`）或特定值集（`IN`）的情况。

- **数据持久性考虑**：`MEMORY` 表中的数据存储在内存中，因此在服务器关闭时会丢失。确保将关键数据存储在持久化表中，如 `InnoDB` 或 `MyISAM` 表。

- **数据复制**：在应用程序启动时，将需要频繁访问的数据从基于磁盘的表复制到 `MEMORY` 表中，以提高访问速度。

- **查询优化**：根据查询模式调整索引类型，避免不必要的全表扫描。

- **性能基准测试**：在实际负载下对比不同存储引擎的性能，确定 `MEMORY` 表是否能显著提高性能，并权衡其带来的数据丢失风险。