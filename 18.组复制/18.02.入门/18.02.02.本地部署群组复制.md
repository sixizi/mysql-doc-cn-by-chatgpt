### 18.2.2 本地部署群组复制

群组复制最常见的部署方式是使用多个服务器实例以提供高可用性。也可以本地部署群组复制，例如用于测试目的。本节将解释如何在本地部署群组复制。

> **重要提示**  
>
> 群组复制通常部署在多个主机上，因为这样可以确保高可用性。本节中的说明不适用于生产部署，因为所有MySQL服务器实例都运行在同一个主机上。如果这个主机出现故障，整个群组将会失败。因此，这些信息应仅用于测试目的，不应在生产环境中使用。

本节说明如何在一个物理机器上创建一个包含三个MySQL服务器实例的复制组。这意味着需要三个数据目录，每个服务器实例一个，且需要独立配置每个实例。此过程假设MySQL服务器已下载并解压到名为mysql-8.0的目录中。每个MySQL服务器实例都需要一个特定的数据目录。创建一个名为data的目录，在该目录中为每个服务器实例创建一个子目录，例如s1、s2和s3，并初始化每一个。

```mysql
mysql-8.0/bin/mysqld --initialize-insecure --basedir=$PWD/mysql-8.0 --datadir=$PWD/data/s1
mysql-8.0/bin/mysqld --initialize-insecure --basedir=$PWD/mysql-8.0 --datadir=$PWD/data/s2
mysql-8.0/bin/mysqld --initialize-insecure --basedir=$PWD/mysql-8.0 --datadir=$PWD/data/s3
```




在data/s1、data/s2、data/s3内部是一个已初始化的数据目录，包含mysql系统数据库、相关表格等。要了解更多关于初始化过程，请参阅第2.9.1节，“初始化数据目录”。

> **警告**  
>
> 不要在生产环境中使用-initialize-insecure，这里仅为了简化教程而使用。有关安全设置的更多信息，请参阅第18.6节，“群组复制安全”。

#### 本地群组复制成员的配置

当你按照第18.2.1.2节，“为群组复制配置实例”时，你需要为上一节中添加的数据目录添加配置。例如：

```ini
[mysqld]

# 服务器配置

datadir=<full_path_to_data>/data/s1
basedir=<full_path_to_bin>/mysql-8.0/

port=24801
socket=<full_path_to_sock_dir>/s1.sock
```




这些设置配置MySQL服务器使用之前创建的数据目录以及服务器应打开哪个端口并开始监听传入连接。

> **注意**  
>
> 这个教程中使用非默认端口24801，因为三个服务器实例使用相同的主机名。在三台不同机器的设置中，这将不是必需的。

群组复制需要成员之间的网络连接，这意味着每个成员都必须能够解析所有其他成员的网络地址。例如，在这个教程中所有三个实例都运行在一台机器上，所以为了确保成员可以相互联系，你可以在选项文件中添加一行，例如report_host=127.0.0.1。

然后，每个成员需要能够连接到其group_replication_local_address上的其他成员。例如，在成员s1的选项文件中添加：

```
group_replication_local_address= "127.0.0.1:24901"
group_replication_group_seeds= "127.0.0.1:24901,127.0.0.1:24902,127.0.0.1:24903"
```




这将配置s1使用端口24901进行内部群组通信和种子成员。对于你想添加到群组的每个服务器实例，在成员的选项文件中进行这些更改。对于每个成员，你必须确保指定一个唯一的地址，因此对于group_replication_local_address，每个实例使用一个唯一的端口。通常你希望所有成员都能作为种子，供加入群组且尚未处理群组事务的成员使用。在这种情况下，如上所示将所有端口添加到group_replication_group_seeds中。

第18.2.1节，“在单主模式下部署群组复制”中的剩余步骤，同样适用于你以这种方式本地部署的群组。