#### 18.7.7.1 逐出超时

您可以使用 `group_replication_member_expel_timeout` 系统变量，该变量从 MySQL 8.0.13 开始可用，以允许在怀疑生成和怀疑成员被逐出之间提供额外的时间。当一个服务器不从另一个服务器接收消息时，会生成怀疑，如第18.1.4.2节“故障检测”中所解释的。

在 Group Replication 组成员创建对另一个成员（或自身）的怀疑之前，有一个初始的5秒检测期。然后，在另一个成员对其的怀疑（或自身对自己的怀疑）超时之后，成员将被逐出。在逐出机制检测和执行逐出之前，可能会再经过一段短时间。`group_replication_member_expel_timeout` 指定了成员在创建怀疑和逐出怀疑的成员之间等待的时间段，以秒为单位，称为逐出超时。在此等待期间，怀疑的成员被列为 `UNREACHABLE`，但不会从组的成员列表中移除。

- 如果怀疑的成员在等待期结束时超时之前再次变为活跃，则该成员将应用所有由剩余组成员在 XCom 的消息缓存中缓冲的消息，并进入 `ONLINE` 状态，无需操作员干预。在这种情况下，该成员被组视为相同的实例。

- 如果怀疑的成员只在怀疑超时后变得活跃并能够恢复通信，它将接收到一个在其中被逐出的视图，此时它意识到自己被逐出。您可以使用 `group_replication_autorejoin_tries` 系统变量，该变量从 MySQL 8.0.16 开始可用，使成员在此时自动尝试重新加入组。从 MySQL 8.0.21 开始，默认情况下启用此功能，并且成员会进行三次自动重新加入尝试。如果自动重新加入过程失败或未尝试，那么被逐出的成员将遵循由 `group_replication_exit_state_action` 指定的退出操作。


逐出成员之前的等待期仅适用于先前在组中活动的成员。从未在组中活动的非成员不会获得此等待期，并且在初始检测期结束后被移除，因为它们加入的时间太长。

如果将 `group_replication_member_expel_timeout` 设置为0，那么就没有等待期，怀疑的成员在5秒检测期结束后立即可以被逐出。这是默认设置，包括 MySQL 8.0.20 及之前的版本。这也是处于不支持 `group_replication_member_expel_timeout` 系统变量的 MySQL Server 版本的组成员的行为。从 MySQL 8.0.21 开始，该值默认为5，这意味着在5秒检测期后，怀疑的成员将在5秒后被逐出。虽然并不是所有组成员都必须拥有相同的 `group_replication_member_expel_timeout` 设置，但建议这样做以避免意外的逐出。任何成员都可以怀疑任何其他成员，包括自身，因此有效的逐出超时是具有最低设置的成员的超时。

考虑增加 `group_replication_member_expel_timeout` 的值，以超出默认值，在以下情况下：

- 网络速度较慢，导致默认的5或10秒等待时间不足以确保组成员始终至少交换一条消息。
- 网络有时会发生瞬时故障，您希望在这些时候避免不必要的逐出和主成员更改。
- 网络不受您的直接控制，您希望最大程度减少操作员干预的需要。
- 临时网络故障是预期的，您不希望一些或所有成员因此而被逐出。
- 单个计算机正在经历减速，您不希望它被逐出组。

您可以指定最多达3600秒（1小时）的逐出超时。重要的是要确保 XCom 的消息缓存足够大，以包含您指定的时间段内的预期消息量，以及初始的5秒检测期，否则成员无法重新连接。您可以使用 `group_replication_message_cache_size` 系统变量调整缓存大小限制。有关更多信息，请参见第18.7.6节“XCom缓存管理”。

如果组中有任何成员当前受到怀疑，那么无法重新配置组成员资格（添加或删除成员或选举新领导者）。如果需要在一个或多个成员受到怀疑的情况下实施组成员更改，并且希望怀疑的成员仍然留在组中，如果可能的话，采取任何必要的行动使成员再次活跃。如果无法使成员再次活跃，并且希望它们被逐出组，您可以强制怀疑立即超时。通过将 `group_replication_member_expel_timeout` 在任何活动成员上更改为低于怀疑生成后已经过去的时间的值来实现。然后，怀疑的成员将立即变得有可能被逐出。

如果一个复制组成员突然停止并立即重新启动（例如，因为使用 `mysqld_safe` 启动），则如果设置了 `group_replication_start_on_boot=on`，它会自动尝试重新加入组。在这种情况下，重新启动和重新加入尝试可能发生在成员的先前实例被逐出组之前，此时成员无法重新加入。从 MySQL 8.0.19 开始，Group Replication 自动使用 Group通信系统（GCS）功能为该成员进行重新加入尝试，重试次数为10次，每次重试之间间隔5秒。这应该涵盖大多数情况，并允许足够的时间让之前的实例从组中被逐出，使成员重新加入。请注意，如果将 `group_replication_member_expel_timeout` 系统变量设置为指定较长的逐出等待时间，自动重新加入尝试可能仍然不会成功。

在不可用 `group_replication_member_expel_timeout` 系统变量的情况下，为避免不必要的逐出而采取替代的缓解策略，请参阅第18.3.2节“Group Replication限制”。