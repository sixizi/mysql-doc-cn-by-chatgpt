### 20.7.2 流控制

- [20.7.2.1 探测和统计](./20.07.02.01.探测和统计.md)
- [20.7.2.2 组复制节流](./20.07.02.02.组复制节流.md)

组复制确保事务仅在组中的大多数成员接收到该事务并就所有同时发送的事务之间的相对顺序达成一致后才提交。如果组的总写入量不超过组中任何成员的写入能力，这种方法效果很好。如果超过了，并且某些成员的写入吞吐量低于其他成员，特别是低于写入成员，那么这些成员可能开始落后于写入者。

让一些成员落后于组会带来一些问题，特别是，这些成员上的读取操作可能会展现出非常旧的数据。根据成员落后的原因，组中的其他成员可能必须保存更多或更少的复制上下文，以能够满足来自慢速成员的潜在数据传输请求。

然而，在复制协议中有一种机制可以避免快速成员和慢速成员之间在应用事务方面的过大差距。这就是所谓的流控制机制。它试图实现几个目标：

1. 使成员之间足够接近，使得缓冲和成员间的不同步成为小问题；
2. 快速适应变化条件，如不同的工作负载或组中的写入者增多；
3. 给每个成员公平地分配可用的写入能力；
4. 不比严格必要的更多地降低吞吐量，以避免浪费资源。

鉴于组复制的设计，是否进行限流可能会考虑到两个工作队列：(i) 认证队列；(ii) 二进制日志应用器队列。每当这些队列中的一个的大小超过用户定义的阈值时，限流机制就会被触发。只需配置：(i) 是在认证器还是应用器级别进行流控制，或两者都进行；以及 (ii) 每个队列的阈值是什么。

流控制依赖于两个基本机制：

- 监控成员以收集所有组成员的吞吐量和队列大小的统计数据，以便对每个成员应承受的最大写入压力做出明智的猜测；
- 限制那些试图超出其在每个时间点上可用容量的公平份额的成员的写入操作。

通过上述机制，组复制旨在平衡成员之间的负载，确保整个组的稳定性和效率。这对于处理不同成员的性能差异，特别是在复杂或变化多端的工作负载下，非常重要。正确配置和调整这些流控制参数对于最大化组复制环境的整体性能至关重要。