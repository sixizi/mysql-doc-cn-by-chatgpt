#### 20.8.3.2 升级 Group Replication 成员

本节解释了升级组成员所需的步骤。这个过程是在第 18.8.3.3 节“Group Replication 在线升级方法”中描述的方法的一部分。升级组成员的过程对所有方法都是通用的，首先进行解释。加入升级成员的方式可能取决于您正在遵循哪种方法以及是否处于单主或多主模式等其他因素。如何升级服务器实例，无论是使用原地升级还是预配方法，都不会影响此处描述的方法。

升级组成员的过程包括将其从组中移除，按照您选择的升级成员的方法进行升级，然后将升级后的成员重新加入组。在单主组中，升级成员的推荐顺序是首先升级所有辅助成员，然后最后升级主成员。如果在升级辅助成员之前升级了主成员，则将选择使用较旧的 MySQL 版本创建新主成员，但无需执行此步骤。

要升级组成员：

- 连接到组成员的客户端并发出 `STOP GROUP_REPLICATION` 命令。在继续之前，请确保监视 `replication_group_members` 表，确认成员的状态为 OFFLINE。

- 禁用自动启动 Group Replication，以便您可以安全地在升级后连接到成员并进行配置，而不会在设置 `group_replication_start_on_boot=0` 后重新加入组。

   > **重要**
   >
   > 如果升级后的成员具有 `group_replication_start_on_boot=1`，则在执行 MySQL 升级过程之前，它可能会重新加入组，可能会导致问题。例如，如果升级失败并且服务器再次重启，那么可能会尝试加入组的是一个可能已损坏的服务器。

- 停止成员，例如使用 `mysqladmin shutdown` 或 `SHUTDOWN` 语句。组中的任何其他成员将继续运行。

- 使用原地升级或预配方法进行成员升级。有关详细信息，请参阅第 2.10 节“升级 MySQL”。在重新启动升级后的成员时，由于 `group_replication_start_on_boot` 设置为 0，Group Replication 不会在实例上启动，因此它不会重新加入组。

- 执行了成员的 MySQL 升级程序后，必须将 `group_replication_start_on_boot` 设置为 1，以确保在重新启动后正确启动 Group Replication。重新启动成员。

- 连接到升级后的成员并发出 `START GROUP_REPLICATION` 命令。这将重新将成员加入组。Group Replication 元数据已在升级后的服务器上，因此通常无需重新配置 Group Replication。服务器必须赶上在其处于离线状态时组处理的任何事务。一旦它赶上了组，它就会成为组的在线成员。

   > **注意**
   >
   > 升级后的成员加入了一个组，其中有任何成员运行较早的 MySQL Server 版本时，升级后的成员会以 `super_read_only=on` 加入。这确保了在所有成员都运行较新版本之前不会向升级后的成员进行写操作。在多主模式组中，当升级成功完成并且组准备好处理事务时，预计将用作可写主的成员必须设置为读写模式。从 MySQL 8.0.17 开始，当组中的所有成员都升级到相同的版本时，它们都会自动切换回读写模式。对于较早的版本，必须手动将每个成员设置为读写模式。连接到每个成员并发出以下命令：
   >
   > `SET GLOBAL super_read_only=OFF;`