### 20.8.1 在群组中组合不同的成员版本

- [20.8.1.1 升级过程中的成员版本](./20.08.01.01.升级过程中的成员版本.md)
- [20.8.1.2 群组复制通信协议版本](./20.08.01.02.群组复制通信协议版本.md)

Group Replication 的版本与 Group Replication 插件捆绑的 MySQL Server 版本一致。例如，如果某个成员正在运行 MySQL 5.7.26，那么 Group Replication 插件的版本就是 5.7.26。要检查群组成员上 MySQL Server 的版本，可以执行以下查询：

```sql
SELECT MEMBER_HOST, MEMBER_PORT, MEMBER_VERSION FROM performance_schema.replication_group_members;
```

为了更好地理解 MySQL Server 版本并选择适合的版本，请参阅第2.1.2节“选择要安装的 MySQL 版本和分发版”。

为了实现最佳兼容性和性能，群组中的所有成员应该运行相同版本的 MySQL Server，因此也应该运行相同版本的 Group Replication。但是，在在线升级群组的过程中，为了最大程度地提高可用性，您可能需要同时运行不同 MySQL Server 版本的成员。根据 MySQL 版本之间的更改，您可能会在此情况下遇到不兼容性问题。例如，如果在主要版本之间已弃用某个功能，则在群组中组合不同版本可能会导致依赖于已弃用功能的成员失败。相反，在运行较旧 MySQL 版本的群组中，向运行较新 MySQL 版本的成员写入数据，可能会导致不具备在较新版本中引入的功能的成员出现问题。

为了避免这些问题，Group Replication 包括兼容性策略，使您能够安全地将运行不同 MySQL 版本的成员合并到同一群组中。成员根据这些策略来决定是否正常加入群组，以只读模式加入群组，或者不加入群组，具体取决于哪种选择能够确保加入成员以及群组中现有成员的安全运行。在升级方案中，每个服务器都必须离开群组，进行升级，然后使用其新的服务器版本重新加入群组。此时，成员将应用其新的服务器版本的策略，这可能会与其最初加入群组时应用的策略不同。

作为管理员，您可以通过配置服务器并发出 START GROUP_REPLICATION 语句来指示任何服务器尝试加入任何群组。成员加入或不加入群组，或以只读模式加入群组的决定是由加入成员自己在您尝试将其添加到群组后进行的。加入成员会接收有关当前群组成员的 MySQL Server 版本的信息，评估自己与这些成员的兼容性，并应用其自己 MySQL Server 版本中使用的策略（而不是现有成员使用的策略）来确定是否兼容。

加入成员在尝试加入群组时应用的兼容性策略如下：

- 如果成员正在运行低于现有群组成员运行的最低版本的 MySQL Server 版本，则不会加入群组。
- 如果成员正在运行与现有群组成员运行的最低版本相同的 MySQL Server 版本，则会正常加入群组。
- 如果成员正在运行高于现有群组成员运行的最低版本的 MySQL Server 版本，则会加入群组，但保持只读模式。此行为仅在群组以多主模式运行时才会有所不同，因为在单主模式下运行的群组中，新添加的成员默认始终处于只读模式。

运行 MySQL 8.0.17 或更高版本的成员在检查其兼容性时会考虑发布的补丁版本。而运行 MySQL 8.0.16 或更低版本，或者运行 MySQL 5.7 的成员只会考虑主要版本。例如，如果您有一个所有成员都运行 MySQL 版本 8.0.13 的群组：

- 运行 MySQL 版本 5.7 的成员不会加入群组。
- 运行 MySQL 版本 8.0.16 的成员会正常加入（因为它只考虑主要版本）。
- 运行 MySQL 版本 8.0.17 的成员会加入，但保持只读模式（因为它考虑了补丁版本）。

请注意，运行 MySQL 5.7.27 之前版本的加入成员会检查所有群组成员，以查找其自己的 MySQL Server 主要版本是否较低。因此，它们会在任何成员运行 MySQL 8.0 版本的群组中失败，即使该群组已经有其他运行 MySQL 5.7 版本的成员也会如此。从 MySQL 5.7.27 开始，加入成员只会与运行最低主要版本的群组成员进行比较，因此它们可以加入混合版本群组，其中存在其他运行 MySQL 5.7 服务器的情况。

在运行不同 MySQL Server 版本的多主模式群组中，Group Replication 会自动管理运行 MySQL 8.0.17 或更高版本的成员的读写和只读状态。如果成员离开群组，则会将运行最低版本的版本自动设置为读写模式。当您将以单主模式运行的群组更改为以多主模式运行，使用 group_replication_switch_to_multi_primary

_mode() 函数时，Group Replication 会自动将成员设置为正确的模式。如果运行较高版本的 MySQL 服务器版本的成员离开，则会自动将成员设置为只读模式，而运行最低版本的成员则设置为读写模式。