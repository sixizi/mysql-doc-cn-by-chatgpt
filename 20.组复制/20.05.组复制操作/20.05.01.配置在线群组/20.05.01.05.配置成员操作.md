#### 20.5.1.5 配置成员操作

从 MySQL 8.0.26 开始，群组复制具有为群组成员在特定情况下采取行动的能力。可以使用函数单独启用和禁用成员操作。成员操作配置可以在服务器离开群组后重置为默认值。

具有 `GROUP_REPLICATION_ADMIN `权限的管理员可以使用 `group_replication_enable_member_action` 或 `group_replication_disable_member_action` 函数在群组的主节点上配置成员操作。成员操作配置，包括所有成员操作以及它们是否被启用或禁用，然后通过群组复制的群组消息传播到其他群组成员和加入成员。因此，所有群组成员都具有相同的成员操作配置。只要安装了群组复制插件，您也可以在不属于群组的服务器上配置成员操作。在这种情况下，成员操作配置不会传播到任何其他服务器。

如果您使用函数配置成员操作的服务器是群组的一部分，它必须是单主模式群组中的当前主节点，并且必须是多数成员之一。群组复制会内部跟踪配置更改，但不会赋予 GTID 且不会写入二进制日志，因此不会传播到群组外的任何服务器，例如下游副本。群组复制在每次启用或禁用成员操作时增加其成员操作配置的版本号。

成员操作配置按以下方式传播给成员：

- 启动群组时，启动群组的服务器的成员操作配置成为群组的配置。
- 如果群组的最低 MySQL 服务器版本支持成员操作，则加入群组的成员在加入时的状态交换过程中接收群组的成员操作配置。在这种情况下，加入成员用群组的配置替换其自己的成员操作配置。
- 如果支持成员操作的加入成员加入一个最低 MySQL 服务器版本不支持成员操作的群组，它在加入时不会接收成员操作配置。在这种情况下，加入成员将其自己的配置重置为默认值。
- 不支持成员操作的成员无法加入具有成员操作配置的群组，因为其 MySQL 服务器版本低于现有群组成员运行的最低版本。

性能模式表 `replication_group_member_actions` 列出了配置中可用的成员操作、触发它们的事件以及它们当前是否被启用。成员操作具有从 1 到 100 的优先级，较低的值优先执行。如果在执行成员操作时发生错误，可以记录成员操作的失败，但可以忽略。如果认为成员操作的失败是关键的，则可以根据 `group_replication_exit_state_action` 系统变量指定的策略进行处理。

表 `mysql.replication_group_configuration_version`（可以使用性能模式表 `replication_group_configuration_version` 查看）记录了成员操作配置的当前版本。每当使用函数启用或禁用成员操作时，版本号会递增。

函数 `group_replication_reset_member_actions` 只能在不属于群组的服务器上使用。它将成员操作配置重置为默认设置，并将其版本号重置为 1。服务器必须可写（`read_only` 系统变量设置为 OFF）并安装了群组复制插件。如果您打算将服务器作为独立服务器使用，不使用任何成员操作或使用不同的成员操作，则可以使用此函数删除服务器在群组中时使用的成员操作配置。

**成员操作：**mysql_disable_super_read_only_if_primary

成员操作 `mysql_disable_super_read_only_if_primary` 可以配置为使单主模式的群组在选举出新的主节点时保持超级只读模式，这样群组只接受复制的事务，不接受来自客户端的任何直接写入。这种设置意味着当群组的目的是为另一个群组提供灾难容忍的备份时，您可以确保次级群组与第一个群组保持同步。

默认情况下，当选举出主节点时，超级只读模式在主节点上被禁用，使得主节点变为读写模式，并接受来自复制源服务器和客户端的更新。这是启用成员操作 `mysql_disable_super_read_only_if_primary` 时的情况，这是其默认设置。如果您使用 `group_replication_disable_member_action` 函数将操作设置为禁用，则选举后主节点保持超级只读模式。在这种状态下，它不接受来自任何客户端的更新，即使是拥有 CONNECTION_ADMIN 或 SUPER 权限的用户。它确实继续接受复制线程执行的更新。