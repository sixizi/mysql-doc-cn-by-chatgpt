### 17.1.2 InnoDB表的最佳实践

本节介绍了在使用InnoDB表时的最佳实践。

- 为每个表指定一个主键，使用最频繁查询的列或列，或者如果没有明显的主键，则使用自增值。

- 在从多个表中拉取数据的地方使用join，基于这些表的相同ID值。为了获得快速的连接性能，请在join列上定义外键，并在每个表中声明具有相同数据类型的列。添加外键可以确保引用的列被索引，这可以提高性能。外键还会传播删除和更新到所有受影响的表，并防止在子表中插入数据，如果相应的ID在父表中不存在。

- 关闭自动提交。每秒提交数百次会限制性能（受存储设备的写入速度限制）。

- 将相关的DML操作集合到事务中，通过在它们之间使用START TRANSACTION和COMMIT语句。虽然您不希望经常提交，但也不希望发出大批量的INSERT、UPDATE或DELETE语句，而不提交就运行数小时。

- 不要使用`LOCK TABLES`语句。InnoDB可以处理多个会话同时读写同一张表，而不会牺牲可靠性或高性能。要获得对一组行的独占写入访问权，请使用`SELECT ... FOR UPDATE`语法，仅锁定您打算更新的行。

- 启用`innodb_file_per_table`变量，或者使用通用表空间将表的数据和索引放入单独的文件中，而不是系统表空间。`innodb_file_per_table`变量默认启用。

- 评估您的数据和访问模式是否受益于InnoDB表或页面压缩功能。您可以压缩InnoDB表，而不损害读写能力。

- 使用`--sql_mode=NO_ENGINE_SUBSTITUTION`选项运行服务器，以防止创建使用您不想使用的存储引擎的表。