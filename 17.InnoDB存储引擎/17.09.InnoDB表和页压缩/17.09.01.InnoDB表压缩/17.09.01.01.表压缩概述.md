#### 17.9.1.1 表压缩概述

由于处理器和缓存内存的速度增加超过了磁盘存储设备，许多工作负载受到磁盘的限制。数据压缩能够缩小数据库大小、减少 I/O 并提高吞吐量，代价是略微增加 CPU 利用率。对于读取密集型应用，特别是在系统有足够的 RAM 以保持频繁使用的数据驻留在内存中的系统上，压缩尤其有价值。

使用 `ROW_FORMAT=COMPRESSED` 创建的 InnoDB 表可以在磁盘上使用比配置的 `innodb_page_size` 值更小的页面大小。较小的页面减少了从磁盘读取和写入磁盘的 I/O 需求，这对于 SSD 设备尤其有价值。

压缩页面大小通过 `CREATE TABLE` 或 `ALTER TABLE` 的 `KEY_BLOCK_SIZE` 参数指定。不同的页面大小要求将表放在文件每表表空间或通用表空间中，而不是系统表空间，因为系统表空间不能存储压缩表。更多信息，请参见第 17.6.3.2 节，“文件每表表空间”，和第 17.6.3.3 节，“通用表空间”。

无论 `KEY_BLOCK_SIZE` 值如何，压缩级别都是相同的。指定 `KEY_BLOCK_SIZE` 的较小值，您将获得越来越小的页面的 I/O 好处。但是，如果指定的值太小，当数据值不能足够压缩以在每个页面中容纳多个行时，有额外的开销来重新组织页面。对于表的 `KEY_BLOCK_SIZE` 有一个硬性限制，基于其每个索引的键列的长度。指定的值太小，`CREATE TABLE` 或 `ALTER TABLE` 语句将失败。

在缓冲池中，压缩数据以基于 `KEY_BLOCK_SIZE` 值的小页面形式保存。为了提取或更新列值，MySQL 还在缓冲池中创建一个带有未压缩数据的未压缩页面。在缓冲池内部，对未压缩页面的任何更新也会重新写回到相应的压缩页面。您可能需要调整缓冲池的大小以容纳压缩和未压缩页面的额外数据，尽管当需要空间时，未压缩页面会从缓冲池中驱逐，然后在下一次访问时再次解压。