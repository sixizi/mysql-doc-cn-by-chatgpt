### 17.5.3 自适应哈希索引

自适应哈希索引使得InnoDB能够在具有适当工作负载组合和足够缓冲池内存的系统上更像内存数据库一样运行，同时不牺牲事务特性或可靠性。自适应哈希索引由`innodb_adaptive_hash_index`变量启用，或者在服务器启动时通过`--skip-innodb-adaptive-hash-index`关闭。

根据观察到的搜索模式，使用索引键的前缀构建哈希索引。前缀可以是任意长度，可能只有B树中的某些值出现在哈希索引中。哈希索引是根据经常访问的索引页面的需求建立的。

如果一个表几乎完全适合于主内存，哈希索引可以通过使任何元素的直接查找成为可能，从而加速查询，将索引值转换为某种指针。InnoDB有一个监控索引搜索的机制。如果InnoDB注意到构建哈希索引可以从中受益，它会自动这样做。

对于某些工作负载，哈希索引查找的加速大大超过监控索引查找和维护哈希索引结构的额外工作。在重负载下，如多个并发连接，访问自适应哈希索引有时会成为争用的来源。使用LIKE运算符和%通配符的查询也倾向于不受益。对于不受益于自适应哈希索引的工作负载，关闭它可以减少不必要的性能开销。因为很难预先预测自适应哈希索引是否适合特定系统和工作负载，考虑在启用和禁用时运行基准测试。

自适应哈希索引功能是分区的。每个索引绑定到特定分区，每个分区由单独的锁保护。分区由`innodb_adaptive_hash_index_parts`变量控制。`innodb_adaptive_hash_index_parts`变量默认设置为8。最大设置是512。

您可以在SHOW ENGINE INNODB STATUS输出的SEMAPHORES部分监控自适应哈希索引的使用和争用。如果有许多线程在btr0sea.c中创建的rw-latches上等待，考虑增加自适应哈希索引分区的数量或禁用自适应哈希索引。

有关哈希索引性能特性的信息，请参见第8.3.9节，“B树和哈希索引的比较”。
