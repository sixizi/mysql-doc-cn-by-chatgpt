### 17.12.1 在线 DDL 操作

本节提供了 DDL 操作的在线支持详情、语法示例和使用说明，涵盖以下主题：

- [索引操作](#索引操作)
- [主键操作](#主键操作)
- [列操作](#列操作)
- [生成列操作](#生成列操作)
- [外键操作](#外键操作)
- [表操作](#表操作)
- [表空间操作](#表空间操作)
- [分区操作](#分区操作)

#### 索引操作

下表提供了对索引操作的在线 DDL 支持概览。星号表示附加信息、异常或依赖关系。详情见语法和使用说明。

表 17.16 索引操作的在线 DDL 支持

| 操作                           | 即时 | 就地 | 重建表 | 允许并发 DML | 仅修改元数据 |
|------------------------------|------|------|--------|-------------|------------|
| 创建或添加二级索引                 | 否   | 是   | 否     | 是          | 否         |
| 删除索引                        | 否   | 是   | 否     | 是          | 是         |
| 重命名索引                       | 否   | 是   | 否     | 是          | 是         |
| 添加 FULLTEXT 索引            | 否   | 是*  | 否*    | 否          | 否         |
| 添加 SPATIAL 索引             | 否   | 是   | 否     | 否          | 否         |
| 更改索引类型                     | 是   | 是   | 否     | 是          | 是         |

##### 语法和使用说明

- 创建或添加二级索引

  ```sql
  CREATE INDEX name ON table (col_list);
  ALTER TABLE tbl_name ADD INDEX name (col_list);
  ```

  在创建索引时，表仍可进行读写操作。`CREATE INDEX` 语句只有在访问表的所有事务完成后才结束，以便索引的初始状态反映表的最新内容。

  添加二级索引的在线 DDL 支持意味着，您可以通过先创建没有二级索引的表，然后在数据加载后添加二级索引，来加速整个创建和加载表及其关联索引的过程。

  新创建的二级索引仅包含 `CREATE INDEX` 或 `ALTER TABLE` 语句执行完成时表中的已提交数据。它不包含任何未提交的值、旧版本的值或标记为删除但尚未从旧索引中移除的值。


- 删除索引

  ```sql
  DROP INDEX name ON table;
  ALTER TABLE tbl_name DROP INDEX name;
  ```

  在删除索引时，表仍可进行读写操作。`DROP INDEX` 语句只有在访问表的所有事务完成后才结束，以便索引的初始状态反映表的最新内容。


- 重命名索引

  ```sql
  ALTER TABLE tbl_name RENAME INDEX old_index_name TO new_index_name, ALGORITHM=INPLACE, LOCK=NONE;
  ```

- 添加 FULLTEXT 索引

  ```sql
  CREATE FULLTEXT INDEX name ON table(column);
  ```

  如果没有用户定义的 FTS_DOC_ID 列，则添加第一个 FULLTEXT 索引会重建表。可以添加额外的 FULLTEXT 索引而不重建表。

- 添加 SPATIAL 索引

  ```sql
  CREATE TABLE geom (g GEOMETRY NOT NULL);
  ALTER TABLE geom ADD SPATIAL INDEX(g), ALGORITHM=INPLACE, LOCK=SHARED;
  ```

- 更改索引类型（使用 {BTREE | HASH}）

  ```sql
  ALTER TABLE tbl_name DROP INDEX i1, ADD INDEX i1(key_part,...) USING BTREE, ALGORITHM=INSTANT;
  ```