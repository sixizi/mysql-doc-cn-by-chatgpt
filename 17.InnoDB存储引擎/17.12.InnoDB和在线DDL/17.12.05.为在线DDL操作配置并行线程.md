### 17.12.5 为在线 DDL 操作配置并行线程

创建或重建二级索引的在线 DDL 操作的工作流程包括：

- 扫描聚集索引并将数据写入临时排序文件
- 对数据进行排序
- 从临时排序文件中加载排序后的数据到二级索引中

用于扫描聚集索引的并行线程数由 `innodb_parallel_read_threads` 变量定义。默认设置为 4。最大设置为 256，这是所有会话的最大数目。实际扫描聚集索引的线程数是由 `innodb_parallel_read_threads` 设置定义的数字或要扫描的索引子树的数量，以较小者为准。如果达到线程限制，会话将回退到使用单个线程。

排序和加载数据的并行线程数由 `innodb_ddl_threads` 变量控制，该变量在 MySQL 8.0.27 中引入。默认设置为 4。在 MySQL 8.0.27 之前，排序和加载操作是单线程的。

以下限制适用：

- 不支持为包含虚拟列的索引构建并行线程。
- 不支持全文索引创建的并行线程。
- 不支持空间索引创建的并行线程。
- 不支持在定义了虚拟列的表上进行并行扫描。
- 不支持在定义了全文索引的表上进行并行扫描。
- 不支持在定义了空间索引的表上进行并行扫描。