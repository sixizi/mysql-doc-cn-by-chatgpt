# 17.22 InnoDB 限制

本节描述了 InnoDB 表、索引、表空间以及 InnoDB 存储引擎其他方面的限制。

- 一个表最多可以包含 1017 个列。虚拟生成列包含在此限制中。

- 一个表最多可以包含 64 个次级索引。

- 对于使用 DYNAMIC 或 COMPRESSED 行格式的 InnoDB 表，索引键前缀长度限制是 3072 字节。

  对于使用 REDUNDANT 或 COMPACT 行格式的 InnoDB 表，索引键前缀长度限制是 767 字节。例如，如果使用 utf8mb4 字符集，每个字符最多 4 个字节，那么你可能会在 TEXT 或 VARCHAR 列的列前缀索引超过 191 个字符时遇到此限制。

  尝试使用超过限制的索引键前缀长度会返回错误。

  如果通过指定创建 MySQL 实例时的 `innodb_page_size` 选项将 InnoDB 页面大小减少到 8KB 或 4KB，基于 16KB 页面大小的 3072 字节限制，索引键的最大长度按比例降低。也就是说，当页面大小为 8KB 时，最大索引键长度为 1536 字节；当页面大小为 4KB 时，为 768 字节。

  适用于索引键前缀的限制也适用于完整列索引键。

- 对于多列索引，允许的最大列数为 16。超过限制会返回错误。

  ```
  ERROR 1070 (42000): Too many key parts specified; max 16 parts allowed
  ```

- 
  最大行大小（不包括存储在页面外的任何可变长度列）稍少于 4KB、8KB、16KB 和 32KB 页面大小的一半。例如，对于默认的 `innodb_page_size` 16KB，最大行大小约为 8000 字节。然而，对于 64KB 的 InnoDB 页面大小，最大行大小约为 16000 字节。`LONGBLOB` 和 `LONGTEXT` 列必须小于 4GB，并且包括 BLOB 和 TEXT 列的总行大小必须小于 4GB。

  如果一行小于半页长，所有内容都存储在页面内。如果超过半页，选择可变长度列进行外部页面外存储，直到行适合在半页内，如第 17.11.2 节 “文件空间管理” 所述。

- 虽然 InnoDB 内部支持大于 65,535 字节的行大小，但 MySQL 本身对所有列的组合大小施加了 65,535 字节的行大小限制。参见第 10.4.7 节 “表列计数和行大小的限制”。

- 在一些较旧的操作系统上，文件必须小于 2GB。这不是 InnoDB 的限制。如果你需要一个大的系统表空间，请使用几个较小的数据文件而不是一个大的数据文件来配置它，或将表数据分布在文件每表和通用表空间数据文件中。

- InnoDB 日志文件的组合最大大小为 512GB。

  表空间的最小大小略大于 10MB。表空间的最大大小取决于 InnoDB 页面大小。

  InnoDB 最大表空间大小

  | InnoDB 页面大小 | 最大表空间大小 |
  | -------------- | ------------- |
  | 4KB            | 16TB          |
  | 8KB            | 32TB          |
  | 16KB           | 64TB          |
  | 32KB           | 128TB         |
  | 64KB           | 256TB         |

  最大表空间大小也是表的最大大小。

  一个 InnoDB 实例支持多达 2^32 (4294967296) 个表空间，其中少数表空间保留给撤销和临时表。

- 共享表空间支持多达 2^32 (4294967296) 个表。

- 表空间文件的路径，包括文件名，不能超过 Windows 上的 MAX_PATH 限制。在 Windows 10 之前，MAX_PATH 限制为 260 个字符。从 Windows 10 版本 1607 开始，从常见的 Win32 文件和目录函数中移除了 MAX_PATH 限制，但你必须启用新行为。

- 有关并发读写事务的限制，请参见第 17.6.6 节 “撤销日志”。