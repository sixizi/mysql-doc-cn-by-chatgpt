### 17.21.5 InnoDB 错误处理

以下条目描述了 InnoDB 如何进行错误处理。InnoDB 有时只回滚失败的语句，其他时候它回滚整个事务。

- 如果在表空间中耗尽文件空间，会发生 MySQL 表满错误（MySQL Table is full error），并且 InnoDB 会回滚 SQL 语句。

- 事务死锁会导致 InnoDB 回滚整个事务。当这种情况发生时，重试整个事务。

  锁等待超时会导致 InnoDB 回滚当前语句（等待锁且遇到超时的语句）。要让整个事务回滚，启动服务器时使用 `--innodb-rollback-on-timeout` 启用。如果使用默认行为，则重试语句；如果启用了 `--innodb-rollback-on-timeout`，则重试整个事务。

  死锁和锁等待超时在繁忙的服务器上是正常现象，应用程序需要意识到它们可能发生并通过重试来处理它们。你可以通过在事务的第一次数据更改和提交之间尽可能少做工作来降低它们发生的可能性，这样锁就会持有最短的时间和最小可能的行数。有时，将工作分配给不同的事务可能是实际的并且有帮助的。

- 如果你没有在语句中指定 `IGNORE` 选项，重复键错误会回滚 SQL 语句。

- 行太长错误会回滚 SQL 语句。

- 其他错误大多由 MySQL 层的代码（在 InnoDB 存储引擎级别之上）检测到，并且回滚相应的 SQL 语句。在单个 SQL 语句的回滚中，锁不会被释放。

在隐式回滚期间，以及在执行显式的 `ROLLBACK` SQL 语句期间，`SHOW PROCESSLIST` 在相关连接的 State 列中显示 Rolling back。