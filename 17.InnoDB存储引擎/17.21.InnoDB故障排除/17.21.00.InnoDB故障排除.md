## 17.21 InnoDB 故障排除

- [17.21.1 排查 InnoDB I/O 问题](./17.21.01.排查 InnoDB IO 问题.md)
- [17.21.2 排查恢复失败](./17.21.02.排查恢复失败.md)
- [17.21.3 强制 InnoDB 恢复](./17.21.03.强制 InnoDB 恢复.md)
- [17.21.4 排查 InnoDB 数据字典操作](./17.21.04.排查 InnoDB 数据字典操作.md)
- [17.21.5 InnoDB 错误处理](./17.21.05.InnoDB 错误处理.md)

以下通用指南适用于排查 InnoDB 问题：

- 当操作失败或你怀疑有 bug 时，查看 MySQL 服务器错误日志（参见第 7.4.2 节，“错误日志”）。服务器错误消息参考提供了一些你可能遇到的常见 InnoDB 特定错误的故障排除信息。

- 如果故障与死锁相关，请启用 `innodb_print_all_deadlocks` 选项，以便将每个死锁的详细信息打印到 MySQL 服务器错误日志中。有关死锁的信息，请参见第 17.7.5 节，“InnoDB 中的死锁”。

- 如果问题与 InnoDB 数据字典相关，请参见第 17.21.4 节，“排查 InnoDB 数据字典操作”。

- 在故障排除时，通常最好通过命令提示符运行 MySQL 服务器，而不是通过 `mysqld_safe` 或作为 Windows 服务运行。这样你就可以看到 `mysqld` 打印到控制台的内容，从而更好地了解正在发生的事情。在 Windows 上，使用 `--console` 选项启动 `mysqld` 以将输出定向到控制台窗口。

- 启用 InnoDB 监视器以获取有关问题的信息（参见第 17.17 节，“InnoDB 监视器”）。如果问题与性能相关，或你的服务器似乎挂起，你应该启用标准监视器以打印有关 InnoDB 内部状态的信息。如果问题与锁相关，启用锁监视器。如果问题与表创建、表空间或数据字典操作有关，请参考 InnoDB 信息模式系统表来检查 InnoDB 内部数据字典的内容。

- 在以下条件下，InnoDB 会临时启用标准 InnoDB 监视器输出：

- - 长时间的信号量等待
  - InnoDB 无法在缓冲池中找到空闲块
  - 超过 67% 的缓冲池被锁堆或自适应哈希索引占用

- 如果你怀疑表损坏，请对该表运行 `CHECK TABLE`。