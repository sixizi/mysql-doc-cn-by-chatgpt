### 1.3 MySQL 8.0中的新功能

本节概述了MySQL 8.0中新增、弃用和删除的内容。附带的一节列出了MySQL 8.0中已添加、已弃用或已删除的MySQL服务器选项和变量；请参阅[第1.4节 MySQL 8.0中引入、弃用或删除的服务器和状态变量和选项](01.04.MySQL 8.0中引入、弃用或删除的服务器和状态变量和选项.md)。

- [MySQL 8.0中新增的功能](#MySQL 8.0中新增的功能)
- [MySQL 8.0中弃用的功能](#MySQL 8.0中弃用的功能)
- [MySQL 8.0中删除的功能](#MySQL 8.0中删除的功能)

#### MySQL 8.0中新增的功能

以下是MySQL 8.0中新增的功能：

- **数据字典**。MySQL现在包含一个事务性数据字典，用于存储有关数据库对象的信息。在之前的MySQL版本中，字典数据存储在元数据文件和非事务性表中。有关更多信息，请参阅[第14章 MySQL数据字典](../14.MySQL数据字典/14.00.MySQL数据字典.md)。

- **原子数据定义语句（Atomic DDL）**。原子DDL语句将与DDL操作相关的数据字典更新、存储引擎操作和二进制日志写入合并为一个原子事务。有关更多信息，请参阅第13.1.1节《原子数据定义语句支持》。

- **升级过程**。以前，在安装新版本的MySQL后，MySQL服务器会在下次启动时自动升级数据字典表，然后DBA需要手动调用mysql_upgrade来升级mysql模式下的系统表，以及其他模式中的对象，如sys模式和用户模式。

  从MySQL 8.0.16开始，服务器执行了以前由mysql_upgrade处理的任务。安装新的MySQL版本后，服务器现在会在下次启动时自动执行所有必要的升级任务，不再依赖于DBA调用mysql_upgrade。此外，服务器还会更新帮助表的内容（mysql_upgrade不会执行此操作）。一个新的--upgrade服务器选项提供了对服务器执行自动数据字典和服务器升级操作的控制。有关更多信息，请参阅第2.10.3节《MySQL升级过程升级的内容》。

- **会话复用**。MySQL服务器现在默认支持SSL会话复用，并设置了超时时间来控制服务器维护会话缓存的时期，该缓存建立了客户端允许为新连接请求会话复用的时间段。所有MySQL客户端程序都支持会话复用。有关服务器端和客户端配置信息，请参阅第6.3.5节《重用SSL会话》。

  此外，C应用程序现在可以使用C API功能来启用加密连接的会话复用（请参阅SSL会话复用）。

- **安全和帐户管理**。这些增强功能旨在提高安全性，并在帐户管理方面提供更大的DBA灵活性：

  - MySQL企业审计现在支持使用调度程序组件配置和执行定期任务以刷新内存中的缓存。有关设置说明，请参阅《启用审计日志刷新任务》。

  - 新的密码验证系统变量允许配置和强制要求用户在尝试替换自己的MySQL帐户密码时更改最低字符数。这个新的验证设置是当前密码中字符总数的百分比。例如，如果validate_password.changed_characters_percentage的值为50，替换帐户密码中至少一半的字符不能出现在当前密码中，否则密码将被拒绝。有关更多信息，请参阅第6.4.3节《密码验证组件》。

  - MySQL企业版现在提供基于组件的数据掩码和去标识化功能，而不是基于MySQL 8.0.13中引入的插件库。MySQL企业数据掩码和去标识化组件支持多字节字符，在数据库表中存储掩码字典，并提供了几个新的函数。有关更多信息，请参阅第6.5.1节《数据掩码组件与数据掩码插件》。

  - 在MySQL 8.0.33之前，mysql系统数据库用于MySQL企业审计的过滤器和用户帐户数据的持久存储。为了增强灵活性，新的audit_log_database服务器系统变量现在允许在服务器启动时指定全局模式命名空间中的其他数据库。mysql系统数据库是表存储的默认设置。

  - mysql系统数据库中的授权表现在是InnoDB（事务性）表请注意，上述功能列表是基于MySQL 8.0的知识截止日期为2021年9月。MySQL可能已经有了新的版本和功能。建议查阅MySQL官方文档，以获取最新的功能和更新信息。

  - 现在有一个新的caching_sha2_password身份验证插件可用。与sha256_password插件类似，caching_sha2_password实现了SHA-256密码哈希，但使用缓存来解决连接时的延迟问题。它还支持更多的传输协议，并且不需要与OpenSSL链接以实现基于RSA密钥对的密码交换功能。请参阅“6.4.1.2节：缓存SHA-2可插拔身份验证”。

    caching_sha2_password和sha256_password身份验证插件提供比mysql_native_password插件更安全的密码加密，并且caching_sha2_password比sha256_password具有更好的性能。由于caching_sha2_password具有这些更高的安全性和性能特点，它现在是首选的身份验证插件，并且也是默认的身份验证插件，而不是mysql_native_password。有关默认插件更改对服务器操作和与客户端和连接器的兼容性的影响的信息，请参阅“caching_sha2_password作为首选身份验证插件”。

  - MySQL Enterprise Edition SASL LDAP身份验证插件现在支持GSSAPI / Kerberos作为Linux上MySQL客户端和服务器的身份验证方法。这在Linux环境中非常有用，应用程序可以使用Microsoft Active Directory访问LDAP，并且默认启用了Kerberos。请参阅LDAP身份验证方法。

  - MySQL Enterprise Edition现在支持一种身份验证方法，允许用户使用Kerberos对MySQL Server进行身份验证，前提是有适当的Kerberos票据可用或可以获取。有关详细信息，请参阅“6.4.1.8节：Kerberos可插拔身份验证”。

  - MySQL现在支持角色，这是一组命名的特权集合。可以创建和删除角色。可以向角色授予权限并从中撤销权限。可以将角色授予并从用户帐户中撤销角色。可以从授予给帐户的角色中选择活动的适用角色，并且可以在会话过程中更改该帐户的角色。有关更多信息，请参阅“6.2.10节：使用角色”。

  - MySQL现在引入了用户帐户类别的概念，根据是否具有SYSTEM_USER特权来区分系统用户和普通用户。请参阅“6.2.11节：帐户类别”。

  - 以前，无法授予适用于某些模式的全局权限。如果启用了partial_revokes系统变量，现在可以实现此功能。请参阅“6.2.12节：使用部分撤销限制特权”。

  - GRANT语句具有AS user [WITH ROLE]子句，用于指定有关用于语句执行的特权上下文的附加信息。此语法在SQL级别可见，尽管其主要目的是通过在二进制日志中显示这些限制，从而使授予者对特权限制在所有节点上进行统一复制。请参阅“13.7.1.6节：GRANT语句”。

  - MySQL现在维护有关密码历史的信息，可以限制重用先前密码。DBA可以要求新密码不是从先前密码中选择的一些密码更改或一段时间内的密码。可以在全局范围内以及按帐户设置密码重用策略。

    现在可以要求验证尝试更改帐户密码时通过指定要替换的当前密码来进行验证。这使得DBA可以防止用户在不证明他们知道当前密码的情况下更改密码。可以在全局范围内以及按帐户设置密码验证策略。

    现在允许帐户具有双重密码，这使得在复杂的多服务器系统中可以无缝执行分阶段密码更改，而无需停机。

    MySQL现在允许管理员配置用户帐户，以便如果由于密码错误导致太多连续登录失败，会导致临时锁定帐户。每个帐户的所需失败次数和锁定时间可以进行配置。

    这些新功能为DBA提供了更完整的密码管理控制。有关更多信息，请参阅“6.2.15节：密码管理”。

  - 如果使用OpenSSL编译，并且运行时可用OpenSSL库和FIPS对象模块，MySQL现在支持FIPS模式。FIPS模式对密码操作施加了条件，例如对可接受的加密算法的限制或对更长密钥长度的要求。请参阅“6.8节：FIPS支持”。

  - 服务器用于新连接的TLS上下文现在可以在运行时重新配置。这个功能可能很有用，例如，可以避免重新启动运行时间很长的MySQL服务器，导致SSL证书过期。请参阅Server-Side Runtime Configuration and Monitoring for Encrypted Connections。

  - OpenSSL 1.1.1支持用于加密连接的TLS v1.3协议，MySQL 8.0.16及更高版本也支持TLS v1.3，如果服务器和客户端都使用了OpenSSL 1.1.1或更高版本。请参阅“6.3.2节：加密连接TLS协议和密码”。

  - MySQL现在将授予客户端的对命名管道的访问控制设置为在Windows上成功通信所必需的最低权限。新的MySQL客户端软件可以在不需要任何其他配置的情况下打开命名管道连接。如果不能立即升级旧的客户端软件，则可以使用新的named_pipe_full_access_group系统变量来给予Windows组打开命名管道连接所需的权限。对完全访问组的成员资格应受到限制且是临时的。

  - 以前，MySQL用户帐户使用单个身份验证方法进行服务器身份验证。从MySQL 8.0.27开始，MySQL支持多因素身份验证（MFA），可以创建具有多达三种身份验证方法的帐户。MFA支持包括以下更改：

    - CREATE USER和ALTER USER语法已扩展，允许指定多个身份验证方法。
    - authentication_policy系统变量可以通过控制可使用的因素数量和每个因素允许的身份验证类型来建立MFA策略。这对于如何使用CREATE USER和ALTER USER语句中与身份验证相关的子句施加了约束。
    - 客户端程序具有新的--password1，--password2和--password3命令行选项，用于指定多个密码。对于使用C API的应用程序，mysql_options4（）C API函数的新MYSQL_OPT_USER_PASSWORD选项可以实现相同的功能。

    此外，MySQL Enterprise Edition现在支持使用智能卡、安全密钥和生物识别读卡器等设备对MySQL Server进行身份验证。该身份验证方法基于Fast Identity Online（FIDO）标准，并使用一对插件，在服务器端使用authentication_fido，在客户端端使用authentication_fido_client。服务器端FIDO身份验证插件仅包含在MySQL Enterprise Edition发行版中。它不包含在MySQL社区发行版中。但是，客户端端插件包含在所有发行版中，包括社区发行版。这使得来自任何发行版的客户端都可以连接到加载有服务器端插件的服务器。

    多因素身份验证可以使用现有的MySQL身份验证方法、新的FIDO身份验证方法或两者的组合。有关更多信息，请参阅“6.2.18节：多因素身份验证”和“6.4.1.11节：FIDO可插拔身份验证”。

- **资源管理**。MySQL现在支持创建和管理资源组，并允许将在服务器内运行的线程分配给特定的组，以便线程根据组可用的资源执行。组属性可以控制其资源，以启用或限制组中线程的资源消耗。DBA可以根据不同的工作负载修改这些属性。目前，CPU时间是一种可管理的资源，表示为“虚拟CPU”的概念，包括CPU核心、超线程、硬件线程等等。服务器在启动时确定有多少个虚拟CPU可用，具有适当权限的数据库管理员可以将这些CPU与资源组关联，并将线程分配给组。有关更多信息，请参见第5.1.16节“资源组”。

- **表加密管理**。现在可以通过定义和强制执行加密默认值来全局管理表加密。default_table_encryption变量定义了新创建的模式和通用表空间的加密默认值。还可以使用DEFAULT ENCRYPTION子句在创建模式时定义模式的加密默认值。默认情况下，表继承所在模式或通用表空间的加密。通过启用table_encryption_privilege_check变量来强制执行加密默认值。在创建或更改模式或通用表空间时，如果加密设置与default_table_encryption设置不同，或者在创建或更改与默认模式加密不同的加密设置的表时，将进行权限检查。当启用table_encryption_privilege_check时，TABLE_ENCRYPTION_ADMIN权限允许覆盖默认的加密设置。有关更多信息，请参见为模式和通用表空间定义加密默认值。

- **InnoDB增强功能**。添加了以下InnoDB增强功能：

  - 当前最大自增计数器值在每次更改时写入重做日志，并在每次检查点时保存到引擎专用系统表中。这些更改使当前最大自增计数器值在服务器重新启动后保持持久性。此外：

    - 服务器重新启动不再取消AUTO_INCREMENT = N表选项的效果。如果将自增计数器初始化为特定值，或者将自增计数器值更改为较大值，则新值将在服务器重新启动后保持持久性。
    - 在回滚操作后立即重新启动服务器不再导致重新使用为回滚事务分配的自增值。
    - 如果将AUTO_INCREMENT列值修改为大于当前最大自增值的值（例如，在UPDATE操作中），则新值将保持持久性，并且随后的INSERT操作将从新的较大值开始分配自增值。

    有关更多信息，请参见第15.6.1.6节“在InnoDB中处理AUTO_INCREMENT”和InnoDB AUTO_INCREMENT计数器初始化。

  - 在遇到索引树损坏时，InnoDB将损坏标志写入重做日志，使损坏标志具有崩溃安全性。InnoDB还将内存中的损坏标志数据写入引擎专用系统表中的每个检查点。在恢复过程中，InnoDB从两个位置读取损坏标志，并在标记内存表和索引对象为损坏之前合并结果。

  - InnoDB memcached插件支持多个get操作（在单个memcached查询中获取多个键值对）和范围查询。请参见第15.20.4节“InnoDB memcached多个get和范围查询支持”。

  - 新的动态变量innodb_deadlock_detect可以用于禁用死锁检测。在高并发系统中，死锁检测可能导致大量线程等待同一个锁时减慢速度。有时，禁用死锁检测并依赖innodb_lock_wait_timeout设置在发生死锁时进行事务回滚可能更有效。


  - 新的Information Schema INNODB_CACHED_INDEXES表报告每个索引在InnoDB缓冲池中缓存的索引页数。


  - InnoDB临时表现在在共享临时表空间ibtmp1中创建。


  - InnoDB表空间加密功能支持对重做日志和撤销日志数据的加密。请参见重做日志加密和撤销日志加密。


  - InnoDB支持SELECT ... FOR SHARE和SELECT ... FOR UPDATE的NOWAIT和SKIP LOCKED选项。NOWAIT使语句在另一个事务锁定所请求的行时立即返回。SKIP LOCKED从结果集中删除被锁定的行。请参见使用NOWAIT和SKIP LOCKED进行锁定读并发。

    SELECT ... FOR SHARE替代了SELECT ... LOCK IN SHARE MODE，但LOCK IN SHARE MODE仍然可用以保持向后兼容性。这两个语句是等效的。不过，FOR UPDATE和FOR SHARE支持NOWAIT、SKIP LOCKED和OF tbl_name选项。请参见第13.2.13节“SELECT语句”。

    OF tbl_name将锁定查询应用于指定的表。


  - 在本地分区API中，原生分区支持ADD PARTITION、DROP PARTITION、COALESCE PARTITION、REORGANIZE PARTITION和REBUILD PARTITION ALTER TABLE选项，并且可以与ALGORITHM={COPY|INPLACE}和LOCK子句一起使用。

    使用ALGORITHM=INPLACE的DROP PARTITION删除存储在分区中的数据并且删除分区。但是，使用ALGORITHM=COPY或old_alter_table=ON的DROP PARTITION将重建分区表，并尝试将数据从删除的分区移动到具有兼容PARTITION ... VALUES定义的另一个分区。无法移动到另一个分区的数据将被删除。


  - InnoDB存储引擎现在使用MySQL数据字典而不是其自己的存储引擎特定数据字典。有关数据字典的信息，请参见第14章“MySQL数据字典”。


  - mysql系统表和数据字典表现在在MySQL数据目录中的一个名为mysql.ibd的单个InnoDB表空间文件中创建。以前，这些表是在mysql数据库目录中创建的单独的InnoDB表空间文件中创建的。

  - 在MySQL 8.0中引入了以下撤销表空间的更改：


    - 默认情况下，撤销日志现在位于两个撤销表空间中，这些表空间在初始化MySQL实例时创建。不再在系统表空间中创建撤销日志。
    
    - 从MySQL 8.0.14开始，可以使用CREATE UNDO TABLESPACE语法在运行时在指定位置创建其他撤销表空间。
    
      ```
      CREATE UNDO TABLESPACE tablespace_name ADD DATAFILE 'file_name.ibu';
      ```
    
      使用CREATE UNDO TABLESPACE语法创建的撤销表空间可以使用DROP UNDO TABLESPACE语法在运行时删除。
    
      ```
      DROP UNDO TABLESPACE tablespace_name;
      ```
    
      可以使用ALTER UNDO TABLESPACE语法将撤销表空间标记为活动或非活动状态。
    
      ```
      ALTER UNDO TABLESPACE tablespace_name SET {ACTIVE|INACTIVE};
      ```
    
      在Information Schema INNODB_TABLESPACES表中添加了一个显示表空间状态的STATE列。在删除撤销表空间之前，撤销表空间必须处于空状态。

  - innodb_undo_log_truncate变量默认启用。

  - innodb_rollback_segments变量定义了每个撤销表空间的回滚段数。以前，innodb_rollback_segments指定了MySQL实例的回滚段总数。此更改增加了可用于并发事务的回滚段数。回滚段越多，越有可能并发事务使用单独的回滚段进行撤销日志，减少资源争用。

  - 影响缓冲池预刷和刷新行为的变量的默认值已修改：


    - innodb_max_dirty_pages_pct_lwm的默认值现在为10。以前的默认值为0，禁用了缓冲池预刷。当缓冲池中脏页的百分比超过10％时，值为10将启用预刷。启用预刷可以提高性能一致性。
    - innodb_max_dirty_pages_pct的默认值从75增加到90。InnoDB尝试从缓冲池中刷新数据，以使脏页的百分比不超过此值。增加的默认值允许缓冲池中有更高比例的脏页。

  - 默认的innodb_autoinc_lock_mode设置现在为2（交错模式）。交错锁模式允许并行执行多行插入，提高并发性和可扩展性。新的innodb_autoinc_lock_mode默认设置反映了从基于语句的复制更改为基于行的复制作为MySQL 5.7中默认复制类型的变化。基于语句的复制需要连续的自增锁模式（先前的默认值）以确保为给定的SQL语句序列分配自增值的顺序是可预测和可重复的，而基于行的复制不受SQL语句的执行顺序的影响。有关更多信息，请参见InnoDB AUTO_INCREMENT锁模式。

    对于使用基于语句的复制的系统，新的innodb_autoinc_lock_mode默认设置可能会破坏依赖于顺序自增值的应用程序。要恢复先前的默认设置，请将innodb_autoinc_lock_mode设置为1。

  - 通过ALTER TABLESPACE ... RENAME TO语法支持重命名通用表空间。

  - 新的innodb_dedicated_server变量，默认禁用，可用于根据服务器上检测到的内存量自动配置以下选项：


    - innodb_buffer_pool_size
    - innodb_log_file_size
    - innodb_flush_method
    
    此选项适用于运行在专用服务器上的MySQL服务器实例。有关更多信息，请参见第15.8.12节“启用专用MySQL服务器的自动配置”。

  - 新的Information Schema INNODB_TABLESPACES_BRIEF视图提供了InnoDB表空间的空间、名称、路径、标志和空间类型数据。

  - MySQL捆绑的zlib库版本从1.2.3提升到1.2.11。MySQL使用zlib库实现压缩功能。

    如果使用InnoDB压缩表，请参阅第2.10.4节“MySQL 8.0中的更改”以了解相关升级影响。

  - 序列化字典信息（SDI）存在于除全局临时表空间和撤销表空间文件之外的所有InnoDB表空间文件中。SDI是表和表空间对象的序列化元数据。存在SDI数据可以提供元数据冗余。例如，如果数据字典不可用，可以从表空间文件中提取字典对象元数据。使用ibd2sdi工具执行SDI提取。SDI数据以JSON格式存储。

    在表空间文件中包含SDI数据会增加表空间文件的大小。一个SDI记录需要一个索引页，默认大小为16KB。但是，存储时会对SDI数据进行压缩，以减少存储占用空间。

  - InnoDB存储引擎现在支持原子DDL，这确保了DDL操作无论服务器在操作过程中是否停止，都要么完全提交，要么完全回滚。有关更多信息，请参见第13.1.1节“原子数据定义语句支持”。

  - 在服务器离线状态下，可以使用innodb_directories选项将表空间文件移动或还原到新位置。有关更多信息，请参见第15.6.3.6节“在服务器离线状态下移动表空间文件”。

  - 以下的重做日志优化已经实施：


    - 用户线程现在可以在不同步写入的情况下并发地写入日志缓冲区。
    - 用户线程现在可以以放松的顺序将脏页添加到刷新列表中。
    - 现在有一个专用的日志线程负责将日志缓冲区写入系统缓冲区，将系统缓冲区刷新到磁盘，通知用户线程已写入和刷新的重做，维护放松刷新列表顺序所需的滞后，并写入检查点。
    - 添加了系统变量来配置用户线程等待刷新的重做时使用自旋延迟的情况：
    
      - innodb_log_wait_for_flush_spin_hwm：定义超过该值的平均日志刷新时间，用户线程在等待刷新的重做时不再自旋。
      - innodb_log_spin_cpu_abs_lwm：定义低于该值的CPU使用率，用户线程在等待刷新的重做时不再自旋。
      - innodb_log_spin_cpu_pct_hwm：定义高于该值的CPU使用率，用户线程在等待刷新的重做时不再自旋。
      - innodb_log_buffer_size变量现在是动态的，允许在服务器运行时调整日志缓冲区的大小。


    有关更多信息，请参阅8.5.4节，“优化InnoDB重做日志”。

  - 从MySQL 8.0.12开始，支持对大对象（LOB）数据进行小更新的撤消日志记录，从而提高了100字节大小或更小的LOB更新的性能。以前，LOB更新的最小大小为一个LOB页，这对于可能只修改几个字节的更新来说不太理想。此增强功能建立在MySQL 8.0.4中对LOB数据的部分更新支持之上。

  - 从MySQL 8.0.12开始，ALGORITHM=INSTANT支持以下ALTER TABLE操作：


    - 添加列。此功能也称为“Instant ADD COLUMN”。有限制条件。请参阅15.12.1节，“在线DDL操作”。
    - 添加或删除虚拟列。
    - 添加或删除列的默认值。
    - 修改ENUM或SET列的定义。
    - 更改索引类型。
    - 重命名表。
    
    只有支持ALGORITHM=INSTANT的操作才会修改数据字典中的元数据。表上不会获取元数据锁，表数据也不会受到影响，因此操作是瞬时的。如果未明确指定，支持ALGORITHM=INSTANT的操作默认使用ALGORITHM=INSTANT。如果指定了ALGORITHM=INSTANT但不支持，操作将立即失败并显示错误。
    
    有关支持ALGORITHM=INSTANT的操作的更多信息，请参阅15.12.1节，“在线DDL操作”。

- 从MySQL 8.0.13开始，TempTable存储引擎支持存储二进制大对象（BLOB）类型列。此增强功能改善了使用包含BLOB数据的临时表的查询性能。以前，包含BLOB数据的临时表存储在由internal_tmp_disk_storage_engine定义的磁盘存储引擎中。有关更多信息，请参阅8.4.4节，“MySQL中的内部临时表使用”。

- 从MySQL 8.0.13开始，InnoDB的数据静止加密功能支持通用表空间。以前，只能对每个表的表空间进行加密。为了支持通用表空间的加密，扩展了CREATE TABLESPACE和ALTER TABLESPACE语法，包括一个ENCRYPTION子句。

    Information Schema INNODB_TABLESPACES表现在包括一个ENCRYPTION列，指示表空间是否加密。

    添加了stage/innodb/alter tablespace (encryption)性能模式阶段仪器，以监视通用表空间加密操作。

- 禁用innodb_buffer_pool_in_core_file变量可以通过排除InnoDB缓冲池页面来减小核心文件的大小。要使用此变量，必须启用core_file变量，并且操作系统必须支持MADV_DONTDUMP非POSIX扩展到madvise()，该扩展在Linux 3.4及更高版本中受支持。有关更多信息，请参见第15.8.3.7节“从核心文件中排除缓冲池页面”。

- 从MySQL 8.0.13开始，用户创建的临时表和优化器创建的内部临时表存储在为会话分配的临时表空间中，该临时表空间从临时表空间池中分配。当会话断开连接时，其临时表空间被截断并释放回池中。在以前的版本中，临时表是在全局临时表空间（ibtmp1）中创建的，在临时表被删除后，不会将磁盘空间返回给操作系统。

    innodb_temp_tablespaces_dir变量定义了会话临时表空间的创建位置。默认位置是数据目录中的#innodb_temp目录。

    INNODB_SESSION_TEMP_TABLESPACES表提供有关会话临时表空间的元数据。

    全局临时表空间（ibtmp1）现在存储对用户创建的临时表所做的更改的回滚段。

- 从MySQL 8.0.14开始，InnoDB支持并行聚簇索引读取，可以提高CHECK TABLE性能。此功能不适用于辅助索引扫描。innodb_parallel_read_threads会话变量必须设置为大于1的值，才能进行并行聚簇索引读取。默认值为4。执行并行聚簇索引读取所使用的线程数取决于innodb_parallel_read_threads设置或要扫描的索引子树的数量，以较小者为准。

- 从8.0.14开始，当启用innodb_dedicated_server变量时，根据自动配置的缓冲池大小配置日志文件的大小和数量。以前，日志文件的大小是根据服务器上检测到的内存量进行配置的，并且日志文件的数量不是自动配置的。

- 从8.0.14开始，CREATE TABLESPACE语句的ADD DATAFILE子句是可选的，这允许没有FILE权限的用户创建表空间。执行不带ADD DATAFILE子句的CREATE TABLESPACE语句会隐式创建一个带有唯一文件名的表空间数据文件。

- 默认情况下，当TempTable存储引擎占用的内存量超过temptable_max_ram变量定义的内存限制时，TempTable存储引擎开始从磁盘分配内存映射临时文件。从MySQL 8.0.16开始，此行为由temptable_use_mmap变量控制。禁用temptable_use_mmap会导致TempTable存储引擎使用InnoDB磁盘上的内部临时表，而不是内存映射文件作为其溢出机制。有关更多信息，请参见内部临时表存储引擎。

- 从MySQL 8.0.16开始，InnoDB数据静止加密功能支持对mysql系统表空间进行加密。mysql系统表空间包含mysql系统数据库和MySQL数据字典表。有关更多信息，请参见第15.13节“InnoDB数据静止加密”。

- innodb_spin_wait_pause_multiplier变量在MySQL 8.0.16中引入，可更好地控制当线程等待获取互斥锁或读写锁时发生的自旋锁轮询延迟的持续时间。延迟可以更精细地调整，以考虑不同处理器架构上的PAUSE指令持续时间的差异。有关更多信息，请参见第15.8.8节“配置自旋锁轮询”。

- 通过在MySQL 8.0.17中改进对大数据集的InnoDB并行读取线程性能，可以更好地利用读取线程，通过减少并行扫描期间的预取活动的读取线程I/O，并支持对分区的并行扫描。

    并行读取线程功能由innodb_parallel_read_threads变量控制。最大设置现在为256，即所有客户端连接的总线程数。如果达到线程限制，连接将回退到使用单个线程。

- innodb_idle_flush_pct变量在MySQL 8.0.18中引入，允许在空闲期间限制页面刷新，从而可以延长固态存储设备的使用寿命。请参见限制空闲期间的缓冲刷新。

- 从MySQL 8.0.19开始，支持对InnoDB数据进行高效采样，以生成直方图统计信息。请参见直方图统计分析。

- 从MySQL 8.0.20开始，双写缓冲区存储区域位于双写文件中。在以前的版本中，存储区域位于系统表空间中。将存储区域移出系统表空间可以减少写入延迟，增加吞吐量，并提供关于双写缓冲区页面放置的灵活性。以下系统变量用于高级双写缓冲区配置：

    - innodb_doublewrite_dir

      定义双写缓冲区文件目录。

    - innodb_doublewrite_files

      定义双写文件的数量。

    - innodb_doublewrite_pages

      定义批量写入的每个线程的最大双写页面数。

    - innodb_doublewrite_batch_size

      定义一批写入的双写页面数。

    有关更多信息，请参见第15.6.4节“双写缓冲区”。

- 在MySQL 8.0.20中改进了优先处理等待锁的事务的CATS（Contention-Aware Transaction Scheduling）算法。现在，事务调度权重计算完全在一个单独的线程中进行，提高了计算性能和准确性。

    先进先出（FIFO）算法也用于事务调度，但已被移除。由于CATS算法的改进，FIFO算法变得多余。之前由FIFO算法执行的事务调度现在由CATS算法执行。

    在INFORMATION_SCHEMA.INNODB_TRX表中添加了一个TRX_SCHEDULE_WEIGHT列，允许查询CATS算法分配的事务调度权重。

    为了监控代码级别的事务调度事件，添加了以下INNODB_METRICS计数器：

    - lock_rec_release_attempts：释放记录锁的尝试次数。
    - lock_rec_grant_attempts：授予记录锁的尝试次数。
    - lock_schedule_refreshes：分析等待图以更新事务调度权重的次数。

    有关更多信息，请参见第15.7.6节“事务调度”。

- 从MySQL 8.0.21开始，为了提高需要访问表和行资源的锁队列的并发性能，锁系统互斥锁（lock_sys->mutex）被分片锁取代，并且锁队列被分组为表和页锁队列分片，并由专用的互斥锁保护。之前，单个锁系统互斥锁保护所有锁队列，在高并发系统中成为争用点。新的分片实现允许更精细地访问锁队列。

    锁系统互斥锁（lock_sys->mutex）被以下分片锁取代：

    - 全局锁（lock_sys->latches.global_latch），由64个读写锁对象（rw_lock_t）组成。访问单个锁队列需要共享的全局锁和锁队列分片上的锁。需要访问所有锁队列的操作会获取一个独占的全局锁，该锁会锁定所有表和页锁队列分片。
    - 表分片锁（lock_sys->latches.table_shards.mutexes），由512个互斥锁组成的数组，每个互斥锁专用于512个表锁队列分片之一。
    - 页分片锁（lock_sys->latches.page_shards.mutexes），由512个互斥锁组成的数组，每个互斥锁专用于512个页锁队列分片之一。

    用于监视单个锁系统互斥锁的Performance Schema wait/synch/mutex/innodb/lock_mutex工具被用于监视新的全局锁、表分片锁和页分片锁：

    - wait/synch/sxlock/innodb/lock_sys_global_rw_lock
    - wait/synch/mutex/innodb/lock_sys_table_mutex
    - wait/synch/mutex/innodb/lock_sys_page_mutex

- 从MySQL 8.0.21开始，使用DATA DIRECTORY子句在数据目录之外创建的表和表分区数据文件将被限制在InnoDB已知的目录中。这个改变允许数据库管理员控制表空间数据文件的创建位置，并确保在恢复期间可以找到数据文件。

    通用表空间和每个表的表空间数据文件（.ibd文件）不再可以在undo表空间目录（innodb_undo_directory）中创建，除非该目录已被InnoDB知道。

    已知的目录包括由datadir、innodb_data_home_dir和innodb_directories变量定义的目录。

    在文件-表空间中的InnoDB表进行截断操作会删除现有的表空间并创建一个新的表空间。从MySQL 8.0.21开始，InnoDB会在默认位置创建新的表空间，并在错误日志中写入警告，如果当前表空间目录未知。要让TRUNCATE TABLE在其当前位置创建表空间，在运行TRUNCATE TABLE之前，将目录添加到innodb_directories设置中。

- 从MySQL 8.0.21开始，可以使用ALTER INSTANCE {ENABLE|DISABLE} INNODB REDO_LOG语法来启用和禁用重做日志记录。此功能旨在用于将数据加载到新的MySQL实例中。禁用重做日志记录可以通过避免重做日志写入来加快数据加载速度。

    新的INNODB_REDO_LOG_ENABLE权限允许启用和禁用重做日志记录。

    新的Innodb_redo_log_enabled状态变量允许监视重做日志记录状态。

    请参见禁用重做日志记录。

- 在启动时，InnoDB会根据数据字典中存储的表空间文件路径验证已知表空间文件的路径，以防止表空间文件被移动到不同的位置。在MySQL 8.0.21中引入的新变量innodb_validate_tablespace_paths允许禁用表空间路径验证。此功能适用于不移动表空间文件的环境。禁用表空间路径验证可以提高具有大量表空间文件的系统的启动时间。

    有关更多信息，请参见禁用表空间路径验证。

- 从MySQL 8.0.21开始，在使用基于行的复制时，支持原子DDL的存储引擎将CREATE TABLE ... SELECT语句作为一个事务记录到二进制日志中。以前，它被记录为两个事务，一个用于创建表，另一个用于插入数据。通过这个改变，CREATE TABLE ... SELECT语句现在可以安全地用于基于行的复制，并允许与基于GTID的复制一起使用。有关更多信息，请参见原子数据定义语句支持。

- 在繁忙的系统上截断撤消表空间可能会影响性能，因为相关的刷新操作会从缓冲池中删除旧的撤消表空间页面，并将新的撤消表空间的初始页面刷新到磁盘。为了解决这个问题，从MySQL 8.0.21开始，刷新操作被移除。

    旧的撤消表空间页面会在变得最不常使用时被被动释放，或者在下一个完整检查点时被删除。现在，截断操作期间新的撤消表空间的初始页面会被记录到重做日志中，而不是刷新到磁盘，这也提高了撤消表空间截断操作的持久性。

    为了防止过多的撤消表空间截断操作可能引起的潜在问题，同一撤消表空间在检查点之间的截断操作现在被限制为64次。如果超过了这个限制，撤消表空间仍然可以被设置为非活动状态，但直到下一个检查点之后才会被截断。

    与已弃用的撤消截断刷新操作相关的INNODB_METRICS计数器被移除。移除的计数器包括：undo_truncate_sweep_count、undo_truncate_sweep_usec、undo_truncate_flush_count和undo_truncate_flush_usec。

    请参见撤消表空间。

- 从MySQL 8.0.22开始，新的innodb_extend_and_initialize变量允许配置InnoDB在Linux上如何为文件-表空间和通用表空间分配空间。默认情况下，当操作需要在表空间中分配额外的空间时，InnoDB会为表空间分配页面并在这些页面上物理写入NULL值。如果频繁分配新页面，这种行为会影响性能。您可以在Linux系统上禁用innodb_extend_and_initialize，以避免对新分配的表空间页面进行物理写入NULL值的操作。当禁用innodb_extend_and_initialize时，使用posix_fallocate()调用来分配空间，该调用可以在不物理写入NULL值的情况下保留空间。

    posix_fallocate()操作不是原子操作，这意味着在将空间分配给表空间文件并更新文件元数据之间可能会发生故障。这种故障可能会导致新分配的页面处于未初始化状态，当InnoDB尝试访问这些页面时会导致失败。为了防止这种情况发生，InnoDB在分配新的表空间页面之前写入重做日志记录。如果页面分配操作被中断，将在恢复期间从重做日志记录中重新执行该操作。

- 从MySQL 8.0.23开始，InnoDB支持对属于加密表空间的双写文件页面进行加密。页面使用关联表空间的加密密钥进行加密。有关更多信息，请参见InnoDB数据静态加密。

- 在MySQL 8.0.23中引入的temptable_max_mmap变量定义了TempTable存储引擎在开始将内部临时表数据存储到磁盘之前，允许从内存映射（MMAP）文件中分配的最大内存量。将设置为0将禁止从MMAP文件进行分配。有关更多信息，请参见MySQL中的内部临时表使用。

- 在MySQL 8.0.23中引入的AUTOEXTEND_SIZE选项定义了当表空间满时，InnoDB扩展表空间大小的量，从而可以以更大的增量扩展表空间大小。AUTOEXTEND_SIZE选项与CREATE TABLE、ALTER TABLE、CREATE TABLESPACE和ALTER TABLESPACE语句一起使用。有关更多信息，请参见表空间AUTOEXTEND_SIZE配置。

    在Information Schema INNODB_TABLESPACES表中添加了一个AUTOEXTEND_SIZE大小列。

- 在MySQL 8.0.26中引入的innodb_segment_reserve_factor系统变量允许配置保留为空页面的表空间文件段页面的百分比。有关更多信息，请参见配置保留文件段页面百分比。

- 在支持fdatasync()系统调用的平台上，innodb_use_fdatasync变量允许在操作系统刷新时使用fdatasync()而不是fsync()。fdatasync()系统调用不会刷新文件元数据，除非需要进行后续数据检索，从而提供潜在的性能优势。

- 从MySQL 8.0.28开始，tmp_table_size变量定义了TempTable存储引擎创建的任何单个内存中内部临时表的最大大小。适当的大小限制可以防止单个查询消耗过多的全局TempTable资源。请参见内部临时表存储引擎。

- 从MySQL 8.0.28开始，innodb_open_files变量定义了InnoDB可以同时打开的文件数，可以使用SELECT innodb_set_open_files_limit(N)语句在运行时设置该变量。该语句执行一个存储过程来设置新的限制。

    为了防止非LRU管理的文件占用整个innodb_open_files限制，非LRU管理的文件被限制为innodb_open_files限制的90%，这将为LRU管理的文件保留10%的innodb_open_files限制。

    innodb_open_files限制现在包括临时表空间文件，之前不计入限制。

- 从MySQL 8.0.28开始，InnoDB支持使用ALGORITHM=INSTANT进行ALTER TABLE ... RENAME COLUMN操作。

    有关此功能以及其他支持ALGORITHM=INSTANT的DDL操作的更多信息，请参见第15.12.1节“在线DDL操作”。

- 从MySQL 8.0.29开始，InnoDB支持使用ALGORITHM=INSTANT的ALTER TABLE ... DROP COLUMN操作。

    在MySQL 8.0.29之前，一个立即添加的列只能添加为表的最后一列。从MySQL 8.0.29开始，一个立即添加的列可以添加到表的任何位置。

    立即添加或删除的列会创建受影响行的新版本。最多允许64个行版本。在Information Schema INNODB_TABLES表中添加了一个新的TOTAL_ROW_VERSIONS列，用于跟踪行版本的数量。

    有关支持ALGORITHM=INSTANT的DDL操作的更多信息，请参见第15.12.1节“在线DDL操作”。

- 从MySQL 8.0.30开始，innodb_doublewrite系统变量支持DETECT_ONLY和DETECT_AND_RECOVER设置。使用DETECT_ONLY设置，数据库页面内容不会写入双写缓冲区，并且恢复不会使用双写缓冲区来修复不完整的页面写入。这个轻量级设置仅用于检测不完整的页面写入。DETECT_AND_RECOVER设置等效于现有的ON设置。有关更多信息，请参见第15.6.4节“双写缓冲区”。

- 从MySQL 8.0.30开始，InnoDB支持动态配置重做日志容量。innodb_redo_log_capacity系统变量可以在运行时设置，以增加或减少重做日志文件占用的总磁盘空间。

    随着这个变化，重做日志文件的数量和默认位置也发生了变化。从MySQL 8.0.30开始，InnoDB在数据目录中的#innodb_redo目录中维护32个重做日志文件。以前，默认情况下，InnoDB在数据目录中创建两个重做日志文件，并且重做日志文件的数量和大小由innodb_log_files_in_group和innodb_log_file_size变量控制。这两个变量现在已被弃用。

    当定义了innodb_redo_log_capacity设置时，innodb_log_files_in_group和innodb_log_file_size设置将被忽略；否则，这些设置将用于计算innodb_redo_log_capacity设置（innodb_log_files_in_group * innodb_log_file_size = innodb_redo_log_capacity）。如果没有设置这些变量中的任何一个，重做日志容量将设置为innodb_redo_log_capacity的默认值，即104857600字节（100MB）。

    提供了几个用于监视重做日志和重做日志调整操作的状态变量。

    有关更多信息，请参见第15.6.5节“重做日志”。

- 从MySQL 8.0.31开始，有两个新的状态变量用于监视在线缓冲池调整操作。Innodb_buffer_pool_resize_status_code状态变量报告一个状态码，指示在线缓冲池调整操作的阶段。Innodb_buffer_pool_resize_status_progress状态变量报告一个百分比值，指示每个阶段的进度。

    有关更多信息，请参见第15.8.3.1节“配置InnoDB缓冲池大小”。

- **字符集支持。**默认字符集已从latin1更改为utf8mb4。utf8mb4字符集具有几个新的排序规则，包括utf8mb4_ja_0900_as_cs，这是MySQL中首个用于Unicode的日语特定排序规则。有关更多信息，请参见第10.10.1节“Unicode字符集”。

- **JSON增强功能**。MySQL的JSON功能进行了以下增强或添加：

  - 添加了->>（内联路径）运算符，它等同于对JSON_EXTRACT()的结果调用JSON_UNQUOTE()。

    这是在MySQL 5.7中引入的列路径运算符->的改进；col->>"$.path"等同于JSON_UNQUOTE(col->"$.path")。内联路径运算符可在可以使用JSON_UNQUOTE(JSON_EXTRACT())的任何地方使用，如选择列列表、WHERE和HAVING子句以及ORDER BY和GROUP BY子句。有关运算符的详细信息，请参见运算符的描述，以及JSON路径语法。

  - 添加了两个JSON聚合函数JSON_ARRAYAGG()和JSON_OBJECTAGG()。JSON_ARRAYAGG()以列或表达式作为参数，并将结果作为单个JSON数组聚合。表达式可以评估为任何MySQL数据类型；它不必是JSON值。JSON_OBJECTAGG()接受两个列或表达式，它将它们解释为键和值；它将结果作为单个JSON对象返回。有关更多信息和示例，请参阅第12.19节“聚合函数”。

  - 添加了JSON实用函数JSON_PRETTY()，它以易读的格式输出现有的JSON值；每个JSON对象成员或数组值在单独的行上打印，子对象或数组相对于其父对象缩进2个空格。

    此函数还适用于可以解析为JSON值的字符串。

    有关更详细的信息和示例，请参见第12.17.8节“JSON实用函数”。

  - 在使用ORDER BY对查询中的JSON值进行排序时，每个值现在由排序键的可变长度部分表示，而不是固定大小的部分。在许多情况下，这可以减少过度使用。例如，标量INT甚至BIGINT值实际上只需要很少的字节，因此该空间的其余部分（高达90%或更多）被填充。这个改变对性能有以下好处：

    - 排序缓冲区空间现在被更有效地使用，因此文件排序不需要像使用固定长度排序键时那样早期或经常刷新到磁盘。这意味着可以在内存中排序更多的数据，避免不必要的磁盘访问。
    - 较短的键比较比较快，提供了明显的性能改进。这对于完全在内存中执行的排序以及需要写入和读取磁盘的排序都是如此。

  - 在MySQL 8.0.2中添加了对JSON列值的部分、原地更新的支持，这比在更新任何JSON列时以前所做的完全删除现有的JSON值并写入新值的方式更高效。为了应用这种优化，必须使用JSON_SET()、JSON_REPLACE()或JSON_REMOVE()应用更新。无法向正在更新的JSON文档中添加新元素；文档中的值不能比更新之前占用更多的空间。有关要求的详细讨论，请参见JSON值的部分更新。

    部分更新的JSON文档可以写入二进制日志，占用的空间比记录完整的JSON文档要少。当使用基于语句的复制时，部分更新始终被作为这样的日志记录。要使其与基于行的复制配合使用，必须首先设置binlog_row_value_options=PARTIAL_JSON；有关更多信息，请参阅此变量的描述。

  - 添加了JSON实用函数JSON_STORAGE_SIZE()和JSON_STORAGE_FREE()。JSON_STORAGE_SIZE()返回在部分更新之前用于JSON文档的二进制表示的存储空间（请参见前面的项目）。JSON_STORAGE_FREE()显示类型为JSON的表列在使用JSON_SET()或JSON_REPLACE()进行部分更新后剩余的空间；如果新值的二进制表示比先前的值少，则该值大于零。

    这些函数中的每一个还接受JSON文档的有效字符串表示。对于这样的值，JSON_STORAGE_SIZE()返回其转换为JSON文档后的二进制表示所使用的空间。对于包含JSON文档的字符串表示的变量，JSON_STORAGE_FREE()返回零。如果其（非空）参数无法解析为有效的JSON文档，则任一函数将产生错误，并且如果参数为NULL，则返回NULL。

    有关更多信息和示例，请参见第12.17.8节“JSON实用函数”。

    JSON_STORAGE_SIZE()和JSON_STORAGE_FREE()在MySQL 8.0.2中实现。

  - 在XPath表达式中，添加了对范围（例如$[1 to 5]）的支持。在此版本中还添加了对last关键字和相对寻址的支持，因此$[last]始终选择数组中的最后一个（最高编号）元素，$[last-1]选择倒数第二个元素。last和使用它的表达式也可以包含在范围定义中。例如，$[last-2 to last-1]返回数组中的最后两个元素除一个。有关更多信息和示例，请参见第12.17.8节“搜索和修改JSON值”。

  - 添加了一个符合RFC 7396的JSON合并函数。JSON_MERGE_PATCH()在2个JSON对象上使用时，将它们合并为一个单独的JSON对象，其中的成员是以下集合的并集：

    - 第一个对象的每个成员，在第二个对象中没有具有相同键的成员。
    - 第二个对象的每个成员，在第一个对象中没有具有相同键的成员，并且其值不是JSON null字面值。
    - 具有在两个对象中都存在的键的每个成员，其在第二个对象中的值不是JSON null字面值。

    在此工作的一部分，JSON_MERGE()函数已更名为JSON_MERGE_PRESERVE()。JSON_MERGE()在MySQL 8.0中仍然被识别为JSON_MERGE_PRESERVE()的别名，但现在已被弃用，并可能在将来的MySQL版本中被删除。

    有关更多信息和示例，请参见第12.17.4节“修改JSON值的函数”。

  - 实现了“最后重复键优胜”的重复键的规范化，与RFC 7159和大多数JavaScript解析器一致。这里显示了此行为的示例，只保留具有键x的最右边的成员：

    ```mysql
    mysql> SELECT JSON_OBJECT('x', '32', 'y', '[true, false]',
         >                     'x', '"abc"', 'x', '100') AS Result; 
    +------------------------------------+ 
    | Result                             | 
    +------------------------------------+ 
    | {"x": "100", "y": "[true, false]"} | 
    +------------------------------------+ 
    1 row in set (0.00 sec)
    ```

    这是与MySQL先前版本不兼容的更改，在这些版本中，在这种情况下使用“首个重复键优胜”算法。

    有关更多信息和示例，请参阅《规范化、合并和自动包装JSON值》。

  - 在MySQL 8.0.4中添加了JSON_TABLE()函数。该函数接受JSON数据并将其作为具有指定列的关系表返回。

    此函数的语法为JSON_TABLE(expr, path COLUMNS column_list) [AS] alias)，其中expr是返回JSON数据的表达式，path是应用于源数据的JSON路径，column_list是列定义的列表。下面是一个示例：

    ```mysql
    mysql> SELECT *
        -> FROM
        ->   JSON_TABLE(
        ->     '[{"a":3,"b":"0"},{"a":"3","b":"1"},{"a":2,"b":1},{"a":0},{"b":[1,2]}]',
        ->     "$[*]" COLUMNS(
        ->       rowid FOR ORDINALITY,
        ->
        ->       xa INT EXISTS PATH "$.a",
        ->       xb INT EXISTS PATH "$.b",
        ->
        ->       sa VARCHAR(100) PATH "$.a",
        ->       sb VARCHAR(100) PATH "$.b",
        ->
        ->       ja JSON PATH "$.a",
        ->       jb JSON PATH "$.b"
        ->     )
        ->   ) AS  jt1;
    +-------+------+------+------+------+------+--------+
    | rowid | xa   | xb   | sa   | sb   | ja   | jb     |
    +-------+------+------+------+------+------+--------+
    |     1 |    1 |    1 | 3    | 0    | 3    | "0"    |
    |     2 |    1 |    1 | 3    | 1    | "3"  | "1"    |
    |     3 |    1 |    1 | 2    | 1    | 2    | 1      |
    |     4 |    1 |    0 | 0    | NULL | 0    | NULL   |
    |     5 |    0 |    1 | NULL | NULL | NULL | [1, 2] |
    +-------+------+------+------+------+------+--------+
    ```

    JSON源表达式可以是任何生成有效JSON文档的表达式，包括JSON文字、表列或返回JSON的函数调用，例如JSON_EXTRACT(t1, data, '$.post.comments')。有关更多信息，请参见第12.17.6节“JSON表函数”。

- 数据类型支持。MySQL现在支持在数据类型规范中使用表达式作为默认值。这包括以前无法为BLOB、TEXT、GEOMETRY和JSON数据类型分配默认值的情况。有关详细信息，请参见第11.6节“数据类型默认值”。

- 优化器。增加了以下优化器增强功能：

  - MySQL现在支持不可见索引。不可见索引根本不被优化器使用，但是仍然以正常方式进行维护。索引默认是可见的。不可见索引使得可以在不进行破坏性更改的情况下测试删除索引对查询性能的影响，如果索引确实被需要，就无需撤销更改。请参见第8.3.12节“不可见索引”。

  - MySQL现在支持降序索引：索引定义中的DESC不再被忽略，而是导致键值以降序存储。以前，索引可以以相反的顺序进行扫描，但会带来性能损失。降序索引可以以正序进行扫描，这更高效。降序索引还使得优化器可以在最高效的扫描顺序中使用多列索引，其中一些列按升序排列，其他列按降序排列。请参见第8.3.13节“降序索引”。

  - MySQL现在支持创建函数索引键部分，此类部分索引表达式值而不是列值。函数键部分使得可以索引无法用其他方式索引的值，例如JSON值。有关详细信息，请参见第13.1.15节“CREATE INDEX语句”。

  - 在MySQL 8.0.14及更高版本中，常量文字表达式引起的琐碎WHERE条件将在准备阶段删除，而不是在优化阶段删除。在进程的早期删除条件使得可以简化具有琐碎条件的外连接查询的连接操作，例如以下查询：

    ```mysql
    SELECT * FROM t1 LEFT JOIN t2 ON *condition_1* WHERE *condition_2* OR 0 = 1
    ```

    优化器在准备阶段现在可以看到0 = 1始终为假，因此OR 0 = 1是多余的，并将其删除，留下以下内容：

    ```mysql
    SELECT * FROM t1 LEFT JOIN t2 ON condition_1 where condition_2
    ```

    现在，优化器可以将查询重写为内连接，如下所示：

    ```mysql
    SELECT * FROM t1 LEFT JOIN t2 WHERE condition_1 AND condition_2
    ```

    有关更多信息，请参见第8.2.1.9节“外连接优化”。

  - 在MySQL 8.0.16及更高版本中，MySQL可以在优化时使用常数折叠来处理列与常数值之间的比较，其中常数超出范围或位于与列类型相关的范围边界上，而不是在执行时针对每一行进行处理。例如，给定一个具有TINYINT UNSIGNED列c的表t，优化器可以将条件重写为WHERE c < 256为WHERE 1（完全优化掉条件），或者将WHERE c >= 255重写为WHERE c = 255。

    有关更多信息，请参见“8.2.1.14节，常数折叠优化”。

  - 从MySQL 8.0.16开始，与IN子查询一起使用的半连接优化现在也可以应用于EXISTS子查询。此外，优化器现在解开与子查询附加的WHERE条件中的无关联的等式谓识别，使其可以像IN子查询中的表达式一样处理。这适用于EXISTS和IN子查询。\

    有关更多信息，请参见“8.2.2.1节，使用半连接转换优化IN和EXISTS子查询谓识别”。

  - 从MySQL 8.0.17开始，服务器在上下文化阶段内部将任何不完整的SQL谓识别（即具有形式WHERE value的谓识别，其中value是列名或常数表达式并且没有使用比较运算符）重写为WHERE value <> 0，以便查询解析器，查询优化器和查询执行器仅需要处理完整的谓识别。

    此更改的一个可见影响是，对于布尔值，EXPLAIN输出现在显示true和false，而不是1和0。

    此更改的另一个影响是，在SQL布尔上下文中评估JSON值时，会对JSON整数0进行隐式比较。考虑以下创建和填充的表：

    ```mysql
    mysql> CREATE TABLE test (id INT, col JSON);
    
    mysql> INSERT INTO test VALUES (1, '{"val":true}'), (2, '{"val":false}');
    ```

    以前，当在SQL布尔上下文中比较提取的true或false值时，服务器会尝试将其转换为SQL布尔，如下面使用IS TRUE的查询所示：

    ```mysql
    mysql> SELECT id, col, col->"$.val" FROM test WHERE col->"$.val" IS TRUE;
    
    +------+---------------+--------------+
    | id   | col           | col->"$.val" |
    +------+---------------+--------------+
    |    1 | {"val": true} | true         |
    +------+---------------+--------------+
    ```

    在MySQL 8.0.17及更高版本中，提取的值与JSON整数0的隐式比较导致不同的结果：

    ```
    mysql> SELECT id, col, col->"$.val" FROM test WHERE col->"$.val" IS TRUE;
    +------+----------------+--------------+
    | id   | col            | col->"$.val" |
    +------+----------------+--------------+
    |    1 | {"val": true}  | true         |
    |    2 | {"val": false} | false        |
    +------+----------------+--------------+
    
    ```

    从MySQL 8.0.21开始，您可以在执行测试之前使用JSON_VALUE()对提取的值进行类型转换，如下所示：

    ```
    mysql> SELECT id, col, col->"$.val" FROM test
        ->     WHERE JSON_VALUE(col, "$.val" RETURNING UNSIGNED) IS TRUE;
    +------+---------------+--------------+
    | id   | col           | col->"$.val" |
    +------+---------------+--------------+
    |    1 | {"val": true} | true         |
    +------+---------------+--------------+
    
    ```

    从MySQL 8.0.21开始，服务器提供警告“在SQL布尔上下文中评估JSON值会隐式与JSON整数0进行比较；如果这不是您想要的，请考虑在以这种方式在SQL布尔上下文中比较提取的值时，使用JSON_VALUE RETURNING将JSON转换为SQL数值类型”。

    在MySQL 8.0.17及更高版本中，具有NOT IN（子查询）或NOT EXISTS（子查询）的WHERE条件在MySQL 8.0.17及更高版本中被内部转换为反连接（antijoin）。反连接返回表中没有与连接条件匹配的行的所有行。这样可以删除子查询，从而加快查询执行速度，因为子查询的表现在在顶层进行处理。

    这类似于外连接的IS NULL（不存在）优化，详见EXPLAIN附加信息。

    从MySQL 8.0.21开始，许多情况下，单表UPDATE或DELETE语句现在可以使用半连接转换或子查询材料化。适用于以下形式的语句：

    - UPDATE t1 SET t1.a=value WHERE t1.a IN (SELECT t2.a FROM t2)
    - DELETE FROM t1 WHERE t1.a IN (SELECT t2.a FROM t2)

    可以为满足以下条件的单表UPDATE或DELETE执行此操作：

    - UPDATE或DELETE语句使用具有[NOT] IN或[NOT] EXISTS谓识别的子查询。

    - 语句没有ORDER BY子句，也没有LIMIT子句。

      （多表版本的UPDATE和DELETE不支持ORDER BY或LIMIT。）

    - 目标表不支持读取前写入删除（仅与NDB表相关）。

    - 半连接或子查询材料化是允许的，基于子查询中的任何提示以及optimizer_switch的值。

    当对合格的单表DELETE或UPDATE使用半连接优化时，这在优化器跟踪中可见：对于多表语句，跟踪中有一个join_optimization对象，而对于单表语句则没有。转换还可在EXPLAIN FORMAT=TREE或EXPLAIN ANALYZE的输出中可见；单表语句显示<not executable by iterator executor>，而多表语句报告完整计划。

    从MySQL 8.0.21开始，使用InnoDB表的多表UPDATE语句支持半一致性读取，事务隔离级别低于REPEATABLE READ。

  - **改进的哈希连接性能。**MySQL 8.0.23重新实现了用于哈希连接的哈希表，从而改善了哈希连接的性能。此工作包括修复了一个问题（Bug #31516149，Bug #99933），即哈希连接只能使用连接缓冲区（join_buffer_size）分配的大约2/3的内存。

    新的哈希表通常比旧的哈希表更快，并且在对齐、键/值以及存在许多相等键的情况下使用更少的内存。此外，当哈希表的大小增加时，服务器现在可以释放旧的内存。

- **通用表达式（CTE）**。MySQL现在支持通用表达式，包括非递归和递归的。通用表达式允许使用命名的临时结果集，通过在SELECT语句和某些其他语句之前允许使用WITH子句来实现。有关更多信息，请参见“13.2.20节，WITH（通用表达式）”。

  从MySQL 8.0.19开始，递归通用表达式（CTE）的递归SELECT部分支持LIMIT子句。还支持带有OFFSET的LIMIT。有关更多信息，请参见递归通用表达式。

- **窗口函数**。MySQL现在支持窗口函数，它们对于查询的每一行都使用与该行相关的行进行计算。这些函数包括RANK()、LAG()和NTILE()等函数。此外，现在可以将几个现有的聚合函数用作窗口函数（例如SUM()和AVG()）。有关更多信息，请参见“12.20节，窗口函数”。

- 侧向派生表。派生表现在可以在之前加上LATERAL关键字，以指定它可以引用（依赖于）同一FROM子句中之前表的列。侧向派生表使得可能进行某些不能使用非侧向派生表完成的SQL操作，或者需要使用效率较低的解决方法。请参见“13.2.15.9节，侧向派生表”。

- **单表DELETE语句中的别名**。在MySQL 8.0.16及更高版本中，单表DELETE语句支持使用表别名。

- **正则表达式支持**。以前，MySQL使用Henry Spencer正则表达式库来支持正则表达式运算符（REGEXP，RLIKE）。现在，使用国际组件Unicode（ICU）重新实现了正则表达式支持，它提供了完整的Unicode支持，并且是多字节安全的。REGEXP_LIKE()函数以REGEXP和RLIKE运算符的方式执行正则表达式匹配，这两个运算符现在是该函数的同义词。此外，还提供了REGEXP_INSTR()、REGEXP_REPLACE()和REGEXP_SUBSTR()函数，用于查找匹配位置、执行子字符串替换和提取。regexp_stack_limit和regexp_time_limit系统变量可控制匹配引擎的资源消耗。有关更多信息，请参见“12.8.2节，正则表达式”。有关使用正则表达式的应用程序可能受到实现更改影响的方式，请参见正则表达式兼容性注意事项。

- **内部临时表**。TempTable存储引擎取代了MEMORY存储引擎，成为内存中内部临时表的默认引擎。TempTable存储引擎为VARCHAR和VARBINARY列提供了高效的存储。internal_tmp_mem_storage_engine会话变量定义了内存中内部临时表的存储引擎。允许的值为TempTable（默认值）和MEMORY。temptable_max_ram变量定义了TempTable存储引擎在数据存储到磁盘之前可以使用的最大内存量。

- **日志记录**。这些增强功能是为了改进日志记录而添加的：

  - 错误日志记录已重写为使用MySQL组件架构。传统的错误日志记录是使用内置组件实现的，并且使用系统日志进行的日志记录是作为可加载组件实现的。此外，还提供了可加载的JSON日志写入器。有关更多信息，请参见“5.4.2节，错误日志”。

  - 从MySQL 8.0.30开始，在InnoDB存储引擎可用之前可以隐式加载错误日志组件。通过这种新的加载错误日志组件的方法，可以加载和启用由log_error_services变量定义的组件。

    以前，必须首先使用INSTALL COMPONENT安装错误日志组件，并且只能在InnoDB完全可用后加载，因为要加载的组件列表是从mysql.components表中读取的，该表是一个InnoDB表。

    隐式加载错误日志组件具有以下优点：

    - 日志组件在启动序列中较早加载，使得日志信息更早可用。
    - 它有助于避免在启动过程中发生故障时丢失缓冲的日志信息。
    - 不需要使用INSTALL COMPONENT加载日志组件，简化了错误日志配置。

    仍然支持使用INSTALL COMPONENT显式加载日志组件的方法，以实现向后兼容。

  有关更多信息，请参见“5.4.2.1节，错误日志配置”。

- **备份锁定**。一种新类型的备份锁定允许在线备份期间进行DML操作，同时防止可能导致不一致快照的操作。新的备份锁定由LOCK INSTANCE FOR BACKUP和UNLOCK INSTANCE语法支持。使用这些语句需要BACKUP_ADMIN权限。

- **复制**。对MySQL复制进行了以下增强：

  MySQL复制现在支持对JSON文档的部分更新进行二进制日志记录，使用紧凑的二进制格式，在日志中节省了空间，而不是对完整的JSON文档进行日志记录。当使用基于语句的日志记录时，自动进行紧凑日志记录，并且可以通过将新的binlog_row_value_options系统变量设置为PARTIAL_JSON来启用。有关更多信息，请参见Partial Updates of JSON Values，以及binlog_row_value_options的描述。

- **连接管理**。MySQL服务器现在允许为管理连接专门配置TCP/IP端口。这为普通连接使用的网络接口上允许的单个管理连接提供了一种替代方法，即使已经建立了max_connections个连接。请参见“5.1.12.1节，连接接口”。

  MySQL现在提供了更多对使用压缩来减少发送到服务器的字节数的控制。以前，给定的连接要么是未压缩的，要么使用zlib压缩算法。现在，还可以使用zstd算法，并为zstd连接选择压缩级别。可以在服务器端进行配置允许的压缩算法，以及在连接的发起端进行配置，用于客户端程序连接和参与源/副本复制或组复制的服务器。有关更多信息，请参见“4.2.8节，连接压缩控制”。

- **配置**。MySQL中主机名的最大允许长度已从先前的60个字符增加到255个ASCII字符。这适用于数据字典、mysql系统模式、性能模式、INFORMATION_SCHEMA和sys模式中的主机名相关列；CHANGE MASTER TO语句的MASTER_HOST值；SHOW PROCESSLIST语句输出中的Host列；帐户名称中的主机名（例如在帐户管理语句和DEFINER属性中使用）；以及主机名相关的命令选项和系统变量。

  注意事项：

  - 允许主机名长度的增加可能会影响在主机名列上具有索引的表。例如，在mysql系统模式中索引主机名的表现在具有显式的ROW_FORMAT属性为DYNAMIC，以适应更长的索引值。
  - 一些文件名值的配置设置可能是基于服务器主机名构建的。允许的值受底层操作系统的限制，该操作系统可能不允许文件名足够长以包括255个字符的主机名。这会影响general_log_file、log_error、pid_file、relay_log和slow_query_log_file系统变量和相应选项。如果基于主机名的值对于操作系统来说太长，则必须提供显式更短的值。
  - 虽然服务器现在支持255个字符的主机名，但使用--ssl-mode=VERIFY_IDENTITY选项建立的与服务器的连接受到OpenSSL支持的最大主机名长度的限制。主机名匹配涉及SSL证书的两个字段，其最大长度如下：Common Name：最大长度64；Subject Alternative Name：根据RFC#1034的最大长度。

- **插件**。以前，MySQL插件可以用C或C++编写。现在，插件使用的MySQL头文件包含了C++代码，这意味着插件必须用C++而不是C编写。

- **C API**。MySQL C API现在支持用于与MySQL服务器进行非阻塞通信的异步函数。每个函数是现有同步函数的异步对应函数。如果从服务器连接读取或写入必须等待，同步函数会阻塞。异步函数使应用程序能够检查服务器连接上的工作是否准备好进行。如果没有准备好，应用程序可以在稍后再次检查之前执行其他工作。请参见C API Asynchronous Interface。

- **类型转换的其他目标类型**。函数CAST()和CONVERT()现在支持转换为DOUBLE、FLOAT和REAL类型。在MySQL 8.0.17中添加。请参见“12.10节，转换函数和运算符”。

- **JSON模式验证**。MySQL 8.0.17添加了两个函数JSON_SCHEMA_VALID()和JSON_SCHEMA_VALIDATION_REPORT()，用于根据JSON模式验证JSON文档。JSON_SCHEMA_VALID()如果文档符合模式，则返回TRUE（1），如果不符合，则返回FALSE（0）。JSON_SCHEMA_VALIDATION_REPORT()返回包含验证结果详细信息的JSON文档。以下语句适用于这两个函数：

  - 模式必须符合JSON模式规范的Draft 4。
  - 支持required属性。
  - 不支持外部资源和$ref关键字。
  - 支持正则表达式模式；无效的模式将被静默忽略。

  有关更多信息和示例，请参见“12.17.7节，JSON模式验证函数”。

- **多值索引**。从MySQL 8.0.17开始，InnoDB支持创建多值索引，这是在存储值数组的JSON列上定义的二级索引，可以为单个数据记录创建多个索引记录。这样的索引使用类似`CAST(data->'$.zipcode' AS UNSIGNED ARRAY)`的键部分定义。适合的查询可以自动使用多值索引，可以在EXPLAIN的输出中查看。

  作为此工作的一部分，MySQL添加了一个新的函数JSON_OVERLAPS()和一个新的MEMBER OF()运算符，用于处理JSON文档，并通过在CAST()函数中添加一个新的ARRAY关键字来扩展功能，如下所述：

  - JSON_OVERLAPS()比较两个JSON文档。如果它们包含任何公共的键值对或数组元素，函数返回TRUE（1），否则返回FALSE（0）。如果两个值都是标量值，则函数执行简单的相等性测试。如果一个参数是JSON数组，另一个参数是标量值，则标量值被视为数组元素。因此，JSON_OVERLAPS()是JSON_CONTAINS()的补充。
  - MEMBER OF()测试第一个操作数（标量或JSON文档）是否是作为第二个操作数传递的JSON数组的成员，如果是，则返回TRUE（1），否则返回FALSE（0）。不执行操作数的类型转换。
  - CAST(expression AS type ARRAY)允许通过将JSON文档中的JSON数组在json_path处转换为SQL数组来创建一个功能性索引。类型限定符仅限于CAST()已经支持的类型，但不包括BINARY（不支持）。只有InnoDB支持CAST()（和ARRAY关键字）的此用法，而且只用于创建多值索引。

  有关多值索引的详细信息，包括示例，请参见Multi-Valued Indexes.在第12.17.3节“搜索JSON值的函数”中，提供了关于JSON_OVERLAPS()和MEMBER OF()的信息，以及使用示例。

- **可提示的time_zone**。从MySQL 8.0.17开始，可以使用SET_VAR对time_zone会话变量进行提示。

- **重做日志归档。**从MySQL 8.0.17开始，InnoDB支持重做日志归档。在备份操作进行时，复制重做日志记录的备份工具有时可能无法跟上重做日志的生成，从而导致重做日志记录被覆盖而丢失。重做日志归档功能通过将重做日志记录顺序写入归档文件来解决此问题。备份工具可以根据需要从归档文件复制重做日志记录，从而避免数据丢失的可能性。有关更多信息，请参见Redo Log Archiving。

- **Clone插件**。从MySQL 8.0.17开始，MySQL提供了一个克隆插件，允许在本地或从远程MySQL服务器实例克隆InnoDB数据。本地克隆操作将克隆数据存储在MySQL实例运行的同一服务器或节点上。远程克隆操作将克隆数据通过网络从一个捐赠者MySQL服务器实例传输到启动克隆操作的接收方服务器或节点上。

  克隆插件支持复制。除了克隆数据之外，克隆操作还会提取并传输捐赠者的复制坐标，然后将它们应用于接收方，从而使克隆插件可用于配置Group Replication成员和副本。使用克隆插件进行配置比复制大量事务要快得多且更有效。Group Replication成员还可以配置为使用克隆插件作为恢复的备用方法，以便成员自动选择从种子成员检索组数据的最有效方法。

  有关更多信息，请参见第5.6.7节“克隆插件”和第18.5.4.2节“用于分布式恢复的克隆”。

  从MySQL 8.0.27开始，克隆操作进行时，允许在捐赠者MySQL服务器实例上进行并发的DDL操作。以前，在克隆操作期间会持有备份锁，阻止捐赠者上的并发DDL。要恢复到克隆操作期间阻止捐赠者上的并发DDL的先前行为，请启用clone_block_ddl变量。请参见第5.6.7.4节“克隆和并发DDL”。

  从MySQL 8.0.29开始，clone_delay_after_data_drop变量允许在远程克隆操作开始时，在接收者MySQL服务器实例上删除现有数据之后指定延迟时间。该延迟旨在提供足够的时间，使接收者主机上的文件系统在从捐赠者MySQL服务器实例克隆数据之前释放空间。某些文件系统以异步方式在后台进程中释放空间。在这些文件系统上，在删除现有数据后过早地克隆数据可能导致克隆操作失败，因为空间不足。最大延迟时间为3600秒（1小时）。默认设置为0（无延迟）。

- **哈希连接优化**。从MySQL 8.0.18开始，只要连接中每对表都包含至少一个等值连接条件，并且没有索引适用于任何连接条件，就会使用哈希连接。哈希连接不需要索引，尽管它可以与仅适用于单表谓词的索引一起使用。在大多数情况下，哈希连接比块嵌套循环算法更高效。可以通过以下方式优化这样的连接：

  ```mysql
  SELECT *
      FROM t1
      JOIN t2
          ON t1.c1=t2.c1;
  
  SELECT *
      FROM t1
      JOIN t2
          ON (t1.c1 = t2.c1 AND t1.c2 < t2.c2)
      JOIN t3
          ON (t2.c1 = t3.c1)
  ```

  哈希连接还可以用于笛卡尔积，即没有指定连接条件的情况。

  您可以使用EXPLAIN FORMAT=TREE或EXPLAIN ANALYZE查看特定查询是否使用了哈希连接优化。（在MySQL 8.0.20及更高版本中，您还可以使用省略FORMAT=TREE的EXPLAIN。）

  哈希连接可用内存量受到join_buffer_size值的限制。需要的内存超过此值的哈希连接将在磁盘上执行；磁盘上的哈希连接可以使用的磁盘文件数量受到open_files_limit的限制。

  从MySQL 8.0.19开始，不再支持在MySQL 8.0.18中引入的hash_join优化器开关（hash_join = on仍然作为optimizer_switch值的一部分显示，但设置它不再起作用）。也不再支持HASH_JOIN和NO_HASH_JOIN优化器提示。这个开关和提示现在都已经被弃用；请期待它们在未来的MySQL版本中被移除。在MySQL 8.0.18及更高版本中，可以使用NO_BNL优化器开关禁用哈希连接。

  在MySQL 8.0.20及更高版本中，不再在MySQL服务器中使用块嵌套循环，并且每当以前会使用块嵌套循环时，都会使用哈希连接，即使查询中不包含等值连接条件。这适用于内部非等值连接、半连接、反连接、左外连接和右外连接。优化器开关系统变量的block_nested_loop标志以及BNL和NO_BNL优化器提示仍然受支持，但以后仅用于控制哈希连接的使用。此外，内部和外部连接（包括半连接和反连接）现在都可以使用批量键访问（BKA），它逐步分配连接缓冲区内存，以便单个查询不必使用实际上并不需要的大量资源来解析。从MySQL 8.0.18开始，仅支持内部连接的BKA。

  MySQL 8.0.20还使用迭代执行器替换了以前版本中使用的执行器。这项工作包括替换控制查询形式为`WHERE value IN (SELECT column FROM table WHERE ...)`的旧索引子查询引擎，对于那些未优化为半连接的IN查询，以及以相同形式材料化的查询，这些查询以前依赖于旧的执行器。

  有关更多信息和示例，请参见8.2.1.4节“哈希连接优化”。另请参见批量键访问连接。

- **EXPLAIN ANALYZE语句**。在MySQL 8.0.18中实现了一种新的EXPLAIN语句形式，即EXPLAIN ANALYZE，它以TREE格式为每个用于处理查询的迭代器提供有关SELECT语句执行的详细信息，可以将估计成本与实际查询成本进行比较。这些信息包括启动成本、总成本、由此迭代器返回的行数以及执行的循环次数。

  在MySQL 8.0.21及更高版本中，此语句还支持FORMAT=TREE指定符。TREE是唯一支持的格式。

  有关更多信息，请参见使用EXPLAIN ANALYZE获取信息。

- **查询类型转换注入**。在8.0.18版本及更高版本中，MySQL会将类型转换操作注入到表达式和条件中，其中参数的数据类型与预期的数据类型不匹配。这不会对查询结果或执行速度产生影响，但使查询的执行等效于符合SQL标准的查询，同时保持与先前版本的MySQL的向后兼容性。

  现在，在使用任何标准数值比较运算符（=，>=，>，<，<=，<> /！=或<=>）比较时，会在时间类型（DATE，DATETIME，TIMESTAMP，TIME）和数值类型（SMALLINT，TINYINT，MEDIUMINT，INT / INTEGER，BIGINT; DECIMAL / NUMERIC; FLOAT，DOUBLE，REAL; BIT）之间执行此类隐式转换。在这种情况下，任何不是DOUBLE的值都会被转换为DOUBLE。对于DATE或TIME值与DATETIME值之间的比较，也会执行类型转换，其中参数根据需要转换为DATETIME。

  从MySQL 8.0.21开始，当将字符串类型与其他类型进行比较时，也会执行此类转换。转换的字符串类型包括CHAR，VARCHAR，BINARY，VARBINARY，BLOB，TEXT，ENUM和SET。当将字符串类型的值与数值类型或YEAR进行比较时，字符串转换为DOUBLE；如果另一个参数的类型不是FLOAT，DOUBLE或REAL，则也会转换为DOUBLE。当将字符串类型与DATETIME或TIMESTAMP值进行比较时，字符串转换为DATETIME；当将字符串类型与DATE进行比较时，字符串转换为DATE。

  可以通过查看EXPLAIN ANALYZE、EXPLAIN FORMAT=JSON或（如本例所示）EXPLAIN FORMAT=TREE的输出来查看在给定查询中何时进行转换：

  ```mysql
  mysql> CREATE TABLE d (dt DATETIME, d DATE, t TIME);
  Query OK, 0 rows affected (0.62 sec)
  
  mysql> CREATE TABLE n (i INT, d DECIMAL, f FLOAT, dc DECIMAL);
  Query OK, 0 rows affected (0.51 sec)
  
  mysql> CREATE TABLE s (c CHAR(25), vc VARCHAR(25),
      ->     bn BINARY(50), vb VARBINARY(50), b BLOB, t TEXT,
      ->     e ENUM('a', 'b', 'c'), se SET('x' ,'y', 'z'));
  Query OK, 0 rows affected (0.50 sec)
  
  mysql> EXPLAIN FORMAT=TREE SELECT * from d JOIN n ON d.dt = n.i\G
  *************************** 1. row ***************************
  EXPLAIN: -> Inner hash join (cast(d.dt as double) = cast(n.i as double))
  (cost=0.70 rows=1)
      -> Table scan on n  (cost=0.35 rows=1)
      -> Hash
          -> Table scan on d  (cost=0.35 rows=1)
  
  mysql> EXPLAIN FORMAT=TREE SELECT * from s JOIN d ON d.dt = s.c\G
  *************************** 1. row ***************************
  EXPLAIN: -> Inner hash join (d.dt = cast(s.c as datetime(6)))  (cost=0.72 rows=1)
      -> Table scan on d  (cost=0.37 rows=1)
      -> Hash
          -> Table scan on s  (cost=0.35 rows=1)
  
  1 row in set (0.01 sec)
  
  mysql> EXPLAIN FORMAT=TREE SELECT * from n JOIN s ON n.d = s.c\G
  *************************** 1. row ***************************
  EXPLAIN: -> Inner hash join (cast(n.d asdouble) = cast(s.c as double))
  (cost=0.72 rows=1)
      -> Table scan on s  (cost=0.35 rows=1)
      -> Hash
          -> Table scan on n  (cost=0.37 rows=1)
  1 row in set (0.00 sec)
  ```

  还可以通过执行EXPLAIN [FORMAT=TRADITIONAL]来查看这种转换，此时还需要在执行EXPLAIN语句后发出SHOW WARNINGS命令。

- **对于TIMESTAMP和DATETIME类型的时区支持**。从MySQL 8.0.19开始，服务器接受插入的datetime（TIMESTAMP和DATETIME）值时带有时区偏移量。这个偏移量使用与设置time_zone系统变量时相同的格式，唯一的区别是当偏移量的小时部分小于10时，需要在前面加上零，并且不允许使用“-00:00”。包含时区偏移量的datetime字面值的示例包括'2019-12-11 10:40:30-05:00'，'2003-04-14 03:30:00+10:00'和'2020-01-01 15:35:45+05:30'。

  选择datetime值时不会显示时区偏移量。

  包含时区偏移量的datetime字面值可以用作预处理语句的参数值。

  作为这项工作的一部分，用于设置time_zone系统变量的值现在也限制在-13:59到+14:00的范围内（仍然可以将名称值分配给time_zone，如'EST'，'Posix/Australia/Brisbane'和'Europe/Stockholm'，前提是加载了MySQL时区表；请参见填充时区表）。

  有关更多信息和示例，请参见“MySQL服务器时区支持”部分以及“DATE，DATETIME和TIMESTAMP类型”部分。

- **对于JSON模式CHECK约束失败的原因提供了精确的信息**。当使用JSON_SCHEMA_VALID()指定CHECK约束时，MySQL 8.0.19及更高版本提供了关于此类约束失败原因的精确信息。

  有关示例和更多信息，请参见JSON_SCHEMA_VALID()和CHECK约束。另请参阅“CHECK约束”部分。

- **使用ON DUPLICATE KEY UPDATE的行和列别名**。从MySQL 8.0.19开始，可以使用别名引用要插入的行，以及可选地使用别名引用该行的列。考虑一个具有列a和b的表t上的以下INSERT语句：

  ```mysql
  INSERT INTO t SET a=9,b=5
      ON DUPLICATE KEY UPDATE a=VALUES(a)+VALUES(b);
  ```

  使用别名new表示新行，以及在某些情况下使用别名m和n表示该行的列，可以以多种不同的方式重写INSERT语句，以下是一些示例：

  ```mysql
  INSERT INTO t SET a=9,b=5 AS new
      ON DUPLICATE KEY UPDATE a=new.a+new.b;
  
  INSERT INTO t VALUES(9,5) AS new
      ON DUPLICATE KEY UPDATE a=new.a+new.b;
  
  INSERT INTO t SET a=9,b=5 AS new(m,n)
      ON DUPLICATE KEY UPDATE a=m+n;
  
  INSERT INTO t VALUES(9,5) AS new(m,n)
      ON DUPLICATE KEY UPDATE a=m+n;
  ```

  有关更多信息和示例，请参见“INSERT ... ON DUPLICATE KEY UPDATE语句”部分。

- **SQL标准的显式表子句和表值构造函数**。根据SQL标准，MySQL 8.0.19添加了表值构造函数和显式表子句，并相应地实现为TABLE语句和VALUES语句。

  TABLE语句的格式为TABLE table_name，它等同于SELECT * FROM table_name。它支持ORDER BY和LIMIT子句（后者可以选择使用OFFSET），但不允许选择单个表列。TABLE可以在任何可以使用等效SELECT语句的地方使用，包括连接、并集、INSERT ... SELECT、REPLACE、CREATE TABLE ... SELECT语句和子查询。例如：

  - TABLE t1 UNION TABLE t2等同于SELECT * FROM t1 UNION SELECT * FROM t2
  - CREATE TABLE t2 TABLE t1等同于CREATE TABLE t2 SELECT * FROM t1
  - SELECT a FROM t1 WHERE b > ANY (TABLE t2)等同于SELECT a FROM t1 WHERE b > ANY (SELECT * FROM t2)。

  VALUES可以用于向INSERT、REPLACE或SELECT语句提供表值，它由VALUES关键字后面的一系列行构造（ROW()）组成，用逗号分隔。例如，语句INSERT INTO t1 VALUES ROW(1,2,3), ROW(4,5,6), ROW(7,8,9)提供了与MySQL特定的INSERT INTO t1 VALUES (1,2,3), (4,5,6), (7,8,9)等效的SQL标准。您还可以像选择表一样从VALUES表值构造函数中进行选择，需要注意的是，当这样做时必须提供一个表别名，并且可以像任何其他SELECT一样使用这个SELECT；包括连接、并集和子查询。

  有关TABLE和VALUES的更多信息以及它们的用法示例，请参见本文档的以下部分：

  - 第13.2.16节，“TABLE语句”
  - 第13.2.19节，“VALUES语句”
  - 第13.1.20.4节，“CREATE TABLE ... SELECT语句”
  - 第13.2.7.1节，“INSERT ... SELECT语句”
  - 第13.2.13.2节，“JOIN子句”
  - 第13.2.15节，“子查询”
  - 第13.2.18节，“并集子句”

- **FORCE INDEX、IGNORE INDEX的优化器提示**。MySQL 8.0引入了索引级优化器提示，它们是传统索引提示（请参见第8.9.4节“索引提示”）的类比。新的提示如下所示，以及它们的FORCE INDEX或IGNORE INDEX等效项：

  - GROUP_INDEX：等同于FORCE INDEX FOR GROUP BY

    NO_GROUP_INDEX：等同于IGNORE INDEX FOR GROUP BY

  - JOIN_INDEX：等同于FORCE INDEX FOR JOIN

    NO_JOIN_INDEX：等同于IGNORE INDEX FOR JOIN

  - ORDER_INDEX：等同于FORCE INDEX FOR ORDER BY

    NO_ORDER_INDEX：等同于IGNORE INDEX FOR ORDER BY

  - INDEX：等同于GROUP_INDEX加上JOIN_INDEX加上ORDER_INDEX；等同于没有修饰符的FORCE INDEX

    NO_INDEX：等同于NO_GROUP_INDEX加上NO_JOIN_INDEX加上NO_ORDER_INDEX；等同于没有修饰符的IGNORE INDEX

  例如，以下两个查询是等效的：

  ```mysql
  SELECT a FROM t1 FORCE INDEX (i_a) FOR JOIN WHERE a=1 AND b=2;
  
  SELECT /*+ JOIN_INDEX(t1 i_a) */ a FROM t1 WHERE a=1 AND b=2;
  ```

  之前列出的优化器提示遵循与现有索引级优化器提示相同的基本语法和用法规则。

  这些优化器提示旨在取代FORCE INDEX和IGNORE INDEX，我们计划在将来的MySQL版本中将它们弃用，并随后从MySQL中删除。它们没有实现USE INDEX的单个确切等效项；相反，您可以使用NO_INDEX、NO_JOIN_INDEX、NO_GROUP_INDEX或NO_ORDER_INDEX中的一个或多个来实现相同的效果。

  有关更多信息和使用示例，请参见索引级优化器提示。

- **JSON_VALUE()函数**。MySQL 8.0.21实现了一个新的函数JSON_VALUE()，旨在简化对JSON列进行索引的操作。在其最基本的形式中，它接受一个JSON文档和一个指向该文档中单个值的JSON路径作为参数，还可以使用RETURNING关键字指定返回类型。JSON_VALUE(json_doc, path RETURNING type)等同于以下内容：

  ```mysql
  CAST(
      JSON_UNQUOTE( JSON_EXTRACT(json_doc, path) )
      AS type
  );
  ```

  您还可以类似于在JSON_TABLE()中使用的方式，指定ON EMPTY、ON ERROR或两者都有的子句。

  您可以使用JSON_VALUE()在JSON列上创建一个表达式的索引，如下所示：

  ```mysql
    CREATE TABLE t1(
        j JSON,
        INDEX i1 ( (JSON_VALUE(j, '$.id' RETURNING UNSIGNED)) )
    );
  
  INSERT INTO t1 VALUES ROW('{"id": "123", "name": "shoes", "price": "49.95"}');
  ```

  使用这个表达式的查询，如下所示，可以利用该索引：

  ```mysql
  SELECT j->"$.name" as name, j->"$.price" as price 
      FROM t1
      WHERE JSON_VALUE(j, '$.id' RETURNING UNSIGNED) = 123;
  ```

  在许多情况下，这比在JSON列上创建一个生成列，然后在生成的列上创建索引更简单。

  有关更多信息和示例，请参见JSON_VALUE()的描述。

- **用户评论和用户属性。**MySQL 8.0.21引入了在创建或更新用户账户时设置用户评论和用户属性的功能。用户评论由作为CREATE USER或ALTER USER语句中COMMENT子句的参数传递的任意文本组成。用户属性由以JSON对象形式传递的数据组成，作为CREATE USER或ALTER USER语句中ATTRIBUTE子句的参数。属性可以包含任何有效的键值对，以JSON对象表示。在单个CREATE USER或ALTER USER语句中只能使用COMMENT或ATTRIBUTE之一。

  用户评论和用户属性在内部作为JSON对象存储在一起，评论文本作为具有comment为键的元素的值。可以从Information Schema USER_ATTRIBUTES表的ATTRIBUTE列中检索此信息；由于它是JSON格式，可以使用MySQL的JSON函数和操作符解析其内容（参见第12.17节“JSON函数”）。对用户属性的连续更改与其当前值合并，就像使用JSON_MERGE_PATCH()函数一样。

  示例：

  ```mysql
  mysql> CREATE USER 'mary'@'localhost' COMMENT 'This is Mary Smith\'s account';
  Query OK, 0 rows affected (0.33 sec)
  
  mysql> ALTER USER 'mary'@'localhost'
      -≫     ATTRIBUTE '{"fname":"Mary", "lname":"Smith"}';
  Query OK, 0 rows affected (0.14 sec)
  
  mysql> ALTER USER 'mary'@'localhost'
      -≫     ATTRIBUTE '{"email":"mary.smith@example.com"}';
  Query OK, 0 rows affected (0.12 sec)
  
  mysql> SELECT
      ->    USER,
      ->    HOST,
      ->    ATTRIBUTE->>"$.fname" AS 'First Name',
      ->    ATTRIBUTE->>"$.lname" AS 'Last Name',
      ->    ATTRIBUTE->>"$.email" AS 'Email',
      ->    ATTRIBUTE->>"$.comment" AS 'Comment'
      -> FROM INFORMATION_SCHEMA.USER_ATTRIBUTES
      -> WHERE USER='mary' AND HOST='localhost'\G
  *************************** 1. row ***************************
        USER: mary
        HOST: localhost
  First Name: Mary
   Last Name: Smith
       Email: mary.smith@example.com
     Comment: This is Mary Smith's account
  1 row in set (0.00 sec)
  ```

  有关更多信息和示例，请参见第13.7.1.3节“CREATE USER语句”，第13.7.1.1节“ALTER USER语句”和第26.3.46节“INFORMATION_SCHEMA USER_ATTRIBUTES表”。

- **新的optimizer_switch标志**。MySQL 8.0.21添加了两个新的标志用于optimizer_switch系统变量，如下列表所述：

  - prefer_ordering_index标志

    默认情况下，MySQL在查询包含LIMIT子句的ORDER BY或GROUP BY查询中尝试使用有序索引，只要优化器确定这样做会导致更快的执行。由于在某些情况下，选择不同的优化方式实际上执行效果更好，现在可以通过将prefer_ordering_index标志设置为off来禁用此优化。

    此标志的默认值为on。

  - subquery_to_derived标志

    当将此标志设置为on时，优化器将可用的标量子查询转换为派生表的连接。例如，查询SELECT * FROM t1 WHERE t1.a > (SELECT COUNT(a) FROM t2)将被重写为SELECT t1.a FROM t1 JOIN ( SELECT COUNT(t2.a) AS c FROM t2 ) AS d WHERE t1.a > d.c。

    该优化可以应用于作为SELECT、WHERE、JOIN或HAVING子句的一部分的子查询；包含一个或多个聚合函数但没有GROUP BY子句；不是关联的；并且不使用任何非确定性函数的子查询。

    该优化也可以应用于作为IN、NOT IN、EXISTS或NOT EXISTS参数的表子查询，并且不包含GROUP BY。例如，查询`SELECT * FROM t1 WHERE t1.b < 0 OR t1.a IN (SELECT t2.a + 1 FROM t2)`将被重写为`SELECT a, b FROM t1 LEFT JOIN (SELECT DISTINCT 1 AS e1, t2.a AS e2 FROM t2) d ON t1.a + 1 = d.e2 WHERE t1.b< 0 OR d.e1 IS NOT NULL`。

    此标志的默认值为on。

    从MySQL 8.0.24开始，这种优化也可以应用于相关的标量子查询，通过对其应用额外的分组，然后在提升的谓词上进行外部连接。例如，一个查询语句 SELECT * FROM t1 WHERE (SELECT a FROM t2 WHERE t2.a=t1.a) > 0 可以重写为 SELECT t1.* FROM t1 LEFT OUTER JOIN (SELECT a, COUNT(*) AS ct FROM t2 GROUP BY a) AS derived ON t1.a = derived.a WHERE derived.a > 0。MySQL执行一个基数检查，以确保子查询不返回多行（ER_SUBQUERY_NO_1_ROW）。有关更多信息，请参见第13.2.15.7节“相关子查询”。

    通常情况下，此优化是禁用的，因为在大多数情况下不会带来显著的性能优势；默认情况下该标志被设置为关闭。

  有关更多信息，请参见第8.9.2节“可切换的优化”。另请参见第8.2.1.19节“LIMIT查询优化”，第8.2.2.1节“使用半连接转换优化IN和EXISTS子查询谓词”，以及第8.2.2.4节“使用合并或材料化优化派生表、视图引用和公共表达式”。

- **XML增强**。从MySQL 8.0.21开始，LOAD XML语句现在支持在要导入的XML中使用CDATA部分。

- **支持YEAR类型的强制转换**。从MySQL 8.0.22开始，服务器允许对YEAR进行强制转换。CAST()和CONVERT()函数都支持单个数字、两个数字和四个数字的YEAR值。对于一位数和两位数的值，允许的范围是0-99。四位数的值必须在1901-2155的范围内。YEAR也可以用作JSON_VALUE()函数的返回类型；此函数仅支持四位数的年份。

  字符串、时间和日期以及浮点数值都可以转换为YEAR。不支持将GEOMETRY值强制转换为YEAR。

  有关更多信息，包括转换规则，请参见CONVERT()函数的描述。

- **以UTC格式检索TIMESTAMP值**。MySQL 8.0.22及更高版本支持将系统时区的TIMESTAMP列值转换为UTC DATETIME进行检索，使用CAST(value AT TIME ZONE specifier AS DATETIME)，其中specifier是[INTERVAL] '+00:00'或'UTC'之一。如果需要，可以指定返回的DATETIME值的精度，最多可以指定到6位小数。此结构不支持ARRAY关键字。

  还支持使用时区偏移插入到表中的TIMESTAMP值。不支持在CONVERT()或任何其他MySQL函数或结构中使用AT TIME ZONE。

  有关更多信息和示例，请参见CAST()函数的描述。

- 转储文件输出同步。从MySQL 8.0.22开始，通过SELECT INTO DUMPFILE和SELECT INTO OUTFILE语句向文件写入时支持定期同步。可以通过将select_into_disk_sync系统变量设置为ON来启用此功能；写入缓冲区的大小由为select_into_buffer_size设置的值确定，默认值为131072（217）字节

  此外，可以使用select_into_disk_sync_delay设置同步到磁盘后的可选延迟；默认值为没有延迟（0毫秒）。

  有关更多信息，请参见上述此项中引用的变量的描述。

- **语句的单次预编译**。从MySQL 8.0.22开始，准备语句只需预编译一次，而不是每次执行时都需要预编译。这在执行PREPARE时完成。对于存储过程中的任何语句，也是如此；当首次执行存储过程时，语句只需预编译一次。

  这种改变的一个结果是，所列举的方式中解析准备语句中使用的动态参数的方式也发生了变化：

  - PREPARE语句参数在准备语句时被分配一个数据类型；该类型在每次后续执行语句时保持不变（除非重新准备语句；参见下文）。

    对于准备语句的后续执行中给定参数或用户变量使用不同数据类型可能导致语句被重新准备；因此，建议在重新执行准备语句时使用相同的数据类型来处理给定参数。

  - 下列使用窗口函数的结构不再被接受，以与SQL标准对齐：

    - NTILE(NULL)
    - NTH_VALUE(expr, NULL)
    - LEAD(expr, nn) 和 LAG(expr, nn)，其中nn是一个负数

    这有助于更好地符合SQL标准。有关更多详细信息，请参见各个函数的描述。

  - 准备语句中引用的用户变量现在在准备语句时确定其数据类型；该类型在每次后续执行语句时保持不变。

  - 在存储过程中出现的语句引用的用户变量现在在第一次执行语句时确定其数据类型；该类型在任何后续调用包含的存储过程时保持不变。

  - 当执行形式为SELECT expr1, expr2, ... FROM table ORDER BY ?的准备语句时，将整数值N传递给参数不再导致结果按照选择列表中的第N个表达式排序；结果不再排序，与ORDER BY constant所期望的一样。

  仅对准备的语句或存储过程中使用的语句进行一次准备可以提高语句的性能，因为它消除了重复准备的额外成本。这还避免了可能的准备结构多次回滚，这是MySQL中许多问题的根源。

  有关更多信息，请参见第13.5.1节“PREPARE Statement”。

  MySQL 8.0.22版本开始，服务器内部将所有的RIGHT JOIN处理为LEFT JOIN，消除了一些特殊情况，在解析时未完全进行转换的情况。

- **派生条件推测优化**。MySQL 8.0.22版本（以及之后的版本）实现了对具有物化派生表的查询的派生条件推测。对于这样的查询，例如SELECT * FROM (SELECT i, j FROM t1) AS dt WHERE i > constant，在许多情况下，现在可以将外部WHERE条件推测到派生表中，这种情况下结果为SELECT * FROM (SELECT i, j FROM t1 WHERE i > constant) AS dt。

  以前，如果派生表是物化的而不是合并的，MySQL会先将整个表物化，然后使用WHERE条件限定行。使用派生条件推测优化将WHERE条件移到子查询中，通常可以减少需要处理的行数，从而减少执行查询所需的时间。

  当派生表不使用任何聚合或窗口函数时，可以直接将外部WHERE条件推测到物化的派生表中。当派生表有GROUP BY并且不使用任何窗口函数时，可以将外部WHERE条件作为HAVING条件推测到派生表中。当派生表使用窗口函数并且外部WHERE引用窗口函数的PARTITION子句中使用的列时，也可以推测WHERE条件。派生条件推测默认启用，由优化器开关系统变量的derived_condition_pushdown标志指示。该标志在MySQL 8.0.22中添加，默认设置为on；要为特定查询禁用优化，可以使用NO_DERIVED_CONDITION_PUSHDOWN优化提示（也在MySQL 8.0.22中添加）。如果由于derived_condition_pushdown被设置为off而禁用了优化，可以使用DERIVED_CONDITION_PUSHDOWN为给定查询启用它。

  派生条件推测优化不能用于包含LIMIT子句的派生表。在MySQL 8.0.29之前，当查询包含UNION时，优化也不能使用。在MySQL 8.0.29及更高版本中，条件在大多数情况下可以推测到联合的两个查询块中；有关更多信息，请参见“派生条件推测优化”一节。

  此外，无法将自身使用子查询的条件推测到派生表中，并且无法将WHERE条件推测到作为外连接的内表兼作派生表的派生表中。有关更多信息和示例，请参见“派生条件推测优化”一节。

- **MySQL权限表上的无锁读**。MySQL 8.0.22版本开始，为了允许在MySQL授权表上进行并发的DML和DDL操作，以前在MySQL授权表上获取行锁的读取操作现在执行为非锁定读取。

- 现在作为非锁定读取执行的MySQL授权表操作包括：

  - 通过连接列表和子查询从授权表中读取数据的SELECT语句和其他只读语句，包括使用任何事务隔离级别的SELECT ... FOR SHARE语句。
  - 从授权表中读取数据（通过连接列表或子查询），但不修改它们的DML操作，使用任何事务隔离级别。

  有关更多信息，请参见授权表并发性。

- **64位值对FROM_UNIXTIME()、UNIX_TIMESTAMP()和CONVERT_TZ()的支持**。从MySQL 8.0.28版本开始，FROM_UNIXTIME()、UNIX_TIMESTAMP()和CONVERT_TZ()函数在支持64位的平台上处理64位值。这包括64位版本的Linux、MacOS和Windows。

  在兼容的平台上，UNIX_TIMESTAMP()现在处理的值高达'3001-01-18 23:59:59.999999' UTC，FROM_UNIXTIME()可以转换的值高达Unix纪元后的32536771199.999999秒；CONVERT_TZ()现在接受的值在转换后不超过'3001-01-18 23:59:59.999999' UTC。

  这些函数在32位平台上的行为不受这些更改的影响。TIMESTAMP类型的行为也不受影响（在任何平台上）；要在'2038-01-19 03:14:07.999999' UTC之后使用日期时间，请改用DATETIME类型。

  有关更多信息，请参见第12.7节“日期和时间函数”中刚讨论的各个函数的描述。

- **资源分配控制**。从MySQL 8.0.28开始，您可以通过检查Global_connection_memory状态变量来查看由所有普通用户发出的查询使用的内存量。（此总数不包括系统用户（如MySQL root）使用的资源。它还不包括InnoDB缓冲池使用的任何内存。）

  要启用对Global_connection_memory的更新，必须设置global_connection_memory_tracking = 1；默认情况下，此值为0（关闭）。您可以通过设置connection_memory_chunk_size来控制更新Global_connection_memory的频率。

  还可以通过设置以下列出的系统变量之一，在会话或全局级别上为普通用户设置内存使用限制：

  - connection_memory_limit：为每个连接分配的内存量。当任何用户的内存超过此限制时，将拒绝来自该用户的新查询。
  - global_connection_memory_limit：为所有连接分配的内存量。当超过此限制时，将拒绝来自任何普通用户的新查询。

  这些限制不适用于系统进程或管理帐户。

  有关更多信息，请参见引用变量的描述。

- **分离的XA事务**。MySQL 8.0.29添加了对XA事务的支持，一旦准备就绪，它们不再与发起连接相关联。这意味着它们可以由另一个连接提交或回滚，并且当前会话可以立即开始另一个事务。

  系统变量xa_detach_on_prepare控制XA事务是否分离；默认值为ON，导致所有XA事务都分离。在此情况下，不允许对XA事务使用临时表。

  有关更多信息，请参见第13.3.8.2节“XA事务状态”。

- **自动二进制日志清除控制**。MySQL 8.0.29增加了binlog_expire_logs_auto_purge系统变量，提供了一个单一的接口来启用和禁用二进制日志的自动清除。默认情况下，此选项已启用（ON）；要禁用二进制日志文件的自动清除，请将此变量设置为OFF。

  为了使二进制日志文件的自动清除生效，binlog_expire_logs_auto_purge必须为ON；此变量的值优先于任何其他服务器选项或变量的值，包括（但不限于）binlog_expire_logs_seconds。

  binlog_expire_logs_auto_purge的设置对PURGE BINARY LOGS没有影响。

- **条件性的存储过程和触发器创建语句**。从MySQL 8.0.29开始，以下语句支持IF NOT EXISTS选项：

  - CREATE FUNCTION
  - CREATE PROCEDURE
  - CREATE TRIGGER

  对于用于创建存储函数和CREATE PROCEDURE的CREATE FUNCTION，如果已经存在具有相同名称的例程，则此选项可以防止出现错误。对于用于创建可加载函数的CREATE FUNCTION，如果已经存在具有该名称的可加载函数，则此选项可以防止出现错误。对于CREATE TRIGGER，如果同一模式和同一表中已经存在具有相同名称的触发器，则此选项可以防止出现错误。

  此改进使得这些语句的语法与CREATE DATABASE、CREATE TABLE、CREATE USER和CREATE EVENT更加接近（这些语句已经支持IF NOT EXISTS），并且与DROP PROCEDURE、DROP FUNCTION和DROP TRIGGER语句支持的IF EXISTS选项相辅相成。

  有关更多信息，请参阅所示SQL语句的描述，以及函数名称解析。另请参阅第17.5.1.7节“复制CREATE TABLE ... SELECT语句”。

- **包含FIDO库升级**。MySQL 8.0.30将包含的fido2库（与authentication_fido插件一起使用）从版本1.5.0升级到版本1.8.0。

  有关详细信息，请参阅第6.4.1.11节“FIDO可插入认证”。

- **字符集**：特定语言的排序规则。以前，当多种语言具有完全相同的排序规则定义时，MySQL仅为其中一种语言实现排序规则，这意味着有些语言仅由其他语言特定的utf8mb4 Unicode 9.0排序规则进行排序。MySQL 8.0.30（及更高版本）通过为以前仅由其他语言特定排序规则覆盖的那些语言提供特定语言排序规则来修复此类问题。新排序规则覆盖的语言如下所示：

  - 挪威（尼诺斯克）

    和

    挪威（博克马尔）

  - 塞尔维亚（拉丁字符）

  - 波斯尼亚（拉丁字符）

  - 保加利亚

  - 加利西亚语

  - 蒙古语（西里尔字符）

  MySQL为上述每种语言提供了*_as_cs和*_ai_ci排序规则。

  有关更多信息，请参阅特定语言排序规则。

- **REVOKE的IF EXISTS和IGNORE UNKNOWN USER选项**。MySQL 8.0.30为REVOKE实现了两个新选项，用于确定当语句中指定的用户、角色或特权无法找到或无法分配时，语句是否产生错误或警告。下面提供了基本的语法示例，显示了这些新选项的放置位置：

  ```mysql
  REVOKE [IF EXISTS] privilege_or_role 
      ON object 
      FROM user_or_role [IGNORE UNKNOWN USER]
  ```

  IF EXISTS使得不成功的REVOKE语句在目标用户或角色实际存在时引发警告，而不是错误，尽管语句中引用的任何无法找到的角色或特权。

  IGNORE UNKNOWN USER使得不成功的REVOKE在目标用户不存在时不会引发错误或警告。

  有关更多信息和示例，请参见第13.7.1.8节“REVOKE语句”。

- **生成的不可见主键**。从MySQL 8.0.30开始，可以运行一个复制源服务器，以便在创建没有显式主键的InnoDB表时向其添加生成的不可见主键（GIPK）。添加到此类表的生成的键列定义与此处显示的等效：

  ```mysql
  my_row_id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT INVISIBLE PRIMARY KEY
  ```

  默认情况下，不启用GIPK模式。要启用它，请将sql_generate_invisible_primary_key服务器系统变量设置为ON。

  生成的不可见主键通常在诸如SHOW CREATE TABLE和SHOW INDEX之类的语句以及MySQL信息模式表（如COLUMNS和STATISTICS表）的输出中可见。您可以通过将show_gipk_in_create_table_and_information_schema设置为OFF来隐藏它们。

  作为这项工作的一部分，mysqldump和mysqlpump添加了一个新的--skip-generated-invisible-primary-key选项，用于从其输出中排除生成的不可见主键、列和列值。

- **GIPK和带或不带主键的表之间的复制**。在MySQL复制中，副本实际上忽略源上的sql_generate_invisible_primary_key设置，因此对复制的表没有影响。从MySQL 8.0.32开始，副本可以向任何以复制为初始状态的InnoDB表添加生成的不可见主键，而这些表否则没有主键。您可以通过在副本上调用CHANGE REPLICATION SOURCE TO ... REQUIRE_TABLE_PRIMARY_KEY_CHECK = GENERATE来实现这一点。

  REQUIRE_TABLE_PRIMARY_KEY_CHECK = GENERATE与MySQL Group Replication不兼容。

  有关更多信息，请参见第13.1.20.11节“生成的不可见主键”。

- **崩溃安全的XA事务**。以前，对于二进制日志而言，XA事务在意外停止时并不完全具有韧性，如果服务器在执行XA PREPARE、XA COMMIT或XA ROLLBACK时发生意外停止，则无法保证服务器能够恢复到正确的状态，可能会在二进制日志中留下未应用的额外的XA事务，或丢失一个或多个已应用的XA事务。从MySQL 8.0.30开始，这不再是问题，当重新加入时，服务器可以始终将退出复制拓扑的服务器带回一致的XA事务状态。

  已知问题：当使用相同的事务XID按顺序执行XA事务，并且在执行XA COMMIT ... ONE PHASE时发生断开连接，并且在此事务在存储引擎中准备完毕后，可能无法再同步二进制日志和存储引擎之间的状态。

  有关更多信息，请参见第13.3.8.3节“对XA事务的限制”。

- **与UNION嵌套**。从MySQL 8.0.31开始，使用UNION，可以将括号化的查询表达式的主体与UNION嵌套最多63级。此类查询以前会被拒绝并显示错误ER_NOT_SUPPORTED_YET，但现在是允许的。这里展示了这样一个查询的EXPLAIN输出：

  ```mysql
  mysql> EXPLAIN FORMAT=TREE ( 
      ->   (SELECT a, b, c FROM t ORDER BY a LIMIT 3) ORDER BY b LIMIT 2
      -> ) ORDER BY c LIMIT 1\G
  *************************** 1. row ***************************
  EXPLAIN: -> Limit: 1 row(s)  (cost=5.55..5.55 rows=1)
      -> Sort: c, limit input to 1 row(s) per chunk  (cost=2.50 rows=0)
          -> Table scan on <result temporary>  (cost=2.50 rows=0)
              -> Temporary table  (cost=5.55..5.55 rows=1)
                  -> Limit: 2 row(s)  (cost=2.95..2.95 rows=1)
                      -> Sort: b, limit input to 2 row(s) per chunk  (cost=2.50 rows=0)
                          -> Table scan on <result temporary>  (cost=2.50 rows=0)
                              -> Temporary table  (cost=2.95..2.95 rows=1)
                                  -> Limit: 3 row(s)  (cost=0.35 rows=1)
                                      -> Sort: t.a, limit input to 3 row(s) per chunk  (cost=0.35 rows=1)
                                          -> Table scan on t  (cost=0.35 rows=1)
  
  1 row in set (0.00 sec)
  ```

  MySQL在折叠括号查询表达式的主体时遵循SQL标准语义，因此较高的外部限制不能覆盖较低的内部限制。例如，(SELECT ... LIMIT 5) LIMIT 10最多只能返回五行。

  63级限制只在MySQL优化器的解析器执行任何简化或合并之后施加。

  有关更多信息，请参见第13.2.11节，“括号查询表达式”。

- 禁用查询重写。以前，当使用Rewriter插件时，所有查询都会被重写，无论用户如何。在某些情况下，这可能会带来问题，例如当管理系统时，或者当应用来自复制源或由mysqldump或其他MySQL程序创建的转储文件的语句时。 MySQL 8.0.31通过实现新的用户权限SKIP_QUERY_REWRITE来解决这些问题；具有此权限的用户发出的语句将被Rewriter忽略并且不会被重写。

    MySQL 8.0.31还添加了一个新的服务器系统变量rewriter_enabled_for_threads_without_privilege_checks。当设置为OFF时，由PRIVILEGE_CHECKS_USER为NULL的线程（例如复制应用程序线程）发出的可重写语句将不会被Rewriter插件重写。默认值为ON，这意味着这些语句将被重写。

    有关更多信息，请参见第5.6.4节，“Rewriter Query Rewrite Plugin”。

- **XA语句的复制过滤**。以前，使用--replicate-do-db或--replicate-ignore-db时，默认数据库会过滤XA START、XA END、XA COMMIT和XA ROLLBACK语句，这可能会导致事务丢失。从MySQL 8.0.31开始，在这种情况下，这些语句不会被过滤，而与binlog_format的值无关。

- **复制过滤和权限检查**。从MySQL 8.0.31开始，当使用复制过滤时，副本不再因被过滤的事件相关的权限检查或require_row_format验证而引发复制错误，从而可以过滤掉任何验证失败的事务。

    因为过滤行的权限检查不再会导致复制停止，所以副本现在只能接受给定用户被授予访问权限的数据库部分；只要对数据库的此部分的更新仅以行为基础的格式进行复制，这就是真实的。

    这个功能在从使用表进行管理或其他目的的本地或云服务迁移到MySQL HeatWave服务时也可能有用，其中入站复制用户无权访问。

    有关更多信息，请参见第17.2.5节“服务器如何评估复制过滤规则”和第17.5.1.29节“复制期间的副本错误”。

- INTERSECT和EXCEPT表运算符。MySQL 8.0.31添加了对SQL INTERSECT和EXCEPT表运算符的支持。其中a和b表示查询的结果集，这些运算符的行为如下：

  - a INTERSECT b仅包括出现在结果集a和b中的行。
  - a EXCEPT b返回结果集a中不在b中出现的行。

  INTERSECT DISTINCT、INTERSECT ALL、EXCEPT DISTINCT和EXCEPT ALL都得到支持；DISTINCT是INTERSECT和EXCEPT的默认值（与UNION相同）。

  有关更多信息和示例，请参见第13.2.8节“INTERSECT子句”和第13.2.4节“EXCEPT子句”。

- **用户定义的直方图**。从MySQL 8.0.31开始，可以将列的直方图设置为用户指定的JSON值。可以使用以下SQL语法来完成这个操作：

  ```mysql
  ANALYZE TABLE tbl_name 
    UPDATE HISTOGRAM ON col_name
    USING DATA 'json_data'
  ```

  这个语句使用直方图的JSON表示json_data为表tbl_name的列col_name创建或覆盖直方图。执行这个语句后，可以通过查询信息模式COLUMN_STATISTICS表来验证直方图是否已创建或更新，像这样：

  ```mysql
  SELECT HISTOGRAM FROM INFORMATION_SCHEMA.COLUMN_STATISTICS
    WHERE TABLE_NAME='tbl_name' 
    AND COLUMN_NAME='col_name';
  ```

  返回的列值应该与之前的ANALYZE TABLE语句中使用的json_data相同。

  在某些情况下，这可能会有用，例如直方图采样过程中遗漏了被认为重要的值。当发生这种情况时，您可能需要修改直方图或根据完整数据集设置自己的直方图。此外，对大型用户数据集进行采样并从中构建直方图是资源密集型操作，可能会影响用户查询。通过这个增强功能，直方图生成可以从（主）服务器转移到副本上进行；然后将生成的直方图分配给源服务器上的适当表列。

  有关更多信息和示例，请参见直方图统计分析。

- **服务器构建ID（Linux）**。MySQL 8.0.31为Linux系统添加了只读的build_id系统变量，在编译时生成一个160位的SHA1签名；build_id的值是生成的值转换为十六进制字符串的形式，为构建提供了唯一标识符。

  每次MySQL启动时，build_id都会写入服务器日志。

  如果您从源代码构建MySQL，您可以观察到每次重新编译服务器时此值都会发生变化。有关更多信息，请参见第2.8节“从源代码安装MySQL”。

  此变量在Linux以外的平台上不受支持。

- **默认的EXPLAIN输出格式**。MySQL 8.0.32添加了一个系统变量explain_format，用于确定在没有任何FORMAT选项的情况下，从EXPLAIN语句获取查询执行计划的输出格式。例如，如果explain_format的值为TREE，则任何这样的EXPLAIN语句的输出都使用树状格式，就像语句指定了FORMAT=TREE一样。

  这个行为会被FORMAT选项中设置的值覆盖。假设explain_format被设置为TREE；即使如此，EXPLAIN FORMAT=JSON stmt也会使用JSON输出格式显示结果。

  有关更多信息和示例，请参见explain_format系统变量的描述，以及获取执行计划信息。对于EXPLAIN ANALYZE的行为也有影响，请参见使用EXPLAIN ANALYZE获取信息。

- **ST_TRANSFORM()笛卡尔SRS支持**。在MySQL 8.0.30之前，ST_TRANSFORM()函数不支持笛卡尔空间参考系统。在MySQL 8.0.30及更高版本中，该函数提供对Popular Visualisation Pseudo Mercator（EPSG 1024）投影方法的支持，用于WGS 84 Pseudo-Mercator（SRID 3857）。MySQL 8.0.32及更高版本支持除EPSG 1042、EPSG 1043、EPSG 9816和EPSG 9826之外的所有笛卡尔SRS。

#### MySQL 8.0中弃用的功能

以下功能在MySQL 8.0中已弃用，并可能在将来的版本中被移除。如果提供了替代方案，应用程序应更新以使用这些替代方案。

对于在MySQL 8.0中被弃用并在较高版本的MySQL系列中被移除的功能，当从MySQL 8.0源复制到较高系列的副本时，语句可能会失败，或者在源和副本上产生不同的效果。为了避免这样的问题，使用在8.0中被弃用的功能的应用程序应进行修改以避免使用它们，并在可能的情况下使用替代方案。

- **数据库授权中的通配符字符**。在MySQL 8.0.35中，将%和_字符作为数据库授权中的通配符使用已被弃用。您应该预期通配符功能在将来的MySQL版本中被移除，并且这些字符始终被视为字面值，就像partial_revokes服务器系统变量的值为ON时一样。

- 此外，在检查权限时，服务器将%视为localhost的同义词的处理方式在MySQL 8.0.35中也已被弃用，因此可能在将来的MySQL版本中被移除。

- 可插拔的FIDO身份验证在MySQL 8.0.35及更高版本中已被弃用。

- --character-set-client-handshake选项最初用于与非常旧版本的MySQL升级时已被弃用，在MySQL 8.0.35及更高版本的MySQL 8.0发布中，每当使用它时会发出警告。您应该预期该选项在将来的MySQL版本中被移除；依赖于该选项的应用程序应尽快迁移到其他选项上。

- 旧的和新的服务器系统变量及其相关的服务器选项在MySQL 8.0中已被弃用，从MySQL 8.0.35开始。每当设置或读取这些变量之一时，现在都会发出警告。由于这些变量将在将来的MySQL版本中被移除，依赖于它们的应用程序应尽快迁移到其他选项上。

- 在MySQL 8.0.34中，旧版审计日志过滤模式已被弃用。为旧版审计日志过滤系统变量发出新的弃用警告。这些弃用的变量要么是只读的，要么是动态的。

  （只读）audit_log_policy在服务器启动时，如果值不是ALL（默认值），则会将警告消息写入MySQL服务器错误日志。

  （动态）audit_log_include_accounts、audit_log_exclude_accounts、audit_log_statement_policy和audit_log_connection_policy。根据使用情况，动态变量会打印警告消息：

  - 在MySQL服务器启动时，在audit_log_include_accounts或audit_log_exclude_accounts中传入非NULL值会将警告消息写入服务器错误日志。
  - 在MySQL服务器启动时，在audit_log_statement_policy或audit_log_connection_policy中传入非默认值会将警告消息写入服务器错误日志。ALL是这两个变量的默认值。
  - 在MySQL客户端会话期间使用SET语法更改现有值会将警告消息写入客户端日志。
  - 在MySQL客户端会话期间使用SET PERSIST语法持久化变量会将警告消息写入客户端日志。

- 在MySQL 8.0.34及更高版本中，如果一个帐户尝试使用mysql_native_password作为认证方法进行认证，mysql_native_password认证插件已被弃用，并且会在服务器错误日志中产生弃用警告。

- ssl_fips_mode服务器系统变量，--ssl-fips-mode客户端选项和MYSQL_OPT_SSL_FIPS_MODE选项已被弃用，并可能在将来的MySQL版本中被移除。

- 在MySQL 8.0.34中，keyring_file和keyring_encrypted_file插件已被弃用。这些keyring插件已被component_keyring_file和component_keyring_encrypted_file组件取代。有关keyring组件和插件的简明比较，请参见《6.4.4.1节Keyring组件与Keyring插件》。

- 自MySQL 8.0.31起，keyring_oci插件已被弃用，并可能在将来的MySQL版本中被移除。相反，建议考虑使用component_keyring_oci组件存储keyring数据（参见《6.4.4.11节使用Oracle Cloud Infrastructure Vault Keyring组件》）。

- utf8mb3字符集已被弃用。请改用utf8mb4。

- 以下字符集已被弃用：

  - ucs2（参见《10.9.4节ucs2字符集（UCS-2 Unicode编码）》）
  - macroman和macce（参见《10.10.2节西欧字符集》和《10.10.3节中欧字符集》）
  - dec（参见《10.10.2节西欧字符集》）
  - hp8（参见《10.10.2节西欧字符集》）

  在MySQL 8.0.28及更高版本中，以任何这些字符集或它们的排序使用以下方式之一时，都会产生弃用警告：

  - 使用--character-set-server或--collation-server启动MySQL服务器时
  - 在任何SQL语句中指定，包括但不限于CREATE TABLE、CREATE DATABASE、SET NAMES和ALTER TABLE

  您应该改用utf8mb4代替之前列出的任何字符集。

- 自定义排序已被弃用。从MySQL 8.0.33开始，以下任一操作会导致警告写入日志：

  - 在任何SQL语句中的COLLATE与用户定义排序的名称一起使用
  - 将用户定义排序的名称用作collation_server、collation_database或collation_connection的值。

  您应该预期在将来的MySQL版本中移除对用户定义排序的支持。

- 由于caching_sha2_password是MySQL 8.0中的默认身份验证插件，并且提供了sha256_password身份验证插件功能的超集，因此sha256_password已被弃用；预计在将来的MySQL版本中将其移除。使用sha256_password进行身份验证的MySQL帐户应该迁移到使用caching_sha2_password。

- validate_password插件已被重新实现以使用组件基础结构。validate_password插件形式仍可用，但现已弃用；预计在将来的MySQL版本中将其移除。使用插件的MySQL安装应该过渡到使用组件。请参见《6.4.3.3节过渡到密码验证组件》。

- ALTER TABLESPACE和DROP TABLESPACE语句的ENGINE子句已被弃用。

- PAD_CHAR_TO_FULL_LENGTH SQL模式已被弃用。

- 对于FLOAT和DOUBLE（及其任何同义词）类型的列，不推荐使用AUTO_INCREMENT。考虑从这些列中删除AUTO_INCREMENT属性，或将其转换为整数类型。

- 对于FLOAT、DOUBLE和DECIMAL（及其任何同义词）类型的列，UNSIGNED属性已被弃用。考虑为这些列使用简单的CHECK约束。

- FLOAT(M,D)和DOUBLE(M,D)语法用于指定FLOAT和DOUBLE（及其任何同义词）类型的列的数字位数是非标准的MySQL扩展。此语法已被弃用。

- 对于数值数据类型，ZEROFILL属性已被弃用，整数数据类型的显示宽度属性也是如此。考虑使用其他方法来产生这些属性的效果。例如，应用程序可以使用LPAD()函数将数字填充为所需的宽度，或者可以将格式化后的数字存储在CHAR列中。

- 对于字符串数据类型，BINARY属性是一个非标准的MySQL扩展，它是指定列字符集的二进键（_bin）排序的简写形式（如果未指定列字符集，则为表默认字符集的二进制（_bin）排序）。在MySQL 8.0中，BINARY的这种非标准用法是有歧义的，因为utf8mb4字符集有多个_bin排序，所以BINARY属性已被弃用；预计在将来的MySQL版本中将不再支持它。应该调整应用程序以使用显式的_bin排序。

  使用BINARY指定数据类型或字符集的用法保持不变。

- 先前的MySQL版本支持非标准的缩写表达式ASCII和UNICODE，分别用于CHARACTER SET latin1和CHARACTER SET ucs2。ASCII和UNICODE已被弃用（MySQL 8.0.28及更高版本），并且现在会产生警告。在这两种情况下，应改用CHARACTER SET。

- 非标准的C风格的&&、||和!运算符分别是标准SQL的AND、OR和NOT运算符的同义词，已被弃用。使用非标准运算符的应用程序应调整为使用标准运算符。

  > **注意事项**
  >
  > 除非启用了PIPES_AS_CONCAT SQL模式，否则已弃用||的使用（在这种情况下，||表示SQL标准的字符串连接运算符）。
  >

- JSON_MERGE()函数已被弃用。请改用JSON_MERGE_PRESERVE()。

- SQL_CALC_FOUND_ROWS查询修饰符和相关的FOUND_ROWS()函数已被弃用。有关替代策略的信息，请参阅FOUND_ROWS()描述。

- 从MySQL 8.0.13开始，使用CREATE TEMPORARY TABLE的TABLESPACE = innodb_file_per_table和TABLESPACE = innodb_temporary子句已被弃用。

- 对于SELECT语句，在FROM后但不在SELECT语句末尾使用INTO子句已在MySQL 8.0.20中被弃用。最好将INTO子句放在语句的末尾。

  对于UNION语句，以下两种包含INTO的变体已在MySQL 8.0.20中被弃用：

  - 在查询表达式的尾随查询块中，在FROM之前使用INTO。
  - 在查询表达式的括号尾随块中，不管其相对于FROM的位置如何，都使用INTO。

  请参阅第13.2.13.1节，“SELECT ... INTO语句”，以及第13.2.18节，“UNION子句”。

- 从MySQL 8.0.23开始，FLUSH HOSTS已被弃用。取而代之的是截断性能模式host_cache表：

  ```mysql
  TRUNCATE TABLE performance_schema.host_cache;
  ```

  TRUNCATE TABLE操作需要对表的DROP权限。

- mysql_upgrade客户端已被弃用，因为其升级MySQL系统模式中的系统表和其他模式中的对象的能力已移至MySQL服务器。请参阅第2.10.3节，“MySQL升级过程升级了什么”。

- --no-dd-upgrade服务器选项已被弃用。它被--upgrade选项所取代，后者提供了更精细的数据字典和服务器升级行为控制。

- mysql_upgrade_info文件用于创建数据目录并存储MySQL版本号，已被弃用；期望在将来的MySQL版本中将其移除。

  relay_log_info_file系统变量和--master-info-file选项已被弃用。以前，当设置relay_log_info_repository=FILE和master_info_repository=FILE时，它们用于指定继电器日志信息日志和源信息日志的名称，但这些设置已被弃用。使用文件来作为继电器日志信息日志和源信息日志的方式已被crash-safe复制表取代，这在MySQL 8.0中是默认的。

- max_length_for_sort_data系统变量现已被弃用，因为优化器的更改使其变得过时且无效。

- 对于连接到服务器的连接的压缩的这些遗留参数已被弃用：--compress客户端命令行选项；mysql_options()C API函数的MYSQL_OPT_COMPRESS选项；slave_compressed_protocol系统变量。有关替代参数的信息，请参阅第4.2.8节，“连接压缩控制”。

- 已弃用使用MYSQL_PWD环境变量来指定MySQL密码。

- 从MySQL 8.0.20开始，已弃用在INSERT ... ON DUPLICATE KEY UPDATE中使用VALUES()来访问新行的值。改为使用新行和列的别名。

- 因为在调用JSON_TABLE()时在ON ERROR之前使用ON EMPTY与SQL标准相违背，所以在MySQL中这种语法现在已经被弃用。从MySQL 8.0.20开始，每当您尝试这样做时，服务器都会打印警告。在单个JSON_TABLE()调用中指定这两个子句时，请确保首先使用ON EMPTY。

- 从未支持具有索引前缀的列作为表的分区键的一部分；以前，在创建、修改或升级分区表时允许这些列，但被表的分区函数排除了，并且服务器没有发出关于这种情况的警告。这种宽容的行为现在已经弃用，并且在将来的MySQL版本中使用任何这种列作为分区键将导致拒绝CREATE TABLE或ALTER TABLE语句。

- 从MySQL 8.0.21开始，每当指定使用索引前缀的列作为分区键的一部分时，将为每个这样的列生成一个警告。每当由于所提议的分区键中的所有列都具有索引前缀而拒绝CREATE TABLE或ALTER TABLE语句时，现在的错误提供了拒绝的确切原因。在这两种情况下，都包括在分区函数中使用的列，它们通过使用空的PARTITION BY KEY()子句隐式定义为表的主键列。有关更多信息和示例，请参阅“不支持索引前缀的列用于键分区”的Column index prefixes not supported for key partitioning部分。

  更多信息和示例，请参阅“不支持键分区的列索引前缀”。

- 自MySQL 8.0.22起，InnoDB memcached插件已被弃用；期望在将来的MySQL版本中删除对它的支持。

- 自MySQL 8.0.26起，temptable_use_mmap变量已被弃用；期望在将来的MySQL版本中删除对它的支持。

- 自MySQL 8.0.27起，BINARY运算符已被弃用，您应该期望它在将来的MySQL版本中被移除。现在使用BINARY会引发警告。请改用CAST(... AS BINARY)。

- 自MySQL 8.0.27起，default_authentication_plugin变量已被弃用；期望在将来的MySQL版本中删除对它的支持。

- default_authentication_plugin变量仍然在MySQL 8.0.27中使用，但与新的authentication_policy系统变量一起使用，并且位于较低的优先级，authentication_policy系统变量在MySQL 8.0.27中引入了多因素认证功能。有关详细信息，请参阅默认认证插件。

- --abort-slave-event-count和--disconnect-slave-event-count服务器选项，由MySQL测试套件使用，通常不在生产中使用，自MySQL 8.0.29起已被弃用；期望这两个选项在将来的MySQL版本中被删除。

- 自MySQL 8.0.29起，myisam_repair_threads系统变量和myisamchk --parallel-recover选项已被弃用；期望在将来的MySQL版本中删除对它们的支持。

  从MySQL 8.0.29开始，myisam_repair_threads的值为1（默认值）之外的值会产生警告。

- 以前，MySQL接受包含任意数量的（任意）分隔符字符的DATE、TIME、DATETIME和TIMESTAMP文字，以及在日期和时间部分之间、之前和之后包含任意数量的空格字符的DATETIME和TIMESTAMP文字。自MySQL 8.0.29起，每当文字值包含以下任何内容时，服务器都会引发弃用警告：

  - 一个或多个非标准的分隔符字符
  - 多余的分隔符字符
  - 非空格字符（' '，0x20）之外的空格字符
  - 多余的空格字符

  每个时间值发出一次弃用警告，即使有多个问题。这个警告在严格模式下不会升级为错误，因此在启用严格模式时，执行这样的值的INSERT仍然会成功。

  您应该期望这种非标准行为在将来的MySQL版本中被移除，并立即采取措施，确保您的应用程序不依赖于它。

  有关更多信息和示例，请参阅日期和时间上下文中的字符串和数字文字。

- 自MySQL 8.0.29开始，replica_parallel_type系统变量及其关联的服务器选项--replica-parallel-type已被弃用。从此版本开始，读取或设置此值会引发弃用警告；期望在将来的MySQL版本中删除它。

- 从MySQL 8.0.30开始，设置replica_parallel_workers系统变量（或等效的服务器选项）为0已被弃用，并引发警告。当您希望复制使用单线程时，请改为使用replica_parallel_workers=1，这将产生相同的结果，但不会引发警告。

- 自MySQL 8.0.30开始，--skip-host-cache服务器选项已被弃用；期望在将来的MySQL版本中删除它。请改用host_cache_size系统变量。

- --old-style-user-limits选项，旨在与非常旧（5.0.3之前）的版本向后兼容，自MySQL 8.0.30起已被弃用；现在使用它会引发警告。您应该期望在将来的MySQL版本中删除此选项。

- 从MySQL 8.0.30起，innodb_log_files_in_group和innodb_log_file_size变量已被弃用。这些变量已被innodb_redo_log_capacity变量取代。有关更多信息，请参阅第15.6.5节，“重做日志”。

- 自MySQL 8.0.32起，使用未引号的标识符中的“FULL”作为版本号已被弃用，因为它是SQL标准中的保留关键字。这意味着如下语句会引发警告（ER_WARN_DEPRECATED_TO_BE_REMOVED_IDENT_FULL）：

  ```mysql
  CREATE TABLE full (c1 INT, c2 INT);
  ```

  为防止这种情况发生，请更改名称或像下面所示用反引号(`)括起来：

  ```mysql
   CREATE TABLE `full` (c1 INT, c2 INT);
  ```

  有关更多信息，请参阅第9.3节，“关键字和保留字”。

- 从MySQL 8.0.32开始，以美元符号($)作为未引号标识符的前导字符已被弃用，并产生警告。这种用法可能会在将来的MySQL版本中被删除。这包括用作数据库、表、视图、列或存储程序的名称以及它们的任何别名。美元符号仍然可以用作引号标识符的第一个字符。有关更多信息，请参阅第9.2节，“模式对象名称”。

- 从MySQL 8.0.34版本开始，binlog_format服务器系统变量已被弃用，并有望在将来的版本中被删除。同时，更改二进制日志格式也已被弃用，预计binlog_format的删除将使得行为基于行的二进制日志记录成为MySQL唯一使用或支持的二进制日志格式，而在MySQL 8.0中，行为基于行的二进制日志记录已经是默认格式。因此，新的MySQL安装应仅使用行为基于行的二进制日志记录；已使用binlog_format=STATEMENT或binlog_format=MIXED二进制日志格式的现有复制设置应迁移到基于行的格式。

  log_bin_trust_function_creators和log_statements_unsafe_for_binlog系统变量专门用于基于语句的日志记录和复制。因此，它们现在也已被弃用，并可能在将来的MySQL版本中被删除。

  在MySQL 8.0.34及更高版本中，设置或选择binlog_format、log_bin_trust_function_creators或log_statements_unsafe_for_binlog的值都会引发警告。

- mysqlpump客户端实用程序程序从MySQL 8.0.34版本开始已被弃用，并在调用时产生弃用警告。此程序可能在将来的MySQL版本中被删除。由于MySQL提供了其他执行数据库转储和备份操作的方式，具有相同或更多功能，包括mysqldump和MySQL Shell，因此此程序现在被认为是多余的。

  与此相关的lz4_decompress和zlib_decompress实用程序也从MySQL 8.0.34版本起已被弃用。

- 从MySQL 8.0.34版本开始，使用版本号而没有紧随其后的空格字符（或注释结尾）已被弃用，并引发警告。如下语句在MySQL 8.0.34或更高版本中会引发警告，如下所示：

  ```mysql
  mysql> CREATE TABLE t1(a INT, KEY (a)) /*!50110KEY_BLOCK_SIZE=1024*/ ENGINE=MYISAM;
  Query OK, 0 rows affected, 1 warning (0.01 sec)
  
  mysql> SHOW WARNINGS\G
  *************************** 1. row ***************************
    Level: Warning
     Code: 4164
  Message: Immediately starting the version comment after the version number is
  deprecated and may change behavior in a future release. Please insert a
  white-space character after the version number.  
  1 row in set (0.00 sec)
  ```

  为了避免这种警告，请在版本号后面插入一个或多个空格字符，像这样：

  ```mysql
  mysql> CREATE TABLE t2(a INT, KEY (a)) /*!50110 KEY_BLOCK_SIZE=1024*/ ENGINE=MYISAM;
  Query OK, 0 rows affected (0.00 sec)
  ```

  请参阅第9.7节“注释”。

- 从MySQL 8.0.34版本开始，sync_relay_log_info系统变量已被弃用，以及其等效的服务器启动选项--sync-relay-log-info。您应该预期在将来的MySQL版本中删除对此变量的支持，以及删除将复制应用程序元数据存储在文件中的功能。建议您在此发生之前更新可能依赖于它的任何MySQL应用程序。

- 从MySQL 8.0.35版本开始，binlog_transaction_dependency_tracking服务器系统变量已被弃用，并有望在将来的MySQL版本中删除。现在引用此变量或等效的mysqld启动选项--binlog-transaction-dependency-tracking会触发警告。目前没有计划替代此变量或其功能，预计将来会将其内部化到服务器中。

#### MySQL 8.0中删除的功能

以下项目已过时并在MySQL 8.0中已被移除。在有替代方法的情况下，应更新应用程序以使用这些替代方法。

对于在MySQL 8.0中移除的功能的MySQL 5.7应用程序，在从MySQL 5.7源复制到MySQL 8.0副本时，可能会导致语句失败，或者在源和副本上产生不同的效果。为了避免这种问题，应重新审查使用在MySQL 8.0中已移除功能的应用程序，并尽可能使用替代方法。

- innodb_locks_unsafe_for_binlog系统变量已被移除。READ COMMITTED隔离级别提供了类似的功能。

- 在MySQL 8.0.0中引入的information_schema_stats变量已被移除，并在MySQL 8.0.3中被information_schema_stats_expiry替代。

  information_schema_stats_expiry定义了用于缓存的INFORMATION_SCHEMA表统计信息的过期设置。更多信息，请参阅第8.2.3节“优化INFORMATION_SCHEMA查询”。

- 与已过时的InnoDB系统表相关的代码已在MySQL 8.0.3中被移除。基于已过时的InnoDB系统表的INFORMATION_SCHEMA视图已被替换为数据字典表上的内部系统视图。受影响的InnoDB INFORMATION_SCHEMA视图已被重命名：

  表1.1 重命名的InnoDB信息模式视图。

  | 旧名              | 新名            |
  | :------------------------ | :-------------------- |
  | INNODB_SYS_COLUMNS      | INNODB_COLUMNS      |
  | INNODB_SYS_DATAFILES    | INNODB_DATAFILES    |
  | INNODB_SYS_FIELDS       | INNODB_FIELDS       |
  | INNODB_SYS_FOREIGN      | INNODB_FOREIGN      |
  | INNODB_SYS_FOREIGN_COLS | INNODB_FOREIGN_COLS |
  | INNODB_SYS_INDEXES      | INNODB_INDEXES      |
  | INNODB_SYS_TABLES       | INNODB_TABLES       |
  | INNODB_SYS_TABLESPACES  | INNODB_TABLESPACES  |
  | INNODB_SYS_TABLESTATS   | INNODB_TABLESTATS   |
  | INNODB_SYS_VIRTUAL      | INNODB_VIRTUAL      |

  升级到MySQL 8.0.3或更高版本后，需要更新任何引用以前的InnoDB INFORMATION_SCHEMA视图名称的脚本。

- 以下与帐户管理相关的功能已被移除：

  - 使用GRANT创建用户。而是使用CREATE USER。遵循这个实践可以使NO_AUTO_CREATE_USER SQL模式对GRANT语句无关紧要，因此它也被移除了。当在选项文件中的sql_mode选项的值阻止mysqld启动时，现在会在服务器日志中写入错误。


  - 使用GRANT修改除权限分配以外的帐户属性。这包括身份验证、SSL和资源限制属性。相反，应在创建帐户时使用CREATE USER来设置这些属性，或者在之后使用ALTER USER来修改它们。


  - CREATE USER和GRANT中的IDENTIFIED BY PASSWORD 'auth_string'语法。而是在CREATE USER和ALTER USER中使用IDENTIFIED WITH auth_plugin AS 'auth_string'，其中'auth_string'的值以与命名插件兼容的格式提供。

    此外，由于已移除IDENTIFIED BY PASSWORD语法，log_builtin_as_identified_by_password系统变量变得多余并已被移除。

  - PASSWORD()函数。另外，PASSWORD()函数的移除意味着不再可用SET PASSWORD ... = PASSWORD('auth_string')语法。


  - old_passwords系统变量。


- 查询缓存已被移除。移除包括以下项目：

  - FLUSH QUERY CACHE和RESET QUERY CACHE语句。


  - 这些系统变量：query_cache_limit、query_cache_min_res_unit、query_cache_size、query_cache_type、query_cache_wlock_invalidate。


  - 这些状态变量：Qcache_free_blocks、Qcache_free_memory、Qcache_hits、Qcache_inserts、Qcache_lowmem_prunes、Qcache_not_cached、Qcache_queries_in_cache、Qcache_total_blocks。


  - 这些线程状态：检查缓存查询的特权、检查缓存查询的查询、使缓存查询无效、将缓存结果发送给客户端、在查询缓存中存储结果、等待查询缓存锁。


  - SQL_CACHE SELECT修饰符。

  这些已过时的查询缓存项目仍然过时，但没有效果；预期它们在将来的MySQL版本中会被移除：

  - SQL_NO_CACHE SELECT修饰符。


  - ndb_cache_check_time系统变量。


  have_query_cache系统变量仍然被弃用，并且始终具有值"NO"；预计它将在将来的MySQL版本中被移除。

- 数据字典提供有关数据库对象的信息，因此服务器不再检查数据目录中的目录名称以查找数据库。因此，--ignore-db-dir选项和ignore_db_dirs系统变量是多余的，并已被移除。

- DDL日志，也称为元数据日志，已被移除。从MySQL 8.0.3开始，此功能由数据字典innodb_ddl_log表处理。请参阅查看DDL日志。

- tx_isolation和tx_read_only系统变量已被移除。请改用transaction_isolation和transaction_read_only。

- sync_frm系统变量已被移除，因为.frm文件已过时。

- secure_auth系统变量和--secure-auth客户端选项已被移除。已移除mysql_options() C API函数的MYSQL_SECURE_AUTH选项。

- multi_range_count系统变量已被移除。

- log_warnings系统变量和--log-warnings服务器选项已被移除。请改用log_error_verbosity系统变量。

- sql_log_bin系统变量的全局范围已被移除。sql_log_bin只有会话范围，依赖于访问@@GLOBAL.sql_log_bin的应用程序应该进行调整。

- metadata_locks_cache_size和metadata_locks_hash_instances系统变量已被移除。

- 未使用的date_format、datetime_format、time_format和max_tmp_tables系统变量已被移除。

- 这些已过时的兼容性SQL模式已被移除：DB2、MAXDB、MSSQL、MYSQL323、MYSQL40、ORACLE、POSTGRESQL、NO_FIELD_OPTIONS、NO_KEY_OPTIONS、NO_TABLE_OPTIONS。它们不能再分配给sql_mode系统变量，也不能用作mysqldump --compatible选项的允许值。

  MAXDB的移除意味着在CREATE TABLE或ALTER TABLE中，TIMESTAMP数据类型将被视为TIMESTAMP，不再视为DATETIME。

- 已移除对GROUP BY子句的ASC或DESC限定符的弃用。以前依赖GROUP BY排序的查询可能产生与以前的MySQL版本不同的结果。为了产生给定的排序顺序，请提供ORDER BY子句。

- 已移除EXPLAIN语句中的EXTENDED和PARTITIONS关键字。这些关键字是不必要的，因为它们的效果始终是启用的。

- 已移除以下与加密相关的内容：

  - ENCODE()和DECODE()函数。
  - ENCRYPT()函数。
  - DES_ENCRYPT()和DES_DECRYPT()函数，--des-key-file选项，have_crypt系统变量，FLUSH语句的DES_KEY_FILE选项以及HAVE_CRYPT CMake选项。

  替代已移除的加密函数：对于ENCRYPT()函数，考虑改用SHA2()进行单向哈希。对于其他函数，考虑改用AES_ENCRYPT()和AES_DECRYPT()。

- 在MySQL 5.7中，多个空间函数具有多个名称，这些名称已被弃用，旨在使空间函数命名空间更加一致，目标是每个空间函数名称以ST_开头，如果执行精确操作，则以ST_开头，如果基于最小边界矩形执行操作，则以MBR开头。在MySQL 8.0中，已移除这些弃用函数，只保留相应的ST_和MBR函数：
  - 这些函数已被移除，MBR名称优先：Contains()，Disjoint()，Equals()，Intersects()，Overlaps()，Within()。
  - 这些函数已被移除，ST_名称优先：Area()，AsBinary()，AsText()，AsWKB()，AsWKT()，Buffer()，Centroid()，ConvexHull()，Crosses()，Dimension()，Distance()，EndPoint()，Envelope()，ExteriorRing()，GeomCollFromText()，GeomCollFromWKB()，GeomFromText()，GeomFromWKB()，GeometryCollectionFromText()，GeometryCollectionFromWKB()，GeometryFromText()，GeometryFromWKB()，GeometryN()，GeometryType()，InteriorRingN()，IsClosed()，IsEmpty()，IsSimple()，LineFromText()，LineFromWKB()，LineStringFromText()，LineStringFromWKB()，MLineFromText()，MLineFromWKB()，MPointFromText()，MPointFromWKB()，MPolyFromText()，MPolyFromWKB()，MultiLineStringFromText()，MultiLineStringFromWKB()，MultiPointFromText()，MultiPointFromWKB()，MultiPolygonFromText()，MultiPolygonFromWKB()，NumGeometries()，NumInteriorRings()，NumPoints()，PointFromText()，PointFromWKB()，PointN()，PolyFromText()，PolyFromWKB()，PolygonFromText()，PolygonFromWKB()，SRID()，StartPoint()，Touches()，X()，Y()。
  - GLength()已被移除，ST_Length()优先。

- 在第12.16.4节“从WKB值创建几何值的函数”中描述的函数以前接受WKB字符串或几何参数。不再允许使用几何参数并会产生错误。请参阅该部分，了解迁移查询以避免使用几何参数的指南。

- 解析器不再将\N视为SQL语句中NULL的同义词。使用NULL代替。

  此更改不影响使用LOAD DATA或SELECT ... INTO OUTFILE执行的文本文件导入或导出操作，其中NULL仍由\N表示。请参阅第13.2.9节“LOAD DATA语句”。

- 已移除PROCEDURE ANALYSE()语法。

- 客户端的 --ssl 和 --ssl-verify-server-cert 选项已被移除。使用 --ssl-mode=REQUIRED 替代 --ssl=1 或 --enable-ssl。使用 --ssl-mode=DISABLED 替代 --ssl=0, --skip-ssl 或 --disable-ssl。使用 --ssl-mode=VERIFY_IDENTITY 替代 --ssl-verify-server-cert 选项。（作为 MySQL 8.0.26 的一部分，服务器端的 --ssl 选项仍可用，但已被废弃，并可能在未来的 MySQL 版本中被移除。）

  对于 C API，mysql_options() 的 MYSQL_OPT_SSL_ENFORCE 和 MYSQL_OPT_SSL_VERIFY_SERVER_CERT 选项对应于客户端的 --ssl 和 --ssl-verify-server-cert 选项，并已被移除。使用 MYSQL_OPT_SSL_MODE 和选项值为 SSL_MODE_REQUIRED 或 SSL_MODE_VERIFY_IDENTITY 替代。

- --temp-pool 服务器选项已被移除。

- ignore_builtin_innodb 系统变量已被移除。

- 服务器不再将包含特殊字符的 MySQL 5.1 之前版本数据库名称转换为带有 #mysql50# 前缀的 5.1 格式。由于不再执行这些转换，mysqlcheck 的 --fix-db-names 和 --fix-table-names 选项，ALTER DATABASE 语句的 UPGRADE DATA DIRECTORY NAME 子句以及 Com_alter_db_upgrade 状态变量已被移除。

  仅支持从一个主要版本升级到另一个主要版本（例如，从 5.0 升级到 5.1，或从 5.1 升级到 5.5），因此几乎不再需要将旧的 5.0 数据库名称转换为当前版本的 MySQL。作为一种解决方法，可以在升级到更高版本之前，将 MySQL 5.0 安装升级到 MySQL 5.1。

- mysql_install_db 程序已从 MySQL 发行版中移除。数据目录的初始化应该通过使用 mysqld 的 --initialize 或 --initialize-insecure 选项来执行。此外，删除了 mysql_install_db 使用的 mysqld 的 --bootstrap 选项，并删除了控制 mysql_install_db 安装位置的 INSTALL_SCRIPTDIR CMake 选项。

- MySQL 服务器中的通用分区处理程序已被移除。为了支持给定表的分区，现在用于该表的存储引擎必须提供自己的（“本机”）分区处理程序。MySQL Server 中的 --partition 和 --skip-partition 选项已被移除，并且与分区相关的条目不再显示在 SHOW PLUGINS 的输出或信息模式 PLUGINS 表中。

  目前，有两个 MySQL 存储引擎提供本机分区支持：InnoDB 和 NDB。其中，只有 InnoDB 在 MySQL 8.0 中受支持。在 MySQL 8.0 中，任何尝试使用其他存储引擎创建分区表的操作都会失败。

  **升级的影响**。不支持从 MySQL 5.7（或更早版本）直接升级使用 InnoDB 以外的存储引擎（如 MyISAM）的分区表到 MySQL 8.0。处理此类表的两个选项如下：

  - 使用 ALTER TABLE ... REMOVE PARTITIONING 移除表的分区。
  - 使用 ALTER TABLE ... ENGINE=INNODB 更改表的存储引擎为 InnoDB。

  在将服务器升级到 MySQL 8.0 之前，必须对每个分区非 InnoDB 表执行上述两个操作中的至少一个。否则，在升级后将无法使用此类表。

  由于创建分区表的表创建语句，如果使用不支持分区的存储引擎，现在会失败并显示错误（ER_CHECK_NOT_IMPLEMENTED），因此您必须确保来自旧版MySQL的转储文件中的任何语句（例如由mysqldump编写的语句）创建分区表也不会指定像MyISAM这样没有本地分区处理程序的存储引擎。您可以通过执行以下任一操作来实现：

  - 从使用STORAGE ENGINE选项的CREATE TABLE语句中删除对分区的任何引用，而不是InnoDB。

  - 将存储引擎指定为InnoDB，或允许InnoDB成为表的默认存储引擎。

  有关更多信息，请参见第24.6.2节“与存储引擎相关的分区限制”。

- 系统和状态变量信息不再维护在INFORMATION_SCHEMA中。这些表已被删除：GLOBAL_VARIABLES，SESSION_VARIABLES，GLOBAL_STATUS，SESSION_STATUS。请改为使用相应的性能模式表。有关详细信息，请参见第27.12.14节“性能模式系统变量表”和第27.12.15节“性能模式状态变量表”。此外，show_compatibility_56系统变量已被删除。在从INFORMATION_SCHEMA表中的系统和状态变量信息移至性能模式表的过渡期间使用过该变量，现在不再需要。这些状态变量已被删除：Slave_heartbeat_period，Slave_last_heartbeat，Slave_received_heartbeats，Slave_retried_transactions，Slave_running。它们提供的信息在性能模式表中可用；请参见迁移到性能模式系统和状态变量表。

- 已删除性能模式setup_timers表，以及性能计时器表中的TICK行。

- 已删除libmysqld嵌入式服务器库，以及以下内容：

  - mysql_options()MYSQL_OPT_GUESS_CONNECTION，MYSQL_OPT_USE_EMBEDDED_CONNECTION，MYSQL_OPT_USE_REMOTE_CONNECTION和MYSQL_SET_CLIENT_IP选项
  - mysql_config --libmysqld-libs，--embedded-libs和--embedded选项
  - CMake WITH_EMBEDDED_SERVER，WITH_EMBEDDED_SHARED_LIBRARY和INSTALL_SECURE_FILE_PRIV_EMBEDDEDDIR选项
  - （未记录的）mysql --server-arg选项
  - mysqltest --embedded-server，--server-arg和--server-file选项
  - mysqltest_embedded和mysql_client_test_embedded测试程序

- 已删除mysql_plugin实用程序。替代方法包括在服务器启动时使用--plugin-load或--plugin-load-add选项加载插件，或在运行时使用INSTALL PLUGIN语句加载插件。

- 已删除resolveip实用程序。可以改用nslookup，host或dig。

- 已删除resolve_stack_dump实用程序。来自官方MySQL构建的堆栈跟踪始终是符号化的，因此无需使用resolve_stack_dump。

- 不再使用以下服务器错误代码，并已将其删除。专门测试这些错误的应用程序应进行更新。

  ```mysql
  ER_BINLOG_READ_EVENT_CHECKSUM_FAILURE
  ER_BINLOG_ROW_RBR_TO_SBR
  ER_BINLOG_ROW_WRONG_TABLE_DEF
  ER_CANT_ACTIVATE_LOG
  ER_CANT_CHANGE_GTID_NEXT_IN_TRANSACTION
  ER_CANT_CREATE_FEDERATED_TABLE
  ER_CANT_CREATE_SROUTINE
  ER_CANT_DELETE_FILE
  ER_CANT_GET_WD
  ER_CANT_SET_GTID_PURGED_WHEN_GTID_MODE_IS_OFF
  ER_CANT_SET_WD
  ER_CANT_WRITE_LOCK_LOG_TABLE
  ER_CREATE_DB_WITH_READ_LOCK
  ER_CYCLIC_REFERENCE
  ER_DB_DROP_DELETE
  ER_DELAYED_NOT_SUPPORTED
  ER_DIFF_GROUPS_PROC
  ER_DISK_FULL
  ER_DROP_DB_WITH_READ_LOCK
  ER_DROP_USER
  ER_DUMP_NOT_IMPLEMENTED
  ER_ERROR_DURING_CHECKPOINT
  ER_ERROR_ON_CLOSE
  ER_EVENTS_DB_ERROR
  ER_EVENT_CANNOT_DELETE
  ER_EVENT_CANT_ALTER
  ER_EVENT_COMPILE_ERROR
  ER_EVENT_DATA_TOO_LONG
  ER_EVENT_DROP_FAILED
  ER_EVENT_MODIFY_QUEUE_ERROR
  ER_EVENT_NEITHER_M_EXPR_NOR_M_AT
  ER_EVENT_OPEN_TABLE_FAILED
  ER_EVENT_STORE_FAILED
  ER_EXEC_STMT_WITH_OPEN_CURSOR
  ER_FAILED_ROUTINE_BREAK_BINLOG
  ER_FLUSH_MASTER_BINLOG_CLOSED
  ER_FORM_NOT_FOUND
  ER_FOUND_GTID_EVENT_WHEN_GTID_MODE_IS_OFF__UNUSED
  ER_FRM_UNKNOWN_TYPE
  ER_GOT_SIGNAL
  ER_GRANT_PLUGIN_USER_EXISTS
  ER_GTID_MODE_REQUIRES_BINLOG
  ER_GTID_NEXT_IS_NOT_IN_GTID_NEXT_LIST
  ER_HASHCHK
  ER_INDEX_REBUILD
  ER_INNODB_NO_FT_USES_PARSER
  ER_LIST_OF_FIELDS_ONLY_IN_HASH_ERROR
  ER_LOAD_DATA_INVALID_COLUMN_UNUSED
  ER_LOGGING_PROHIBIT_CHANGING_OF
  ER_MALFORMED_DEFINER
  ER_MASTER_KEY_ROTATION_ERROR_BY_SE
  ER_NDB_CANT_SWITCH_BINLOG_FORMAT
  ER_NEVER_USED
  ER_NISAMCHK
  ER_NO_CONST_EXPR_IN_RANGE_OR_LIST_ERROR
  ER_NO_FILE_MAPPING
  ER_NO_GROUP_FOR_PROC
  ER_NO_RAID_COMPILED
  ER_NO_SUCH_KEY_VALUE
  ER_NO_SUCH_PARTITION__UNUSED
  ER_OBSOLETE_CANNOT_LOAD_FROM_TABLE
  ER_OBSOLETE_COL_COUNT_DOESNT_MATCH_CORRUPTED
  ER_ORDER_WITH_PROC
  ER_PARTITION_SUBPARTITION_ERROR
  ER_PARTITION_SUBPART_MIX_ERROR
  ER_PART_STATE_ERROR
  ER_PASSWD_LENGTH
  ER_QUERY_ON_MASTER
  ER_RBR_NOT_AVAILABLE
  ER_SKIPPING_LOGGED_TRANSACTION
  ER_SLAVE_CHANNEL_DELETE
  ER_SLAVE_MULTIPLE_CHANNELS_HOST_PORT
  ER_SLAVE_MUST_STOP
  ER_SLAVE_WAS_NOT_RUNNING
  ER_SLAVE_WAS_RUNNING
  ER_SP_GOTO_IN_HNDLR
  ER_SP_PROC_TABLE_CORRUPT
  ER_SQL_MODE_NO_EFFECT
  ER_SR_INVALID_CREATION_CTX
  ER_TABLE_NEEDS_UPG_PART
  ER_TOO_MUCH_AUTO_TIMESTAMP_COLS
  ER_UNEXPECTED_EOF
  ER_UNION_TABLES_IN_DIFFERENT_DIR
  ER_UNSUPPORTED_BY_REPLICATION_THREAD
  ER_UNUSED1
  ER_UNUSED2
  ER_UNUSED3
  ER_UNUSED4
  ER_UNUSED5
  ER_UNUSED6
  ER_VIEW_SELECT_DERIVED_UNUSED
  ER_WRONG_MAGIC
  ER_WSAS_FAILED
  ```

- 已删除不建议使用的INFORMATION_SCHEMA INNODB_LOCKS和INNODB_LOCK_WAITS表。请改用Performance Schema data_locks和data_lock_waits表。

  > **注意：**
  > 
  >在MySQL 5.7中，INNODB_LOCKS表中的LOCK_TABLE列和sys模式innodb_lock_waits和x\$innodb_lock_waits视图中的locked_table列包含组合的模式/表名值。在MySQL 8.0中，data_locks表和sys模式视图包含单独的模式名称和表名称列。请参见第28.4.3.9节“innodb_lock_waits和x\$innodb_lock_waits视图”。

- InnoDB不再支持压缩临时表。当启用innodb_strict_mode（默认情况下）时，如果指定了ROW_FORMAT=COMPRESSED或KEY_BLOCK_SIZE，CREATE TEMPORARY TABLE将返回错误。如果禁用了innodb_strict_mode，将发出警告，并使用非压缩的行格式创建临时表。

- InnoDB在创建表空间数据文件时不再创建.isl文件（InnoDB符号链接文件），除非数据文件位于MySQL数据目录之外。innodb_directories选项现在支持定位在数据目录之外创建的表空间文件。

  有了这个变化，当服务器处于脱机状态时，通过手动修改.isl文件来移动远程表空间已不再受支持。现在innodb_directories选项支持移动远程表空间文件。请参见第15.6.3.6节“服务器脱机时移动表空间文件”。

- 已删除以下InnoDB文件格式变量：

  - innodb_file_format
  - innodb_file_format_check
  - innodb_file_format_max
  - innodb_large_prefix

  对于在MySQL 5.1中与早期版本的InnoDB兼容的表，需要文件格式变量。现在，MySQL 5.1已经结束了其产品生命周期，这些选项不再需要。

  从INNODB_TABLES和INNODB_TABLESPACES信息模式表中删除了FILE_FORMAT列。

- 已删除innodb_support_xa系统变量，该变量启用了XA事务中的两阶段提交的支持。XA事务中的InnoDB支持两阶段提交始终处于启用状态。

- 已删除对DTrace的支持。

- 已删除JSON_APPEND()函数。请改用JSON_ARRAY_APPEND()。

- 在MySQL 8.0.13中已删除将表分区放置在共享InnoDB表空间中的支持。共享表空间包括InnoDB系统表空间和通用表空间。有关识别共享表空间中的分区并将它们移动到每个文件的表空间的信息，请参见第2.10.5节“为升级准备您的安装”。

- 在MySQL 8.0.13中已弃用在SET之外的语句中设置用户变量的支持。此功能可能会在MySQL 8.4中被移除。

- 已删除--ndb perror选项。请改用ndb_perror实用程序。

- 已删除innodb_undo_logs变量。innodb_rollback_segments变量执行相同的功能，应该替代使用。

- 已删除Innodb_available_undo_logs状态变量。可以使用SHOW VARIABLES LIKE 'innodb_rollback_segments';来检索每个表空间的可用回滚段数量。

- 从MySQL 8.0.14开始，先前弃用的innodb_undo_tablespaces变量不再可配置。有关更多信息，请参见第15.6.3.4节“撤销表空间”。

- 已删除ALTER TABLE ... UPGRADE PARTITIONING语句的支持。

- 从MySQL 8.0.16开始，已删除internal_tmp_disk_storage_engine系统变量的支持；磁盘上的内部临时表现在始终使用InnoDB存储引擎。有关更多信息，请参见Storage Engine for On-Disk Internal Temporary Tables。

- 未使用的DISABLE_SHARED CMake选项已被删除。

- 从MySQL 8.0.30开始，已删除myisam_repair_threads系统变量。
