#### 30.4.4.23 ps_trace_thread() 存储过程

将一个被监控线程的所有 Performance Schema 数据转储为 `.dot` 格式图文件（用于 DOT 图描述语言）。从该存储过程返回的每个结果集都应用于生成完整的图。

执行过程中，此存储过程通过操控会话变量 `sql_log_bin` 禁用二进制日志记录。此为受限操作，因此需要足够权限设置受限会话变量。参见 [7.1.9.1节](#)。

**参数**

- `in_thread_id INT`：要跟踪的线程。
- `in_outfile VARCHAR(255)`：用于 `.dot` 输出文件的名称。
- `in_max_runtime DECIMAL(20,2)`：收集数据的最长秒数（可为小数）。使用 `NULL` 表示默认 60 秒。
- `in_interval DECIMAL(20,2)`：数据收集之间休眠的秒数（可为小数）。使用 `NULL` 表示默认 1 秒。
- `in_start_fresh BOOLEAN`：是否在跟踪前重置所有 Performance Schema 数据。
- `in_auto_setup BOOLEAN`：是否禁用所有其他线程并启用所有仪表和消费者。此选项还会在运行结束时重置设置。
- `in_debug BOOLEAN`：是否在图中包含 `file:lineno` 信息。

**示例**

跟踪线程 ID 为 25 的线程，并将结果保存到指定文件中：

```sql
mysql> CALL sys.ps_trace_thread(25, CONCAT('/tmp/stack-', REPLACE(NOW(), ' ', '-'), '.dot'), NULL, NULL, TRUE, TRUE, TRUE);
+-------------------+
| summary           |
+-------------------+
| Disabled 1 thread |
+-------------------+
1 row in set (0.00 sec)

+---------------------------------------------+
| Info                                        |
+---------------------------------------------+
| Data collection starting for THREAD_ID = 25 |
+---------------------------------------------+
1 row in set (0.03 sec)

+-----------------------------------------------------------+
| Info                                                      |
+-----------------------------------------------------------+
| Stack trace written to /tmp/stack-2014-02-16-21:18:41.dot |
+-----------------------------------------------------------+
1 row in set (60.07 sec)

+-------------------------------------------------------------------+
| Convert to PDF                                                    |
+-------------------------------------------------------------------+
| dot -Tpdf -o /tmp/stack_25.pdf /tmp/stack-2014-02-16-21:18:41.dot |
+-------------------------------------------------------------------+
1 row in set (60.07 sec)

+-------------------------------------------------------------------+
| Convert to PNG                                                    |
+-------------------------------------------------------------------+
| dot -Tpng -o /tmp/stack_25.png /tmp/stack-2014-02-16-21:18:41.dot |
+-------------------------------------------------------------------+
1 row in set (60.07 sec)

+------------------+
| summary          |
+------------------+
| Enabled 1 thread |
+------------------+
1 row in set (60.32 sec)
```