# 第 29 章 MySQL 性能模式

目录

- [29.1 性能模式快速入门](./29.01.性能模式快速入门.md)
- [29.2 性能模式构建配置](./29.02.性能模式构建配置.md)
- [29.3 性能模式启动配置](./29.03.性能模式启动配置/29.03.00.性能模式启动配置.md)
- [29.4 性能模式运行时配置](./29.04.性能模式运行时配置.md)
- [29.5 性能模式查询](./29.05.性能模式查询.md)
- [29.6 性能模式的仪表命名约定](./29.06.性能模式的仪表命名约定.md)
- [29.7 性能模式状态监控](./29.07.性能模式状态监控.md)
- [29.8 性能模式原子与分子事件](./29.08.性能模式原子与分子事件.md)
- [29.9 性能模式当前与历史事件表](./29.09.性能模式当前与历史事件表.md)
- [29.10 性能模式语句摘要和采样](./29.10.性能模式语句摘要和采样.md)
- [29.11 性能模式表的总体特征](./29.11.性能模式表的总体特征.md)
- [29.12 性能模式表说明](./29.12.性能模式表说明/29.12.00.性能模式表说明.md)
- [29.13 性能模式选项和变量参考](./29.13.性能模式选项和变量参考.md)
- [29.14 性能模式命令选项](./29.14.性能模式命令选项.md)
- [29.15 性能模式系统变量](./29.15.性能模式系统变量.md)
- [29.16 性能模式状态变量](./29.16.性能模式状态变量.md)
- [29.17 性能模式内存分配模型](./29.17.性能模式内存分配模型.md)
- [29.18 性能模式与插件](./29.18.性能模式与插件.md)
- [29.19 使用性能模式诊断问题](./29.19.使用性能模式诊断问题/29.19.00.使用性能模式诊断问题.md)
- [29.20 性能模式的限制](./29.20.性能模式的限制.md)  

MySQL 性能模式是用于低层次监控 MySQL 服务器执行情况的功能。性能模式具有以下特点：

- 性能模式提供了一种在运行时检查服务器内部执行情况的方法。它通过 `PERFORMANCE_SCHEMA` 存储引擎和 `performance_schema` 数据库实现。性能模式主要关注性能数据，这与 `INFORMATION_SCHEMA` 不同，后者用于元数据检查。
  
- 性能模式监控服务器事件。事件是服务器执行的任何耗时操作，并经过仪表化以收集计时信息。通常，事件可以是函数调用、操作系统等待、SQL 语句执行的某个阶段（如解析或排序），或整个语句或语句组。事件收集可以提供有关同步调用（如互斥锁）、文件和表 I/O、表锁等的信息，适用于服务器及多个存储引擎。
  
- 性能模式事件与记录到服务器二进制日志中的事件（描述数据修改的事件）以及事件调度器事件（属于存储程序类型）是不同的。
  
- 性能模式事件特定于 MySQL 服务器的实例。性能模式表被视为本地服务器表，不会复制或写入二进制日志。
  
- 当前事件、历史事件和事件汇总均可用。这样可以确定经过仪表化的活动执行了多少次以及花费了多少时间。事件信息还可以显示特定线程的活动，或与特定对象（如互斥锁或文件）相关的活动。
  
- `PERFORMANCE_SCHEMA` 存储引擎通过服务器源代码中的“仪表点”收集事件数据。
  
- 收集到的事件存储在 `performance_schema` 数据库的表中。这些表可以像其他表一样使用 `SELECT` 语句进行查询。
  
- 性能模式配置可以通过 SQL 语句动态修改，影响数据收集的配置更改会立即生效。
  
- 性能模式中的表是内存表，不使用持久的磁盘存储。表的内容在服务器启动时重新填充，并在服务器关闭时丢弃。
  
- 监控功能在 MySQL 支持的所有平台上可用。
  
- 某些限制可能适用：计时器的类型可能因平台而异。适用于存储引擎的仪表可能未在所有存储引擎中实现。第三方引擎的仪表化由引擎维护者负责。参见[第 29.20 节，性能模式的限制](#restrictions-on-performance-schema)。
  
- 数据收集通过修改服务器源代码以添加仪表化实现。与其他功能（如复制或事件调度器）不同，性能模式没有关联的独立线程。
  

性能模式旨在提供服务器执行情况的有用信息，同时对服务器性能的影响最小。实现遵循以下设计目标：

- 启用性能模式不会改变服务器行为。例如，它不会改变线程调度，也不会改变查询执行计划（如 `EXPLAIN` 所示）。
- 服务器监控持续且不显眼，开销非常小。启用性能模式不会导致服务器不可用。
- 解析器保持不变，没有新关键词或语句。
- 即使性能模式内部失败，服务器代码执行也会正常进行。
- 在事件收集和事件检索之间进行处理选择时，优先考虑加快收集过程。因为收集是持续的，而检索是按需的，且可能永远不会发生。
- 大多数性能模式表都有索引，这使优化器可以使用非全表扫描的执行计划。有关详细信息，请参见[第 10.2.4 节，优化性能模式查询](#optimizing-performance-schema-queries)。
- 添加新的仪表点非常简单。
- 仪表化具有版本控制。如果仪表实现发生变化，之前的仪表化代码仍然可以继续工作。这对第三方插件的开发人员有利，因为无需更新每个插件以保持与最新的性能模式更改同步。

> **注意**
>
> MySQL `sys` 模式是一组对象，提供对性能模式收集的数据的便捷访问。`sys` 模式默认安装。有关使用说明，请参见[第 30 章，MySQL sys 模式](#mysql-sys-schema)。