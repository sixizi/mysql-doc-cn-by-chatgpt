**29.4.3 事件预过滤**



事件预过滤由性能模式执行，并且对所有用户产生全局效应。预过滤可以应用于事件处理的生产者阶段或消费者阶段：



​	•	**在生产者阶段配置预过滤**，可以使用以下几个表：

​	•	setup_instruments 表指示哪些检测器可用。如果该表中的某个检测器被禁用，那么无论其他与事件生产相关的设置表内容如何，该检测器都不会生成事件。如果该表中的检测器被启用，则允许其生成事件，但仍会受到其他表内容的限制。

​	•	setup_objects 表控制性能模式是否监控特定的表和存储程序对象。

​	•	threads 表指示是否为每个服务器线程启用监控。

​	•	setup_actors 表确定新创建的前台线程的初始监控状态。

​	•	**在消费者阶段配置预过滤**，需要修改 setup_consumers 表。该表确定事件被发送到的目的地。setup_consumers 表还会隐式地影响事件的生成。如果某个事件没有被发送到任何目的地（即它从未被消费），则性能模式不会生成该事件。



对这些表的任何修改都会立即影响监控，唯一的例外是对 setup_actors 表的修改，仅影响修改后创建的前台线程，不会影响现有线程。



当你更改监控配置时，性能模式不会清空历史表。已收集的事件会保留在当前事件和历史表中，直到它们被更新的事件取代。如果你禁用了某些检测器，可能需要等待一段时间，直到这些检测器的事件被感兴趣的更新事件取代。或者，你也可以使用 TRUNCATE TABLE 来清空历史表。



在进行检测器配置更改后，你可能需要截断汇总表。通常，截断的效果是将汇总列重置为 0 或 NULL，而不是删除行。这可以让你清除已收集的数据并重新开始聚合。例如，在运行时配置更改后，这可能非常有用。关于某些汇总表截断行为的例外情况，会在各自的汇总表章节中说明。



接下来的部分将详细介绍如何使用特定表来控制性能模式的预过滤。