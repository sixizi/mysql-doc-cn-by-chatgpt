**29.6 Performance Schema 探针命名规范**



探针名称由一系列元素组成，这些元素通过 '/' 字符分隔。例如：



wait/io/file/myisam/log

wait/io/file/mysys/charset

wait/lock/table/sql/handler

wait/synch/cond/mysys/COND_alarm

wait/synch/cond/sql/BINLOG::update_cond

wait/synch/mutex/mysys/BITMAP_mutex

wait/synch/mutex/sql/LOCK_delete

wait/synch/rwlock/sql/Query_cache_query::lock

stage/sql/closing tables

stage/sql/Sorting result

statement/com/Execute

statement/com/Query

statement/sql/create_table

statement/sql/lock_tables

errors



探针名称空间具有树状结构。从左到右，探针名称的元素依次从较为通用到更为具体。名称的元素数量取决于探针的类型。



名称中某个元素的解释取决于其左侧的元素。例如，myisam 在以下两个名称中都有出现，但在第一个名称中与文件 I/O 相关，而在第二个名称中与同步探针相关：



wait/io/file/myisam/log

wait/synch/cond/myisam/MI_SORT_INFO::cond



探针名称由 Performance Schema 实现定义的前缀部分和开发者在实现探针代码时定义的后缀部分组成。探针名称的顶级元素表示探针的类型。此元素还决定 performance_timers 表中适用于该探针的事件计时器。探针名称的前缀部分，顶级元素表示探针的类型。



探针名称的后缀来自探针自身的代码实现。后缀可能包括以下级别：



​	•	主要元素的名称（如 myisam、innodb、mysys 或 sql）或插件名称。

​	•	代码中的变量名称，格式为 XXX（全局变量）或 CCC::MMM（类 CCC 中成员 MMM）。例如：COND_thread_cache、THR_LOCK_myisam、BINLOG::LOCK_index。



**顶级探针元素**



**Idle 探针元素**



​	•	idle：空闲事件的探针。该探针没有进一步的元素。



**Error 探针元素**



​	•	error：用于收集服务器错误和警告信息的探针。此探针默认启用，setup_instruments 表中 error 行的 TIMED 列不适用，因为不收集时间信息。



**Memory 探针元素**



​	•	memory：用于内存事件的探针，默认启用。可以在启动时启用或禁用，或在运行时通过更新 setup_instruments 表中相关探针的 ENABLED 列进行动态启用或禁用。内存探针名称格式为 memory/code_area/instrument_name，其中 code_area 是一个如 sql 或 myisam 的值，instrument_name 是探针的详细名称。



带有 memory/performance_schema/ 前缀的探针显示 Performance Schema 内部缓冲区分配了多少内存。memory/performance_schema/ 探针是内置的，始终启用，且无法在启动时或运行时禁用。内置内存探针仅显示在 memory_summary_global_by_event_name 表中。更多信息请参阅[第29.17节, “Performance Schema 内存分配模型”](#29.17)。



**Stage 探针元素**



​	•	stage：用于阶段事件的探针。其名称格式为 stage/code_area/stage_name，其中 code_area 是一个如 sql 或 myisam 的值，stage_name 表示语句处理的阶段，如 Sorting result 或 Sending data。这些阶段对应于 SHOW PROCESSLIST 显示的线程状态，或 Information Schema PROCESSLIST 表中可见的状态。



**Statement 探针元素**



​	•	statement/abstract/*：用于语句操作的抽象探针。抽象探针在语句分类的早期阶段使用，尚未确定语句的确切类型，然后在类型确定后更改为更具体的语句探针。有关此过程的描述，请参阅[第29.12.6节, “Performance Schema 语句事件表”](#29.12.6)。

​	•	statement/com：用于命令操作的探针。这些名称与 COM_xxx 操作对应（参见 mysql_com.h 头文件和 sql/sql_parse.cc）。例如，statement/com/Connect 和 statement/com/Init DB 探针对应 COM_CONNECT 和 COM_INIT_DB 命令。

​	•	statement/scheduler/event：用于跟踪由事件调度程序执行的所有事件的探针。当计划事件开始执行时，该探针生效。

​	•	statement/sp：用于存储程序执行的内部指令的探针。例如，statement/sp/cfetch 和 statement/sp/freturn 探针用于游标获取和函数返回指令。

​	•	statement/sql：用于 SQL 语句操作的探针。例如，statement/sql/create_db 和 statement/sql/select 探针用于 CREATE DATABASE 和 SELECT 语句。



**Thread 探针元素**



​	•	thread：线程探针显示在 setup_threads 表中，该表显示线程类名称和属性。线程探针名称以 thread 开头，例如 thread/sql/parser_service 或 thread/performance_schema/setup。

​	•	thread/ndbcluster/：ndbcluster 插件线程的探针名称以 thread/ndbcluster/ 开头；有关这些信息的更多内容，请参阅 ndbcluster 插件线程。



**Wait 探针元素**



​	•	wait/io：用于 I/O 操作的探针。

​	•	wait/io/file：用于文件 I/O 操作的探针。对于文件，等待是指等待文件操作完成的时间（例如，对 fwrite() 的调用）。由于缓存的存在，磁盘上的物理文件 I/O 可能不会在此调用中发生。

​	•	wait/io/socket：用于套接字操作的探针。套接字探针名称格式为 wait/io/socket/sql/socket_type。服务器为其支持的每种网络协议都有一个监听套接字。与 TCP/IP 或 Unix 套接字文件连接相关的监听套接字的探针值分别为 server_tcpip_socket 或 server_unix_socket。当监听套接字检测到连接时，服务器将连接转移到一个由单独线程管理的新套接字。新连接线程的探针类型值为 client_connection。

​	•	wait/io/table：用于表 I/O 操作的探针，包括对持久基础表或临时表的行级访问。影响行的操作有 fetch、insert、update 和 delete。对于视图，等待与视图引用的基础表相关。

​	•	wait/lock：用于锁操作的探针。

​	•	wait/lock/table：用于表锁操作的探针。

​	•	wait/lock/metadata/sql/mdl：用于元数据锁操作的探针。

​	•	wait/synch：用于同步对象的探针。对于同步对象，TIMER_WAIT 时间包括尝试获取对象锁时被阻塞的时间（如果有）。

​	•	wait/synch/cond：条件由一个线程用于通知其他线程它们正在等待的某事已经发生。如果单个线程正在等待条件，它可以唤醒并继续执行。如果有多个线程等待，它们可以全部唤醒并竞争它们等待的资源。

​	•	wait/synch/mutex：互斥对象用于允许对资源的访问（如一段可执行代码），同时防止其他线程访问该资源。

​	•	wait/synch/prlock：优先级读写锁对象。

​	•	wait/synch/rwlock：用于锁定特定变量以防止其他线程访问的普通读写锁对象。多个线程可以同时获取共享的读锁。一次只能由一个线程获取排他的写锁。

​	•	wait/synch/sxlock：共享排他（SX）锁是一种读写锁对象，它在提供对公共资源的写访问的同时允许其他线程执行不一致的读取。sxlocks 优化了并发性，并提高了读写工作负载的可扩展性。