### 29.12.6 `Performance Schema` 语句事件表

#### 29.12.6.1 `events_statements_current` 表
#### 29.12.6.2 `events_statements_history` 表
#### 29.12.6.3 `events_statements_history_long` 表
#### 29.12.6.4 `prepared_statements_instances` 表

`Performance Schema` 为语句执行提供监控。语句事件位于事件层次结构的高级别。在该层次结构中，等待事件嵌套在阶段事件内，阶段事件嵌套在语句事件内，语句事件嵌套在事务事件内。

以下表格用于存储语句事件：

- **`events_statements_current`**：每个线程的当前语句事件。
- **`events_statements_history`**：每个线程最近已结束的语句事件。
- **`events_statements_history_long`**：全局范围内所有线程最近已结束的语句事件。
- **`prepared_statements_instances`**：已准备语句实例及其统计信息。

以下部分描述语句事件表。有关语句事件汇总的信息表，请参阅 [Section 29.12.20.3, “Statement Summary Tables”](#section-29-12-20-3-statement-summary-tables)。

关于三个 `events_statements_xxx` 事件表之间的关系，请参阅 [Section 29.9, “Performance Schema Tables for Current and Historical Events”](#section-29-9-performance-schema-tables-for-current-and-historical-events)。

---

### 配置语句事件的收集

要控制是否收集语句事件，需要设置相关的仪器和消费者状态：

- **`setup_instruments` 表**：包含以 `statement` 开头的仪器名称，用于启用或禁用特定语句事件类别的收集。
- **`setup_consumers` 表**：包含与当前和历史语句事件表名称及语句摘要消费者对应的值，用于过滤语句事件和语句摘要的收集。

语句仪器默认启用，且 `events_statements_current`、`events_statements_history` 和 `statements_digest` 消费者默认启用：

```sql
mysql> SELECT NAME, ENABLED, TIMED
       FROM performance_schema.setup_instruments
       WHERE NAME LIKE 'statement/%';