# 29.12.11 性能模式（Performance Schema）复制表

## 目录
- [29.12.11.1 `binary_log_transaction_compression_stats` 表](#2912111-binary_log_transaction_compression_stats-表)
- [29.12.11.2 `replication_applier_configuration` 表](#2912112-replication_applier_configuration-表)
- [29.12.11.3 `replication_applier_status` 表](#2912113-replication_applier_status-表)
- [29.12.11.4 `replication_applier_status_by_coordinator` 表](#2912114-replication_applier_status_by_coordinator-表)
- [29.12.11.5 `replication_applier_status_by_worker` 表](#2912115-replication_applier_status_by_worker-表)
- [29.12.11.6 `replication_applier_filters` 表](#2912116-replication_applier_filters-表)
- [29.12.11.7 `replication_applier_global_filters` 表](#2912117-replication_applier_global_filters-表)
- [29.12.11.8 `replication_asynchronous_connection_failover` 表](#2912118-replication_asynchronous_connection_failover-表)
- [29.12.11.9 `replication_asynchronous_connection_failover_managed` 表](#2912119-replication_asynchronous_connection_failover_managed-表)
- [29.12.11.10 `replication_connection_configuration` 表](#29121110-replication_connection_configuration-表)
- [29.12.11.11 `replication_connection_status` 表](#29121111-replication_connection_status-表)
- [29.12.11.12 `replication_group_communication_information` 表](#29121112-replication_group_communication_information-表)
- [29.12.11.13 `replication_group_configuration_version` 表](#29121113-replication_group_configuration_version-表)
- [29.12.11.14 `replication_group_member_actions` 表](#29121114-replication_group_member_actions-表)
- [29.12.11.15 `replication_group_member_stats` 表](#29121115-replication_group_member_stats-表)
- [29.12.11.16 `replication_group_members` 表](#29121116-replication_group_members-表)

---

## 性能模式复制表概述

性能模式提供了一些表格，用于展示复制相关的信息。这类似于 `SHOW REPLICA STATUS` 语句，但表格形式的表示更便于访问和使用：

- **`SHOW REPLICA STATUS` 的局限性**：它适合视觉检查，但对于程序化使用不太便利。
- **性能模式复制表的优势**：
  - 通过常规 `SELECT` 查询（包括复杂的 `WHERE` 条件和连接查询）可以检索复制状态信息。
  - 查询结果可以存储到表中以供进一步分析，或分配给变量以用于存储过程。
  - 提供了多线程复制操作的更详细的诊断信息。例如，每个线程的错误信息都单独存储，而不是仅显示最近的错误。
  - 支持开发者通过扩展表功能提供额外信息。

---

## 复制表描述

性能模式提供以下与复制相关的表：

### 关于从库与主库连接的信息
- **`replication_connection_configuration`**：用于连接主库的配置参数。
- **`replication_connection_status`**：当前与主库连接的状态。
- **`replication_asynchronous_connection_failover`**：异步连接故障转移机制的主库列表。

### 关于事务应用器的一般（非线程特定）信息
- **`replication_applier_configuration`**：从库上的事务应用器的配置参数。
- **`replication_applier_status`**：从库上的事务应用器的当前状态。

### 关于应用从主库接收的事务的特定线程的信息
- **`replication_applier_status_by_coordinator`**：协调线程的状态（仅在从库为多线程时非空）。
- **`replication_applier_status_by_worker`**：应用器线程或工作线程的状态（仅在从库为多线程时非空）。

### 关于基于通道的复制过滤器的信息
- **`replication_applier_filters`**：提供有关特定复制通道上配置的复制过滤器的信息。
- **`replication_applier_global_filters`**：提供有关全局复制过滤器的信息，这些过滤器适用于所有复制通道。

### 关于组复制成员的信息
- **`replication_group_members`**：提供组成员的网络和状态信息。
- **`replication_group_member_stats`**：提供组成员和参与事务的统计信息。

> **提示**：有关更多信息，请参阅 [第20.4节，监控组复制](#20.4)。

---

## 复制表生命周期

性能模式表格的填充方式如下：

1. **执行 `CHANGE REPLICATION SOURCE TO` 或 `CHANGE MASTER TO` 之前**：
   - 表格为空。

2. **执行上述命令后**：
   - 可以在表中看到配置参数。
   - 此时没有活动的复制线程，`THREAD_ID` 列为 `NULL`，`SERVICE_STATE` 列值为 `OFF`。

3. **执行 `START REPLICA` 后**：
   - 可以看到非 `NULL` 的 `THREAD_ID` 值。
   - 空闲或活动线程的 `SERVICE_STATE` 值为 `ON`。
   - 连接主库的线程在建立连接时为 `CONNECTING`，成功后为 `ON`。

4. **执行 `STOP REPLICA` 后**：
   - `THREAD_ID` 列变为 `NULL`。
   - 停止的线程其 `SERVICE_STATE` 值为 `OFF`。

5. **多线程模式下**：
   - `replication_applier_status_by_worker` 表仅在从库多线程模式下非空。
   - 此时，表的行数等于工作线程的数量。

---

## 不在复制表中的从库状态信息

与 `SHOW REPLICA STATUS` 输出相比，性能模式复制表的信息存在一些差异：

1. **未保存基于文件名和位置的字段**：
   - `Master_Log_File`
   - `Read_Master_Log_Pos`
   - `Relay_Log_File`
   - 等其他字段。

2. **未保存基于 `server_id` 的字段**：
   - `Master_Server_Id`
   - 等其他字段。

3. **错误字段的别名未保存**：
   - `Last_Errno`
   - `Last_Error`

4. **不保留命令行过滤选项相关字段**：
   - `Replicate_Do_DB`
   - `Replicate_Ignore_DB`
   - 等其他字段。

5. **`Replica_IO_State` 和 `Replica_SQL_Running_State` 未保留**：
   - 可以通过连接 `INFORMATION_SCHEMA.PROCESSLIST` 表来获取状态。

6. **GTID 信息替代文件和位置**：
   - 使用 GTID 相关字段代替 `SHOW REPLICA STATUS` 中的文件名和位置字段。

---

## 复制通道

复制表的第一列为 `CHANNEL_NAME`，支持按通道过滤表内容：

- 非多源复制中，只有单一默认通道。
- 使用多通道复制时，可以通过 `CHANNEL_NAME` 监控特定通道。

> **更多信息**：请参阅 [第19.2.2节，复制通道](#1922) 和 [第19.1.5.8节，监控多源复制](#19158)。